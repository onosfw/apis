<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>suricata: libhtp/htp/htp_util.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">suricata
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('htp__util_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">htp_util.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="htp__util_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (c) 2009-2010 Open Information Security Foundation</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (c) 2010-2013 Qualys, Inc.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * All rights reserved.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * modification, are permitted provided that the following conditions are</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * met:</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * - Redistributions of source code must retain the above copyright</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *   notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * - Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *   notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *   documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * - Neither the name of the Qualys, Inc. nor the names of its</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *   contributors may be used to endorse or promote products derived from</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *   this software without specific prior written permission.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> ***************************************************************************/</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * @file</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * @author Ivan Ristic &lt;ivanr@webkreator.com&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="htp__config__auto_8h.html">htp_config_auto.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="htp__private_8h.html">htp_private.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * Is character a linear white space character?</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> * @param[in] c</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a01068fcd4418a90ea81a2ad5e4eb8c81">   49</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a01068fcd4418a90ea81a2ad5e4eb8c81">htp_is_lws</a>(<span class="keywordtype">int</span> c) {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">if</span> ((c == <span class="charliteral">&#39; &#39;</span>) || (c == <span class="charliteral">&#39;\t&#39;</span>)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> * Is character a separator character?</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"> * @param[in] c</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a238c39a6d7fd7f35735f9c97a1b2aa66">   60</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a238c39a6d7fd7f35735f9c97a1b2aa66">htp_is_separator</a>(<span class="keywordtype">int</span> c) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">/* separators = &quot;(&quot; | &quot;)&quot; | &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;@&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">                  | &quot;,&quot; | &quot;;&quot; | &quot;:&quot; | &quot;\&quot; | &lt;&quot;&gt;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">                  | &quot;/&quot; | &quot;[&quot; | &quot;]&quot; | &quot;?&quot; | &quot;=&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">                  | &quot;{&quot; | &quot;}&quot; | SP | HT         */</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">switch</span> (c) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;(&#39;</span>:</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;)&#39;</span>:</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;&lt;&#39;</span>:</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;&gt;&#39;</span>:</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;@&#39;</span>:</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;,&#39;</span>:</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;;&#39;</span>:</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;:&#39;</span>:</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;\\&#39;</span>:</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;&quot;&#39;</span>:</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;/&#39;</span>:</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;[&#39;</span>:</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;]&#39;</span>:</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;=&#39;</span>:</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;{&#39;</span>:</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;}&#39;</span>:</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39; &#39;</span>:</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;\t&#39;</span>:</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> * Is character a text character?</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> * @param[in] c</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="htp__util_8c.html#acd9999e11e39f8434023b786416fdc43">   98</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#acd9999e11e39f8434023b786416fdc43">htp_is_text</a>(<span class="keywordtype">int</span> c) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\t&#39;</span>) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span> (c &lt; 32) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> * Is character a token character?</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> * @param[in] c</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a7a0e47fdda476b38045a7d3406fb51ee">  110</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a7a0e47fdda476b38045a7d3406fb51ee">htp_is_token</a>(<span class="keywordtype">int</span> c) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">/* token = 1*&lt;any CHAR except CTLs or separators&gt; */</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">/* CHAR  = &lt;any US-ASCII character (octets 0 - 127)&gt; */</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> ((c &lt; 32) || (c &gt; 126)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="htp__private_8h.html#a238c39a6d7fd7f35735f9c97a1b2aa66">htp_is_separator</a>(c)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> * Remove all line terminators (LF or CRLF) from</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"> * the end of the line provided as input.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"> * @return 0 if nothing was removed, 1 if one or more LF characters were removed, or</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"> *         2 if one or more CR and/or LF characters were removed.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="htp__util_8c.html#aa5e02fbff064b8409e1307bd30fffab8">  125</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#aa5e02fbff064b8409e1307bd30fffab8">htp_chomp</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> *<a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">int</span> r = 0;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// Loop until there&#39;s no more stuff in the buffer</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">while</span> (*len &gt; 0) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="comment">// Try one LF first</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (data[*len - 1] == <a class="code" href="util-decode-mime_8c.html#a350c9d6cb81908d59427ee96844d1a9c">LF</a>) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            (*len)--;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            r = 1;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="keywordflow">if</span> (*len == 0) <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="comment">// A CR is allowed before LF</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">if</span> (data[*len - 1] == <a class="code" href="util-decode-mime_8c.html#a876ce77f3c672c7162658151e648389e">CR</a>) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                (*len)--;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                r = 2;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"> * Is character a white space character?</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment"> * @param[in] c</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a8154aaa13d12e1fea9b066e0881bd125">  154</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a8154aaa13d12e1fea9b066e0881bd125">htp_is_space</a>(<span class="keywordtype">int</span> c) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">switch</span> (c) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39; &#39;</span>:</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;\f&#39;</span>:</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;\v&#39;</span>:</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;\t&#39;</span>:</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;\r&#39;</span>:</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">case</span> <span class="charliteral">&#39;\n&#39;</span>:</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;}</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"> * Converts request method, given as a string, into a number.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"> * @param[in] method</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment"> * @return Method number of M_UNKNOWN</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a78c6b46f18005b1746de2e0da8b2bdc2">  174</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#ad43c81727dd2888a32e4fc692b472249">htp_convert_method_to_number</a>(<a class="code" href="structbstr__t.html">bstr</a> *method) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (method == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a92dc985a5bcb2657195e86e67511fe05">HTP_M_UNKNOWN</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">// TODO Optimize using parallel matching, or something similar.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;GET&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a068bb34420bf47015361494009bbcf7f">HTP_M_GET</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;PUT&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a749c276cad23214291252a8bf85ca68e">HTP_M_PUT</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;POST&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a6f4f4a427599f9c792613bec7810bd57">HTP_M_POST</a>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;DELETE&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54aea1a762800b83e10d436e90c140ebca2">HTP_M_DELETE</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;CONNECT&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a444a002f7c58506f0e49aa51e3df3c65">HTP_M_CONNECT</a>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;OPTIONS&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a81520736f83f29a2d10f011d53d12542">HTP_M_OPTIONS</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;TRACE&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a2960d5cf29848f89257013ded88041d9">HTP_M_TRACE</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;PATCH&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54aaa1e95c235b2860f494d66c974dddd64">HTP_M_PATCH</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;PROPFIND&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a48606fdd6ec8271528a54249578a4c7d">HTP_M_PROPFIND</a>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;PROPPATCH&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ac449547fd0838bb3eb703d974310341a">HTP_M_PROPPATCH</a>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;MKCOL&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ae846c2a168246ac43168e52d04817a91">HTP_M_MKCOL</a>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;COPY&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a0afd5bbc37f98e945e2ae566d7d02a8b">HTP_M_COPY</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;MOVE&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ae451fd57a8a591bfbc83f84f20345d92">HTP_M_MOVE</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;LOCK&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ae992e5453e736431a1194139c3bc1a8d">HTP_M_LOCK</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;UNLOCK&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ad35a531e806c138340f224e5b582f4b7">HTP_M_UNLOCK</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;VERSION-CONTROL&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54af73c7598f9f626a9cf728505630550fa">HTP_M_VERSION_CONTROL</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;CHECKOUT&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a30cd4d5fa5016930f8430869cec74d3e">HTP_M_CHECKOUT</a>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;UNCHECKOUT&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a8b8319ecb6ac2df1d243d4a913067a4a">HTP_M_UNCHECKOUT</a>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;CHECKIN&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a3320afa446d95696635a9501e008c5bf">HTP_M_CHECKIN</a>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;UPDATE&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ad02ee7c302bf4887e1ddf634143f347b">HTP_M_UPDATE</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;LABEL&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a9dc665fc8720e2aa1f60e99d0f33f698">HTP_M_LABEL</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;REPORT&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a8052e758111da3d2cdabd1252a093e7c">HTP_M_REPORT</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;MKWORKSPACE&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ad993fa141c63d4a9de68a117921de659">HTP_M_MKWORKSPACE</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;MKACTIVITY&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a11c070fe8bd95cf44604939ffc82e6cd">HTP_M_MKACTIVITY</a>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;BASELINE-CONTROL&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54aafa8a108a25362c7eba5ad7c72ced5a8">HTP_M_BASELINE_CONTROL</a>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;MERGE&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ae269bae49fcd079feb54e71f575312b3">HTP_M_MERGE</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;INVALID&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a71d21b7fb2b92d098054737faf6a8ce1">HTP_M_INVALID</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a>(method, <span class="stringliteral">&quot;HEAD&quot;</span>) == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a3b7176b278f63570d1cffbcd038a3ed5">HTP_M_HEAD</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a92dc985a5bcb2657195e86e67511fe05">HTP_M_UNKNOWN</a>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment"> * Is the given line empty? This function expects the line to have</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment"> * a terminating LF.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment"> * @param[in] len</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="htp__util_8c.html#aa515e1e25cc42162e95469b4d6c575c9">  219</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#aa515e1e25cc42162e95469b4d6c575c9">htp_is_line_empty</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">if</span> ((len == 1) || ((len == 2) &amp;&amp; (data[0] == <a class="code" href="util-decode-mime_8c.html#a876ce77f3c672c7162658151e648389e">CR</a>))) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;}</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"> * Does line consist entirely of whitespace characters?</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"> * @param[in] len</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a8b599459708fac234b83e8d8fe58b258">  234</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a8b599459708fac234b83e8d8fe58b258">htp_is_line_whitespace</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordtype">size_t</span> i;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>; i++) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">if</span> (!isspace(data[i])) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment"> * Parses Content-Length string (positive decimal number).</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment"> * White space is allowed before and after the number.</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"> * @param[in] b</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"> * @return Content-Length as a number, or -1 on error.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a50d9fb619fe71bfee3ab812d96ba0b6c">  253</a></span>&#160;int64_t <a class="code" href="htp__private_8h.html#a50d9fb619fe71bfee3ab812d96ba0b6c">htp_parse_content_length</a>(<a class="code" href="structbstr__t.html">bstr</a> *b) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__private_8h.html#ae73f7889b2bec1d7c2605c154cc4ecda">htp_parse_positive_integer_whitespace</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(b), <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(b), 10);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment"> * Parses chunk length (positive hexadecimal number). White space is allowed before</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment"> * and after the number. An error will be returned if the chunk length is greater than</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"> * INT32_MAX.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"> * @param[in] len</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"> * @return Chunk length, or a negative number on error.</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="htp__util_8c.html#abe97fa5fa00905db42afe94366adcc6a">  266</a></span>&#160;int64_t <a class="code" href="htp__private_8h.html#abe97fa5fa00905db42afe94366adcc6a">htp_parse_chunked_length</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    int64_t chunk_len = <a class="code" href="htp__private_8h.html#ae73f7889b2bec1d7c2605c154cc4ecda">htp_parse_positive_integer_whitespace</a>(data, len, 16);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span> (chunk_len &lt; 0) <span class="keywordflow">return</span> chunk_len;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> (chunk_len &gt; INT32_MAX) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span> chunk_len;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"> * A somewhat forgiving parser for a positive integer in a given base.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"> * Only LWS is allowed before and after the number.</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> * @param[in] len</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"> * @param[in] base</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"> * @return The parsed number on success; a negative number on error.</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="htp__util_8c.html#ae73f7889b2bec1d7c2605c154cc4ecda">  282</a></span>&#160;int64_t <a class="code" href="htp__private_8h.html#ae73f7889b2bec1d7c2605c154cc4ecda">htp_parse_positive_integer_whitespace</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>, <span class="keywordtype">int</span> base) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (len == 0) <span class="keywordflow">return</span> -1003;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordtype">size_t</span> last_pos;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">size_t</span> pos = 0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// Ignore LWS before</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (<a class="code" href="htp__private_8h.html#a01068fcd4418a90ea81a2ad5e4eb8c81">htp_is_lws</a>(data[pos]))) pos++;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span> (pos == len) <span class="keywordflow">return</span> -1001;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    int64_t r = <a class="code" href="bstr_8c.html#acd57e87870f41cc8fc8c7b5560be2a1f">bstr_util_mem_to_pint</a>(data + pos, len - pos, base, &amp;last_pos);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// Move after the last digit</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    pos += last_pos;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// Ignore LWS after</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">while</span> (pos &lt; len) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="htp__private_8h.html#a01068fcd4418a90ea81a2ad5e4eb8c81">htp_is_lws</a>(data[pos])) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">return</span> -1002;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        pos++;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor">#ifdef HTP_DEBUG</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment"> * Prints one log message to stderr.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"> * @param[in] stream</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"> * @param[in] log</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp__private_8h.html#ac27d9ef825468ab08cf316b9b527a8cc">htp_print_log</a>(FILE *stream, <a class="code" href="structhtp__log__t.html">htp_log_t</a> *log) {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (log-&gt;<a class="code" href="structhtp__log__t.html#ade5d89359f7ae30d63d66b92c884693d">code</a> != 0) {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        fprintf(stream, <span class="stringliteral">&quot;[%d][code %d][file %s][line %d] %s\n&quot;</span>, log-&gt;<a class="code" href="structhtp__log__t.html#a466db643e80ca5a967ece0ce42bb906f">level</a>,</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                log-&gt;<a class="code" href="structhtp__log__t.html#ade5d89359f7ae30d63d66b92c884693d">code</a>, log-&gt;<a class="code" href="structhtp__log__t.html#aef87f204703523c89e095e200e04b904">file</a>, log-&gt;<a class="code" href="structhtp__log__t.html#adf6c388f84a7b470da775e952078e580">line</a>, log-&gt;<a class="code" href="structhtp__log__t.html#addd0658bc5b7e8d6baaa41c4b6be3a2f">msg</a>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        fprintf(stream, <span class="stringliteral">&quot;[%d][file %s][line %d] %s\n&quot;</span>, log-&gt;<a class="code" href="structhtp__log__t.html#a466db643e80ca5a967ece0ce42bb906f">level</a>,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                log-&gt;<a class="code" href="structhtp__log__t.html#aef87f204703523c89e095e200e04b904">file</a>, log-&gt;<a class="code" href="structhtp__log__t.html#adf6c388f84a7b470da775e952078e580">line</a>, log-&gt;<a class="code" href="structhtp__log__t.html#addd0658bc5b7e8d6baaa41c4b6be3a2f">msg</a>);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"> * Records one log message.</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"> * @param[in] connp</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"> * @param[in] file</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"> * @param[in] line</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"> * @param[in] level</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"> * @param[in] code</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"> * @param[in] fmt</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a3eef4d9c98d7bbfbbcb1ff7c5317f3c6">  339</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp_8h.html#a3eef4d9c98d7bbfbbcb1ff7c5317f3c6">htp_log</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line, <span class="keyword">enum</span> <a class="code" href="htp__core_8h.html#ae91a6ad07977423dd1ec14a44156d799">htp_log_level_t</a> level, <span class="keywordtype">int</span> <a class="code" href="decode-icmpv4_8h.html#a966576744a473fafb7687f8e5649941f">code</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (connp == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">char</span> buf[1024];</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    va_list args;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">// Ignore messages below our log level.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a149e19109e4039b3c8dd05f4a4e41a52">cfg</a>-&gt;<a class="code" href="structhtp__cfg__t.html#afdc6cb0089b6fd902db437c5af54e78b">log_level</a> &lt; level) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    va_start(args, fmt);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordtype">int</span> r = vsnprintf(buf, 1024, fmt, args);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    va_end(args);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        snprintf(buf, 1024, <span class="stringliteral">&quot;[vnsprintf returned error %d]&quot;</span>, r);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r &gt;= 1024) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="comment">// Indicate overflow with a &#39;+&#39; at the end.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        buf[1022] = <span class="charliteral">&#39;+&#39;</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        buf[1023] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// Create a new log entry.</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <a class="code" href="structhtp__log__t.html">htp_log_t</a> *log = calloc(1, <span class="keyword">sizeof</span> (<a class="code" href="structhtp__log__t.html">htp_log_t</a>));</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (log == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    log-&gt;<a class="code" href="structhtp__log__t.html#a7aa669dbd0238ed71885f793e475730d">connp</a> = connp;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    log-&gt;<a class="code" href="structhtp__log__t.html#aef87f204703523c89e095e200e04b904">file</a> = file;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    log-&gt;<a class="code" href="structhtp__log__t.html#adf6c388f84a7b470da775e952078e580">line</a> = line;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    log-&gt;<a class="code" href="structhtp__log__t.html#a466db643e80ca5a967ece0ce42bb906f">level</a> = level;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    log-&gt;<a class="code" href="structhtp__log__t.html#ade5d89359f7ae30d63d66b92c884693d">code</a> = <a class="code" href="decode-icmpv4_8h.html#a966576744a473fafb7687f8e5649941f">code</a>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    log-&gt;<a class="code" href="structhtp__log__t.html#addd0658bc5b7e8d6baaa41c4b6be3a2f">msg</a> = strdup(buf);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="htp__list_8h.html#a37f080c122cbc8cd4ddbd676cedb0185">htp_list_add</a>(connp-&gt;<a class="code" href="structhtp__connp__t.html#ab1d498ba10537429d27f879fcc8d85f0">conn</a>-&gt;<a class="code" href="structhtp__conn__t.html#ac79e519e7d829bb187b62a31b104073a">messages</a>, log);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> (level == <a class="code" href="htp__core_8h.html#ae91a6ad07977423dd1ec14a44156d799a92383cf2d26bc4a3f9b32c9d948662a4">HTP_LOG_ERROR</a>) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        connp-&gt;<a class="code" href="structhtp__connp__t.html#af72462e7cec991f85e160c8add033a44">last_error</a> = log;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">    #ifdef HTP_DEBUG</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;[LOG] %s\n&quot;</span>, log-&gt;<a class="code" href="structhtp__log__t.html#addd0658bc5b7e8d6baaa41c4b6be3a2f">msg</a>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">/* coverity[check_return] */</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <a class="code" href="htp__hooks_8c.html#a8981d368a73f78ddfb4ad1de1f4a5fc2">htp_hook_run_all</a>(connp-&gt;<a class="code" href="structhtp__connp__t.html#a149e19109e4039b3c8dd05f4a4e41a52">cfg</a>-&gt;<a class="code" href="structhtp__cfg__t.html#ad71926e0c96be6b4d6ec97e03b133c40">hook_log</a>, log);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"> * Determines if the given line is a continuation (of some previous line).</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment"> * @param[in] len</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"> * @return 0 or 1 for false and true, respectively. Returns -1 on error (NULL pointer or length zero).</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00397"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a6328d9ce315c36afc0a3396f28b482a5">  397</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a6328d9ce315c36afc0a3396f28b482a5">htp_connp_is_line_folded</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> ((data == NULL) || (len == 0)) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__private_8h.html#a9e2d1a484a0504ed6475a9d89a6608a3">htp_is_folding_char</a>(data[0]);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a9e2d1a484a0504ed6475a9d89a6608a3">  402</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a9e2d1a484a0504ed6475a9d89a6608a3">htp_is_folding_char</a>(<span class="keywordtype">int</span> c) {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="htp__private_8h.html#a01068fcd4418a90ea81a2ad5e4eb8c81">htp_is_lws</a>(c)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;}</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"> * Determines if the given line is a request terminator.</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment"> * @param[in] connp</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"> * @param[in] len</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a90ec198a62babe0db3d63024ec9d5118">  415</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a90ec198a62babe0db3d63024ec9d5118">htp_connp_is_line_terminator</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">// Is this the end of request headers?</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">switch</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a149e19109e4039b3c8dd05f4a4e41a52">cfg</a>-&gt;<a class="code" href="structhtp__cfg__t.html#ada885c14dabd8765749681c7924c1c6d">server_personality</a>) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#a3eff80aa5badb10c27d0b40cecd5767ca1ecadf2370e957351fd527ceb3333347">HTP_SERVER_IIS_5_1</a>:</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="comment">// IIS 5 will accept a whitespace line as a terminator</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="htp__private_8h.html#a8b599459708fac234b83e8d8fe58b258">htp_is_line_whitespace</a>(data, len)) {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="comment">// Fall through</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="comment">// Treat an empty line as terminator</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="htp__private_8h.html#aa515e1e25cc42162e95469b4d6c575c9">htp_is_line_empty</a>(data, len)) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;}</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> * Determines if the given line can be ignored when it appears before a request.</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> * @param[in] connp</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> * @param[in] len</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> * @return 0 or 1</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a1497c1d24aca2e016fc04475d48616c7">  444</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a1497c1d24aca2e016fc04475d48616c7">htp_connp_is_line_ignorable</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__private_8h.html#a90ec198a62babe0db3d63024ec9d5118">htp_connp_is_line_terminator</a>(connp, data, len);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;}</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keyword">static</span> <a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> htp_parse_port(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>, <span class="keywordtype">int</span> *port, <span class="keywordtype">int</span> *invalid) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> (len == 0) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        *port = -1;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        *invalid = 1;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    int64_t port_parsed = <a class="code" href="htp__private_8h.html#ae73f7889b2bec1d7c2605c154cc4ecda">htp_parse_positive_integer_whitespace</a>(data, len, 10);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">if</span> (port_parsed &lt; 0) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="comment">// Failed to parse the port number.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        *port = -1;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        *invalid = 1;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((port_parsed &gt; 0) &amp;&amp; (port_parsed &lt; 65536)) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="comment">// Valid port number.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        *port = port_parsed;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="comment">// Port number out of range.</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        *port = -1;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        *invalid = 1;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment"> * Parses an authority string, which consists of a hostname with an optional port number; username</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment"> * and password are not allowed and will not be handled.</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"> * @param[in] hostport</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment"> * @param[out] hostname A bstring containing the hostname, or NULL if the hostname is invalid. If this value</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment"> *                      is not NULL, the caller assumes responsibility for memory management.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment"> * @param[out] port Port as text, or NULL if not provided.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"> * @param[out] port_number Port number, or -1 if the port is not present or invalid.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"> * @param[out] invalid Set to 1 if any part of the authority is invalid.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"> * @return HTP_OK on success, HTP_ERROR on memory allocation failure.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a2502aa8bb90214652d0dadf419db4d53">  485</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#a4159843ae10e6b8161928e6275f6c488">htp_parse_hostport</a>(<a class="code" href="structbstr__t.html">bstr</a> *hostport, <a class="code" href="structbstr__t.html">bstr</a> **hostname, <a class="code" href="structbstr__t.html">bstr</a> **port, <span class="keywordtype">int</span> *port_number, <span class="keywordtype">int</span> *invalid) {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> ((hostport == NULL) || (hostname == NULL) || (port_number == NULL) || (invalid == NULL)) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    *hostname = NULL;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> (port != NULL) {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        *port = NULL;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    *port_number = -1;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    *invalid = 0;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(hostport);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(hostport);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="bstr_8c.html#a91e327898a25d3ade3e38ab1e9d354fe">bstr_util_mem_trim</a>(&amp;data, &amp;len);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> (len == 0) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        *invalid = 1;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">// Check for an IPv6 address.</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span> (data[0] == <span class="charliteral">&#39;[&#39;</span>) {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="comment">// IPv6 host.</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="comment">// Find the end of the IPv6 address.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordtype">size_t</span> pos = 0;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (data[pos] != <span class="charliteral">&#39;]&#39;</span>)) pos++;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span> (pos == len) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            *invalid = 1;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        *hostname = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(data, pos + 1);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">if</span> (*hostname == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">// Over the &#39;]&#39;.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        pos++;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span> (pos == len) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="comment">// Handle port.</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">if</span> (data[pos] == <span class="charliteral">&#39;:&#39;</span>) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keywordflow">if</span> (port != NULL) {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                *port = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(data + pos + 1, len - pos - 1);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                <span class="keywordflow">if</span> (*port == NULL) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(*hostname);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keywordflow">return</span> htp_parse_port(data + pos + 1, len - pos - 1, port_number, invalid);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            *invalid = 1;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="comment">// Not IPv6 host.</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="comment">// Is there a colon?</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *colon = memchr(data, <span class="charliteral">&#39;:&#39;</span>, len);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">if</span> (colon == NULL) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="comment">// Hostname alone, no port.</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            *hostname = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(data, len);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keywordflow">if</span> (*hostname == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <a class="code" href="bstr_8c.html#a8efd20da92a9a40fee8a40bdcdfb194f">bstr_to_lowercase</a>(*hostname);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <span class="comment">// Hostname and port.</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="comment">// Ignore whitespace at the end of hostname.</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *hostend = colon;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="keywordflow">while</span> ((hostend &gt; data) &amp;&amp; (isspace(*(hostend - 1)))) hostend--;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            *hostname = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(data, hostend - data);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">if</span> (*hostname == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">if</span> (port != NULL) {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                *port = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(colon + 1, len - (colon + 1 - data));</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                <span class="keywordflow">if</span> (*port == NULL) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(*hostname);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="keywordflow">return</span> htp_parse_port(colon + 1, len - (colon + 1 - data), port_number, invalid);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        }</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment"> * Parses hostport provided in the URI.</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment"> * @param[in] connp</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment"> * @param[in] hostport</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment"> * @param[in] uri</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment"> * @return HTP_OK on success or HTP_ERROR error.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="htp__util_8c.html#aaef00410cceff9ae804c86f316e425de">  584</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a8fbfa6b24b1c5ffb1f1d9de3d3834c6c">htp_parse_uri_hostport</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp, <a class="code" href="structbstr__t.html">bstr</a> *hostport, <a class="code" href="structhtp__uri__t.html">htp_uri_t</a> *uri) {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordtype">int</span> invalid;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> rc = <a class="code" href="htp__private_8h.html#a4159843ae10e6b8161928e6275f6c488">htp_parse_hostport</a>(hostport, &amp;(uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>), &amp;(uri-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a>), &amp;(uri-&gt;<a class="code" href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">port_number</a>), &amp;invalid);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> (rc != <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">if</span> (invalid) {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        connp-&gt;<a class="code" href="structhtp__connp__t.html#a0d6be360cc9ba3f11d89696e5c9c5640">in_tx</a>-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a217e63fc16a9cb7437ed98be4f8bf4ec">HTP_HOSTU_INVALID</a>;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> != NULL) {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="htp__private_8h.html#a31cca701d490472a8cdb778a6c0e6560">htp_validate_hostname</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>) == 0) {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            connp-&gt;<a class="code" href="structhtp__connp__t.html#a0d6be360cc9ba3f11d89696e5c9c5640">in_tx</a>-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a217e63fc16a9cb7437ed98be4f8bf4ec">HTP_HOSTU_INVALID</a>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;}</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment"> * Parses hostport provided in the Host header.</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment"> * @param[in] hostport</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment"> * @param[out] hostname</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment"> * @param[out] port</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment"> * @param[out] port_number</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment"> * @param[out] flags</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment"> * @return HTP_OK on success or HTP_ERROR error.</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00613"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a05064ef7bee86f676e457bdb121da220">  613</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#a17f65da97005b7ac34881ba9ff83c8da">htp_parse_header_hostport</a>(<a class="code" href="structbstr__t.html">bstr</a> *hostport, <a class="code" href="structbstr__t.html">bstr</a> **hostname, <a class="code" href="structbstr__t.html">bstr</a> **port, <span class="keywordtype">int</span> *port_number, uint64_t *<a class="code" href="app-layer-dns-common_8h.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a>) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordtype">int</span> invalid;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> rc = <a class="code" href="htp__private_8h.html#a4159843ae10e6b8161928e6275f6c488">htp_parse_hostport</a>(hostport, hostname, port, port_number, &amp;invalid);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">if</span> (rc != <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">if</span> (invalid) {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        *flags |= <a class="code" href="htp__core_8h.html#a9026ab5eb9e9d8777cb45a107015cb88">HTP_HOSTH_INVALID</a>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">if</span> (*hostname != NULL) {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="htp__private_8h.html#a31cca701d490472a8cdb778a6c0e6560">htp_validate_hostname</a>(*hostname) == 0) {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            *flags |= <a class="code" href="htp__core_8h.html#a9026ab5eb9e9d8777cb45a107015cb88">HTP_HOSTH_INVALID</a>;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;}</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment"> * Parses request URI, making no attempt to validate the contents.</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment"> * @param[in] input</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment"> * @param[in] uri</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment"> * @return HTP_ERROR on memory allocation failure, HTP_OK otherwise</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00639"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a330b435a16a1f366eed76bf7b7bddba6">  639</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a330b435a16a1f366eed76bf7b7bddba6">htp_parse_uri</a>(<a class="code" href="structbstr__t.html">bstr</a> *input, <a class="code" href="structhtp__uri__t.html">htp_uri_t</a> **uri) {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">// Allow a htp_uri_t structure to be provided on input,</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// but allocate a new one if the structure is NULL.</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (*uri == NULL) {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        *uri = calloc(1, <span class="keyword">sizeof</span> (<a class="code" href="structhtp__uri__t.html">htp_uri_t</a>));</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">if</span> (*uri == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (input == NULL) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="comment">// The input might be NULL on requests that don&#39;t actually</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="comment">// contain the URI. We allow that.</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(input);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(input);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordtype">size_t</span> start, pos;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">if</span> (len == 0) {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="comment">// Empty string.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    pos = 0;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="comment">// Scheme test: if it doesn&#39;t start with a forward slash character (which it must</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="comment">// for the contents to be a path or an authority, then it must be the scheme part</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">if</span> (data[0] != <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment">// Parse scheme        </span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">// Find the colon, which marks the end of the scheme part</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        start = pos;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (data[pos] != <span class="charliteral">&#39;:&#39;</span>)) pos++;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">if</span> (pos &gt;= len) {</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="comment">// We haven&#39;t found a colon, which means that the URI</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            <span class="comment">// is invalid. Apache will ignore this problem and assume</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="comment">// the URI contains an invalid path so, for the time being,</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="comment">// we are going to do the same.</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            pos = 0;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="comment">// Make a copy of the scheme</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            (*uri)-&gt;scheme = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(data + start, pos - start);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="keywordflow">if</span> ((*uri)-&gt;scheme == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="comment">// Go over the colon</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            pos++;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// Authority test: two forward slash characters and it&#39;s an authority.</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// One, three or more slash characters, and it&#39;s a path. We, however,</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">// only attempt to parse authority if we&#39;ve seen a scheme.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">if</span> ((*uri)-&gt;scheme != NULL)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">if</span> ((pos + 2 &lt; len) &amp;&amp; (data[pos] == <span class="charliteral">&#39;/&#39;</span>) &amp;&amp; (data[pos + 1] == <span class="charliteral">&#39;/&#39;</span>) &amp;&amp; (data[pos + 2] != <span class="charliteral">&#39;/&#39;</span>)) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="comment">// Parse authority</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="comment">// Go over the two slash characters</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            start = pos = pos + 2;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="comment">// Authority ends with a question mark, forward slash or hash</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (data[pos] != <span class="charliteral">&#39;?&#39;</span>) &amp;&amp; (data[pos] != <span class="charliteral">&#39;/&#39;</span>) &amp;&amp; (data[pos] != <span class="charliteral">&#39;#&#39;</span>)) pos++;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *hostname_start;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            <span class="keywordtype">size_t</span> hostname_len;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="comment">// Are the credentials included in the authority?</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="flow-hash_8h.html#ae6814922f15fd7bc6376d74714a34a39">m</a> = memchr(data + start, <span class="charliteral">&#39;@&#39;</span>, pos - start);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="keywordflow">if</span> (m != NULL) {</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                <span class="comment">// Credentials present</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *credentials_start = data + start;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                <span class="keywordtype">size_t</span> credentials_len = m - data - start;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                <span class="comment">// Figure out just the hostname part</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                hostname_start = data + start + credentials_len + 1;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                hostname_len = pos - start - credentials_len - 1;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                <span class="comment">// Extract the username and the password</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                m = memchr(credentials_start, <span class="charliteral">&#39;:&#39;</span>, credentials_len);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                <span class="keywordflow">if</span> (m != NULL) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                    <span class="comment">// Username and password</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                    (*uri)-&gt;username = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(credentials_start, m - credentials_start);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                    <span class="keywordflow">if</span> ((*uri)-&gt;username == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                    (*uri)-&gt;password = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(m + 1, credentials_len - (m - credentials_start) - 1);</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                    <span class="keywordflow">if</span> ((*uri)-&gt;password == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                    <span class="comment">// Username alone</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                    (*uri)-&gt;username = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(credentials_start, credentials_len);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                    <span class="keywordflow">if</span> ((*uri)-&gt;username == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                <span class="comment">// No credentials</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                hostname_start = data + start;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                hostname_len = pos - start;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="comment">// Parsing authority without credentials.</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="keywordflow">if</span> ((hostname_len &gt; 0) &amp;&amp; (hostname_start[0] == <span class="charliteral">&#39;[&#39;</span>)) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                <span class="comment">// IPv6 address.</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                m = memchr(hostname_start, <span class="charliteral">&#39;]&#39;</span>, hostname_len);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                <span class="keywordflow">if</span> (m == NULL) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                    <span class="comment">// Invalid IPv6 address; use the entire string as hostname.</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    (*uri)-&gt;hostname = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(hostname_start, hostname_len);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                    <span class="keywordflow">if</span> ((*uri)-&gt;hostname == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                    (*uri)-&gt;hostname = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(hostname_start, m - hostname_start + 1);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                    <span class="keywordflow">if</span> ((*uri)-&gt;hostname == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                    <span class="comment">// Is there a port?</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                    hostname_len = hostname_len - (m - hostname_start + 1);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                    hostname_start = m + 1;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                    <span class="comment">// Port string</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                    m = memchr(hostname_start, <span class="charliteral">&#39;:&#39;</span>, hostname_len);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                    <span class="keywordflow">if</span> (m != NULL) {</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                        <span class="keywordtype">size_t</span> port_len = hostname_len - (m - hostname_start) - 1;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                        (*uri)-&gt;port = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(m + 1, port_len);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        <span class="keywordflow">if</span> ((*uri)-&gt;port == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                    }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                <span class="comment">// Not IPv6 address.</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                m = memchr(hostname_start, <span class="charliteral">&#39;:&#39;</span>, hostname_len);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                <span class="keywordflow">if</span> (m != NULL) {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    <span class="keywordtype">size_t</span> port_len = hostname_len - (m - hostname_start) - 1;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                    hostname_len = hostname_len - port_len - 1;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    <span class="comment">// Port string</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                    (*uri)-&gt;port = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(m + 1, port_len);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                    <span class="keywordflow">if</span> ((*uri)-&gt;port == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                }</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <span class="comment">// Hostname</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                (*uri)-&gt;hostname = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(hostname_start, hostname_len);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                <span class="keywordflow">if</span> ((*uri)-&gt;hostname == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">// Path</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    start = pos;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">// The path part will end with a question mark or a hash character, which</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">// mark the beginning of the query part or the fragment part, respectively.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (data[pos] != <span class="charliteral">&#39;?&#39;</span>) &amp;&amp; (data[pos] != <span class="charliteral">&#39;#&#39;</span>)) pos++;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// Path</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    (*uri)-&gt;path = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(data + start, pos - start);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> ((*uri)-&gt;path == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">if</span> (pos == len) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">// Query</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">if</span> (data[pos] == <span class="charliteral">&#39;?&#39;</span>) {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="comment">// Step over the question mark</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        start = pos + 1;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="comment">// The query part will end with the end of the input</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="comment">// or the beginning of the fragment part</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (data[pos] != <span class="charliteral">&#39;#&#39;</span>)) pos++;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="comment">// Query string</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        (*uri)-&gt;query = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(data + start, pos - start);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">if</span> ((*uri)-&gt;query == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">if</span> (pos == len) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">// Fragment</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">if</span> (data[pos] == <span class="charliteral">&#39;#&#39;</span>) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="comment">// Step over the hash character</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        start = pos + 1;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment">// Fragment; ends with the end of the input</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        (*uri)-&gt;fragment = <a class="code" href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a>(data + start, len - start);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">if</span> ((*uri)-&gt;fragment == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;}</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment"> * Convert two input bytes, pointed to by the pointer parameter,</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment"> * into a single byte by assuming the input consists of hexadecimal</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment"> * characters. This function will happily convert invalid input.</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment"> * @param[in] what</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment"> * @return hex-decoded byte</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> x2c(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *what) {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keyword">register</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> digit;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    digit = (what[0] &gt;= <span class="charliteral">&#39;A&#39;</span> ? ((what[0] &amp; 0xdf) - <span class="charliteral">&#39;A&#39;</span>) + 10 : (what[0] - <span class="charliteral">&#39;0&#39;</span>));</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    digit *= 16;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    digit += (what[1] &gt;= <span class="charliteral">&#39;A&#39;</span> ? ((what[1] &amp; 0xdf) - <span class="charliteral">&#39;A&#39;</span>) + 10 : (what[1] - <span class="charliteral">&#39;0&#39;</span>));</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">return</span> digit;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment"> * Convert a Unicode codepoint into a single-byte, using best-fit</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"> * mapping (as specified in the provided configuration structure).</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment"> * @param[in] cfg</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment"> * @param[in] codepoint</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment"> * @return converted single byte</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="keyword">static</span> uint8_t bestfit_codepoint(<a class="code" href="structhtp__cfg__t.html">htp_cfg_t</a> *cfg, <span class="keyword">enum</span> <a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7">htp_decoder_ctx_t</a> ctx, uint32_t codepoint) {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="comment">// Is it a single-byte codepoint?</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">if</span> (codepoint &lt; 0x100) {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">return</span> (uint8_t) codepoint;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="comment">// Our current implementation converts only the 2-byte codepoints.</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">if</span> (codepoint &gt; 0xffff) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">return</span> cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a31077401671daade7004f6e7b861d4e1">bestfit_replacement_byte</a>;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    uint8_t *p = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a44b968a4b7dab8d2ce22a8bfea1e9426">bestfit_map</a>;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">// TODO Optimize lookup.</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        uint32_t x = (p[0] &lt;&lt; 8) + p[1];</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">if</span> (x == 0) {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <span class="keywordflow">return</span> cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a31077401671daade7004f6e7b861d4e1">bestfit_replacement_byte</a>;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        }</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="keywordflow">if</span> (x == codepoint) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <span class="keywordflow">return</span> p[2];</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="comment">// Move to the next triplet</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        p += 3;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;}</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment"> * Decode a UTF-8 encoded path. Overlong characters will be decoded, invalid</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment"> * characters will be left as-is. Best-fit mapping will be used to convert</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment"> * UTF-8 into a single-byte stream.</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment"> * @param[in] cfg</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment"> * @param[in] tx</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment"> * @param[in] path</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00887"></a><span class="lineno"><a class="line" href="htp__util_8c.html#ac19fd0827df78d7618a6360a0a9e2ac2">  887</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp__private_8h.html#ac19fd0827df78d7618a6360a0a9e2ac2">htp_utf8_decode_path_inplace</a>(<a class="code" href="structhtp__cfg__t.html">htp_cfg_t</a> *cfg, <a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx, <a class="code" href="structbstr__t.html">bstr</a> *path) {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keywordflow">if</span> (path == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    uint8_t *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(path);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">if</span> (data == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(path);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordtype">size_t</span> rpos = 0;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordtype">size_t</span> wpos = 0;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    uint32_t codepoint = 0;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    uint32_t state = <a class="code" href="htp__utf8__decoder_8h.html#a4dcc8ba6832f29af88388db20305477e">HTP_UTF8_ACCEPT</a>;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    uint32_t counter = 0;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    uint8_t seen_valid = 0;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">while</span> ((rpos &lt; len)&amp;&amp;(wpos &lt; len)) {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        counter++;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="htp__utf8__decoder_8c.html#a3b58cd9823df2a9e86e3a730a6c922b3">htp_utf8_decode_allow_overlong</a>(&amp;state, &amp;codepoint, data[rpos])) {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="htp__utf8__decoder_8h.html#a4dcc8ba6832f29af88388db20305477e">HTP_UTF8_ACCEPT</a>:</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                <span class="keywordflow">if</span> (counter == 1) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                    <span class="comment">// ASCII character, which we just copy.</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                    data[wpos++] = (uint8_t) codepoint;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                    <span class="comment">// A valid UTF-8 character, which we need to convert.</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                    seen_valid = 1;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                    <span class="comment">// Check for overlong characters and set the flag accordingly.</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                    <span class="keywordflow">switch</span> (counter) {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                            <span class="keywordflow">if</span> (codepoint &lt; 0x80) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ab715e1a7cc106d09642691072554e41f">HTP_PATH_UTF8_OVERLONG</a>;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                            }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                        <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                            <span class="keywordflow">if</span> (codepoint &lt; 0x800) {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ab715e1a7cc106d09642691072554e41f">HTP_PATH_UTF8_OVERLONG</a>;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                            }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                        <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                            <span class="keywordflow">if</span> (codepoint &lt; 0x10000) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ab715e1a7cc106d09642691072554e41f">HTP_PATH_UTF8_OVERLONG</a>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                            }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                    }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                    <span class="comment">// Special flag for half-width/full-width evasion.</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                    <span class="keywordflow">if</span> ((codepoint &gt;= 0xff00) &amp;&amp; (codepoint &lt;= 0xffef)) {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ae0669683ca6ccd3e29f48fcab704a520">HTP_PATH_HALF_FULL_RANGE</a>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                    }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                    <span class="comment">// Use best-fit mapping to convert to a single byte.</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                    data[wpos++] = bestfit_codepoint(cfg, <a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>, codepoint);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                }</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                <span class="comment">// Advance over the consumed byte and reset the byte counter.</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                rpos++;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                counter = 0;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="htp__utf8__decoder_8h.html#a785b0131fc5daa64da44e99fed2ea8bb">HTP_UTF8_REJECT</a>:</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                <span class="comment">// Invalid UTF-8 character.</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a8338230c0230fa62aeed6c670215aeed">HTP_PATH_UTF8_INVALID</a>;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                <span class="comment">// Is the server expected to respond with 400?</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0ed8fcf196229f20d38fdd0182ef4850">utf8_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                    tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0ed8fcf196229f20d38fdd0182ef4850">utf8_invalid_unwanted</a>;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                <span class="comment">// Output the replacement byte, replacing one or more invalid bytes.</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                data[wpos++] = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a31077401671daade7004f6e7b861d4e1">bestfit_replacement_byte</a>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                <span class="comment">// If the invalid byte was first in a sequence, consume it. Otherwise,</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                <span class="comment">// assume it&#39;s the starting byte of the next character.</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                <span class="keywordflow">if</span> (counter == 1) {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                    rpos++;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                }</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                <span class="comment">// Reset the decoder state and continue decoding.</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                state = <a class="code" href="htp__utf8__decoder_8h.html#a4dcc8ba6832f29af88388db20305477e">HTP_UTF8_ACCEPT</a>;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                codepoint = 0;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                counter = 0;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                <span class="comment">// Keep going; the character is not yet formed.</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                rpos++;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">// Did the input stream seem like a valid UTF-8 string?</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span> ((seen_valid) &amp;&amp; (!(tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> &amp; <a class="code" href="htp__core_8h.html#a8338230c0230fa62aeed6c670215aeed">HTP_PATH_UTF8_INVALID</a>))) {</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a2f632f5c23ad47276a8deb2e94c4c4a2">HTP_PATH_UTF8_VALID</a>;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// Adjust the length of the string, because</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// we&#39;re doing in-place decoding.</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(path, wpos);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;}</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment"> * Validate a path that is quite possibly UTF-8 encoded.</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment"> * @param[in] tx</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment"> * @param[in] path</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00997"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a75ad702e0957be72f80dc27900f83ec7">  997</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp__private_8h.html#a75ad702e0957be72f80dc27900f83ec7">htp_utf8_validate_path</a>(<a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx, <a class="code" href="structbstr__t.html">bstr</a> *path) {</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(path);</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(path);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordtype">size_t</span> rpos = 0;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    uint32_t codepoint = 0;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    uint32_t state = <a class="code" href="htp__utf8__decoder_8h.html#a4dcc8ba6832f29af88388db20305477e">HTP_UTF8_ACCEPT</a>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    uint32_t counter = 0; <span class="comment">// How many bytes used by a UTF-8 character.</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    uint8_t seen_valid = 0;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">while</span> (rpos &lt; len) {</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        counter++;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="htp__utf8__decoder_8c.html#a3b58cd9823df2a9e86e3a730a6c922b3">htp_utf8_decode_allow_overlong</a>(&amp;state, &amp;codepoint, data[rpos])) {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="htp__utf8__decoder_8h.html#a4dcc8ba6832f29af88388db20305477e">HTP_UTF8_ACCEPT</a>:</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                <span class="comment">// We have a valid character.</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                <span class="keywordflow">if</span> (counter &gt; 1) {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                    <span class="comment">// A valid UTF-8 character, consisting of 2 or more bytes.</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                    seen_valid = 1;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                    <span class="comment">// Check for overlong characters and set the flag accordingly.</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                    <span class="keywordflow">switch</span> (counter) {</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                            <span class="keywordflow">if</span> (codepoint &lt; 0x80) {</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ab715e1a7cc106d09642691072554e41f">HTP_PATH_UTF8_OVERLONG</a>;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                            }</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                        <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                            <span class="keywordflow">if</span> (codepoint &lt; 0x800) {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ab715e1a7cc106d09642691072554e41f">HTP_PATH_UTF8_OVERLONG</a>;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                            }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                        <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                            <span class="keywordflow">if</span> (codepoint &lt; 0x10000) {</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ab715e1a7cc106d09642691072554e41f">HTP_PATH_UTF8_OVERLONG</a>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                            }</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                    }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                }</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                <span class="comment">// Special flag for half-width/full-width evasion.</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                <span class="keywordflow">if</span> ((codepoint &gt; 0xfeff) &amp;&amp; (codepoint &lt; 0x010000)) {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                    tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ae0669683ca6ccd3e29f48fcab704a520">HTP_PATH_HALF_FULL_RANGE</a>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                <span class="comment">// Advance over the consumed byte and reset the byte counter.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                rpos++;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                counter = 0;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="htp__utf8__decoder_8h.html#a785b0131fc5daa64da44e99fed2ea8bb">HTP_UTF8_REJECT</a>:</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                <span class="comment">// Invalid UTF-8 character.</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a8338230c0230fa62aeed6c670215aeed">HTP_PATH_UTF8_INVALID</a>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                <span class="comment">// Override the decoder state because we want to continue decoding.</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                state = <a class="code" href="htp__utf8__decoder_8h.html#a4dcc8ba6832f29af88388db20305477e">HTP_UTF8_ACCEPT</a>;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                <span class="comment">// Advance over the consumed byte and reset the byte counter.</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                rpos++;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                counter = 0;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                <span class="comment">// Keep going; the character is not yet formed.</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                rpos++;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// Did the input stream seem like a valid UTF-8 string?</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">if</span> ((seen_valid) &amp;&amp; (!(tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> &amp; <a class="code" href="htp__core_8h.html#a8338230c0230fa62aeed6c670215aeed">HTP_PATH_UTF8_INVALID</a>))) {</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a2f632f5c23ad47276a8deb2e94c4c4a2">HTP_PATH_UTF8_VALID</a>;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;}</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment"> * Decode a %u-encoded character, using best-fit mapping as necessary. Path version.</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment"> * @param[in] cfg</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment"> * @param[in] tx</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"> * @return decoded byte</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> decode_u_encoding_path(<a class="code" href="structhtp__cfg__t.html">htp_cfg_t</a> *cfg, <a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data) {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c1 = x2c(data);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c2 = x2c(data + 2);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordtype">int</span> r = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a31077401671daade7004f6e7b861d4e1">bestfit_replacement_byte</a>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">if</span> (c1 == 0x00) {</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        r = c2;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a4f4f65a8a4c41dfdb78b6b212f4d22a5">HTP_PATH_OVERLONG_U</a>;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="comment">// Check for fullwidth form evasion</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="keywordflow">if</span> (c1 == 0xff) {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#ae0669683ca6ccd3e29f48fcab704a520">HTP_PATH_HALF_FULL_RANGE</a>;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a5e2d5eef1be3af382b6f6f15973eb8c8">u_encoding_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a5e2d5eef1be3af382b6f6f15973eb8c8">u_encoding_unwanted</a>;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        <span class="comment">// Use best-fit mapping</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a44b968a4b7dab8d2ce22a8bfea1e9426">bestfit_map</a>;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <span class="comment">// TODO Optimize lookup.</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            <span class="comment">// Have we reached the end of the map?</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            <span class="keywordflow">if</span> ((p[0] == 0) &amp;&amp; (p[1] == 0)) {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            }</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            <span class="comment">// Have we found the mapping we&#39;re looking for?</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <span class="keywordflow">if</span> ((p[0] == c1) &amp;&amp; (p[1] == c2)) {</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                r = p[2];</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            }</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            <span class="comment">// Move to the next triplet</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            p += 3;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        }</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="comment">// Check for encoded path separators</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">if</span> ((r == <span class="charliteral">&#39;/&#39;</span>) || ((cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a696577213f6aa9447ac43e23868a2cd4">backslash_convert_slashes</a>) &amp;&amp; (r == <span class="charliteral">&#39;\\&#39;</span>))) {</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a2a53678e20da792418ead2158fc695a2">HTP_PATH_ENCODED_SEPARATOR</a>;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    }</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;}</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment"> * Decode a %u-encoded character, using best-fit mapping as necessary. Params version.</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment"> * @param[in] cfg</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment"> * @param[in] tx</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment"> * @return decoded byte</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> decode_u_encoding_params(<a class="code" href="structhtp__cfg__t.html">htp_cfg_t</a> *cfg, <span class="keyword">enum</span> <a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7">htp_decoder_ctx_t</a> ctx, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data, uint64_t *<a class="code" href="app-layer-dns-common_8h.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a>) {</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c1 = x2c(data);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c2 = x2c(data + 2);</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">// Check for overlong usage first.</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">if</span> (c1 == 0) {</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        (*flags) |= <a class="code" href="htp__core_8h.html#ab0c0690917a1e9cb06dd3d95e0911624">HTP_URLEN_OVERLONG_U</a>;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="keywordflow">return</span> c2;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    }</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// Both bytes were used.</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="comment">// Detect half-width and full-width range.</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">if</span> ((c1 == 0xff) &amp;&amp; (c2 &lt;= 0xef)) {</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        (*flags) |= <a class="code" href="htp__core_8h.html#a60f2248ce81643c7838f340e9c6edd41">HTP_URLEN_HALF_FULL_RANGE</a>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    }</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="comment">// Use best-fit mapping.</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a44b968a4b7dab8d2ce22a8bfea1e9426">bestfit_map</a>;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">int</span> r = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a31077401671daade7004f6e7b861d4e1">bestfit_replacement_byte</a>;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="comment">// TODO Optimize lookup.</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="comment">// Have we reached the end of the map?</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="keywordflow">if</span> ((p[0] == 0) &amp;&amp; (p[1] == 0)) {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <span class="comment">// Have we found the mapping we&#39;re looking for?</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">if</span> ((p[0] == c1) &amp;&amp; (p[1] == c2)) {</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            r = p[2];</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        }</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="comment">// Move to the next triplet</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        p += 3;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    }</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;}</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment"> * Decode a request path according to the settings in the</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment"> * provided configuration structure.</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment"> * @param[in] cfg</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment"> * @param[in] tx</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment"> * @param[in] path</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a70e79f229a542a4d99c89680d39217e2"> 1190</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#a854ce501c5216103458afecdadb82d0b">htp_decode_path_inplace</a>(<a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx, <a class="code" href="structbstr__t.html">bstr</a> *path) {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordflow">if</span> (path == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(path);</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordflow">if</span> (data == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(path);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <a class="code" href="structhtp__cfg__t.html">htp_cfg_t</a> *cfg = tx-&gt;<a class="code" href="structhtp__tx__t.html#a85c2f3e758ff6154994c62f3ff92ea8c">cfg</a>;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordtype">size_t</span> rpos = 0;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordtype">size_t</span> wpos = 0;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordtype">int</span> previous_was_separator = 0;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">while</span> ((rpos &lt; len) &amp;&amp; (wpos &lt; len)) {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="keywordtype">int</span> c = data[rpos];</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="comment">// Decode encoded characters</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;%&#39;</span>) {</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            <span class="keywordflow">if</span> (rpos + 2 &lt; len) {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                <span class="keywordtype">int</span> handled = 0;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a4aafb55d5aa8359ecafbe92234ba5d4c">u_encoding_decode</a>) {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                    <span class="comment">// Check for the %u encoding</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                    <span class="keywordflow">if</span> ((data[rpos + 1] == <span class="charliteral">&#39;u&#39;</span>) || (data[rpos + 1] == <span class="charliteral">&#39;U&#39;</span>)) {</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                        handled = 1;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                        <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a5e2d5eef1be3af382b6f6f15973eb8c8">u_encoding_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                            tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a5e2d5eef1be3af382b6f6f15973eb8c8">u_encoding_unwanted</a>;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                        }</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                        <span class="keywordflow">if</span> (rpos + 5 &lt; len) {</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                            <span class="keywordflow">if</span> (isxdigit(data[rpos + 2]) &amp;&amp; (isxdigit(data[rpos + 3]))</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                                    &amp;&amp; isxdigit(data[rpos + 4]) &amp;&amp; (isxdigit(data[rpos + 5]))) {</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                                <span class="comment">// Decode a valid %u encoding</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                                c = decode_u_encoding_path(cfg, tx, &amp;data[rpos + 2]);</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                                rpos += 6;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                                <span class="keywordflow">if</span> (c == 0) {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                                    tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#afdc5297283d3fac7eb14fe5e54ca9553">HTP_PATH_ENCODED_NUL</a>;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                                    <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#af2867984e3c4b7b92a054f94061cf73a">nul_encoded_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                                        tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#af2867984e3c4b7b92a054f94061cf73a">nul_encoded_unwanted</a>;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                                    }</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                                }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                                <span class="comment">// Invalid %u encoding</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a17e335bbeacf0c059472ae8e68c38d6c">HTP_PATH_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                                    tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                                }</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                                <span class="keywordflow">switch</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">url_encoding_invalid_handling</a>) {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a>:</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                                        <span class="comment">// Do not place anything in output; eat</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                                        <span class="comment">// the percent character</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                                        rpos++;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a>:</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                                        <span class="comment">// Leave the percent character in output</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                                        rpos++;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a>:</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                                        <span class="comment">// Decode invalid %u encoding</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                                        c = decode_u_encoding_path(cfg, tx, &amp;data[rpos + 2]);</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                                        rpos += 6;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                                }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                            }</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                            <span class="comment">// Invalid %u encoding (not enough data)</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                            tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a17e335bbeacf0c059472ae8e68c38d6c">HTP_PATH_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                            <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a>;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                            }</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                            <span class="keywordflow">switch</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">url_encoding_invalid_handling</a>) {</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                                <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a>:</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                                    <span class="comment">// Do not place anything in output; eat</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                                    <span class="comment">// the percent character</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                                    rpos++;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                                <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a>:</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                                    <span class="comment">// Leave the percent character in output</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                                    rpos++;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                                <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a>:</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                                    <span class="comment">// Cannot decode, because there&#39;s not enough data.</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                                    <span class="comment">// Leave the percent character in output</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                                    rpos++;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                                    <span class="comment">// TODO Configurable handling.</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                            }</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                        }</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                    }</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                <span class="comment">// Handle standard URL encoding</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                <span class="keywordflow">if</span> (!handled) {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                    <span class="keywordflow">if</span> ((isxdigit(data[rpos + 1])) &amp;&amp; (isxdigit(data[rpos + 2]))) {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                        c = x2c(&amp;data[rpos + 1]);</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                        <span class="keywordflow">if</span> (c == 0) {</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                            tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#afdc5297283d3fac7eb14fe5e54ca9553">HTP_PATH_ENCODED_NUL</a>;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                            <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#af2867984e3c4b7b92a054f94061cf73a">nul_encoded_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#af2867984e3c4b7b92a054f94061cf73a">nul_encoded_unwanted</a>;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                            }</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                            <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a8ee53a3dfd348707aebc68e90365a248">nul_encoded_terminates</a>) {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                                <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(path, wpos);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                            }</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                        }</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                        <span class="keywordflow">if</span> ((c == <span class="charliteral">&#39;/&#39;</span>) || ((cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a696577213f6aa9447ac43e23868a2cd4">backslash_convert_slashes</a>) &amp;&amp; (c == <span class="charliteral">&#39;\\&#39;</span>))) {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                            tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a2a53678e20da792418ead2158fc695a2">HTP_PATH_ENCODED_SEPARATOR</a>;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                            <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a869b6cff889d549e19407b4be4ee979f">path_separators_encoded_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                                tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a869b6cff889d549e19407b4be4ee979f">path_separators_encoded_unwanted</a>;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                            }</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                            <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#abdb73dfb0c905f7d031e665f1089a701">path_separators_decode</a>) {</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                                <span class="comment">// Decode</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                                rpos += 3;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                                <span class="comment">// Leave encoded</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                                c = <span class="charliteral">&#39;%&#39;</span>;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                                rpos++;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                            }</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                            <span class="comment">// Decode</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                            rpos += 3;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                        }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                        <span class="comment">// Invalid encoding</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a17e335bbeacf0c059472ae8e68c38d6c">HTP_PATH_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                        <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                            tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a>;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                        }</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                        <span class="keywordflow">switch</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">url_encoding_invalid_handling</a>) {</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                            <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a>:</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                <span class="comment">// Do not place anything in output; eat</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                                <span class="comment">// the percent character</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                                rpos++;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                            <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a>:</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                                <span class="comment">// Leave the percent character in output</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                                rpos++;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                            <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a>:</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                                <span class="comment">// Decode</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                                c = x2c(&amp;data[rpos + 1]);</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                                rpos += 3;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                                <span class="comment">// Note: What if an invalid encoding decodes into a path</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                                <span class="comment">//       separator? This is theoretical at the moment, because</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                                <span class="comment">//       the only platform we know doesn&#39;t convert separators is</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                                <span class="comment">//       Apache, who will also respond with 400 if invalid encoding</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                                <span class="comment">//       is encountered. Thus no check for a separator here.</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                                <span class="comment">// Unknown setting</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                        }</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                    }</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                }</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                <span class="comment">// Invalid URL encoding (not enough data)</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a17e335bbeacf0c059472ae8e68c38d6c">HTP_PATH_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                    tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a>;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                <span class="keywordflow">switch</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">url_encoding_invalid_handling</a>) {</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a>:</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                        <span class="comment">// Do not place anything in output; eat</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                        <span class="comment">// the percent character</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                        rpos++;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a>:</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                        <span class="comment">// Leave the percent character in output</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                        rpos++;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a>:</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                        <span class="comment">// Cannot decode, because there&#39;s not enough data.</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                        <span class="comment">// Leave the percent character in output.</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                        <span class="comment">// TODO Configurable handling.</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                        rpos++;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                }</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;            <span class="comment">// One non-encoded character</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            <span class="comment">// Is it a NUL byte?</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            <span class="keywordflow">if</span> (c == 0) {</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a9ba29c5eb2face4f71ad70f8b82310bf">nul_raw_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                    tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a9ba29c5eb2face4f71ad70f8b82310bf">nul_raw_unwanted</a>;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                }</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a31d679e535beab8e244d3963dec854b4">nul_raw_terminates</a>) {</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                    <span class="comment">// Terminate path with a raw NUL byte</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(path, wpos);</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                }</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;            }</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            rpos++;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="comment">// Place the character into output</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <span class="comment">// Check for control characters</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <span class="keywordflow">if</span> (c &lt; 0x20) {</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;            <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a10f58340e03382163926d59854b0f6f7">control_chars_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a> = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a10f58340e03382163926d59854b0f6f7">control_chars_unwanted</a>;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            }</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        }</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        <span class="comment">// Convert backslashes to forward slashes, if necessary</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="keywordflow">if</span> ((c == <span class="charliteral">&#39;\\&#39;</span>) &amp;&amp; (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a696577213f6aa9447ac43e23868a2cd4">backslash_convert_slashes</a>)) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;            c = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;        }</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        <span class="comment">// Lowercase characters, if necessary</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#adc66e044548690751da36c57d91eefa6">convert_lowercase</a>) {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            c = tolower(c);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        }</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="comment">// If we&#39;re compressing separators then we need</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="comment">// to track if the previous character was a separator</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a4b8f9f64f8e70a6b5bd087697f4ed4d3">path_separators_compress</a>) {</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                <span class="keywordflow">if</span> (!previous_was_separator) {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                    data[wpos++] = c;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                    previous_was_separator = 1;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                    <span class="comment">// Do nothing; we don&#39;t want</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                    <span class="comment">// another separator in output</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                }</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                data[wpos++] = c;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                previous_was_separator = 0;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            }</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            data[wpos++] = c;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    }</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(path, wpos);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;}</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div>
<div class="line"><a name="l01454"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a14e44933747475b68b36ea4b4ec7f1eb"> 1454</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#a14e44933747475b68b36ea4b4ec7f1eb">htp_tx_urldecode_uri_inplace</a>(<a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx, <a class="code" href="structbstr__t.html">bstr</a> *input) {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    uint64_t flags = 0;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> rc = <a class="code" href="htp_8h.html#a6a6849d2b4e2477402760923aae8d527">htp_urldecode_inplace_ex</a>(tx-&gt;<a class="code" href="structhtp__tx__t.html#a85c2f3e758ff6154994c62f3ff92ea8c">cfg</a>, <a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>, input, &amp;flags, &amp;(tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a>));</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="htp__core_8h.html#a92330c44fc5fe0ceb6fcd0d343b763b3">HTP_URLEN_INVALID_ENCODING</a>) {</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a17e335bbeacf0c059472ae8e68c38d6c">HTP_PATH_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    }</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="htp__core_8h.html#a0fe750fdf2e0ce6959db17e50efa0647">HTP_URLEN_ENCODED_NUL</a>) {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#afdc5297283d3fac7eb14fe5e54ca9553">HTP_PATH_ENCODED_NUL</a>;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    }</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="htp__core_8h.html#acd8a1fab81f3886fd6c03201296e28f1">HTP_URLEN_RAW_NUL</a>) {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a74b925fb9a95391ab69210d1acba5534">HTP_PATH_RAW_NUL</a>;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    }</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;}</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div>
<div class="line"><a name="l01474"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a3290cc3c0233d21dd5c3e8e97883ea18"> 1474</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#a3290cc3c0233d21dd5c3e8e97883ea18">htp_tx_urldecode_params_inplace</a>(<a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx, <a class="code" href="structbstr__t.html">bstr</a> *input) {</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp_8h.html#a6a6849d2b4e2477402760923aae8d527">htp_urldecode_inplace_ex</a>(tx-&gt;<a class="code" href="structhtp__tx__t.html#a85c2f3e758ff6154994c62f3ff92ea8c">cfg</a>, <a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7acdbfd6b6cfbe4f7a15fd27a19091685a">HTP_DECODER_URLENCODED</a>, input, &amp;(tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a>), &amp;(tx-&gt;<a class="code" href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">response_status_expected_number</a>));</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;}</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div>
<div class="line"><a name="l01478"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a2a01a96c537538cdefec78b9628b5e93"> 1478</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp_8h.html#a2a01a96c537538cdefec78b9628b5e93">htp_urldecode_inplace</a>(<a class="code" href="structhtp__cfg__t.html">htp_cfg_t</a> *cfg, <span class="keyword">enum</span> <a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7">htp_decoder_ctx_t</a> ctx, <a class="code" href="structbstr__t.html">bstr</a> *input, uint64_t *flags) {</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keywordtype">int</span> expected_status_code = 0;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp_8h.html#a6a6849d2b4e2477402760923aae8d527">htp_urldecode_inplace_ex</a>(cfg, ctx, input, flags, &amp;expected_status_code);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;}</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div>
<div class="line"><a name="l01483"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a6a6849d2b4e2477402760923aae8d527"> 1483</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp_8h.html#a6a6849d2b4e2477402760923aae8d527">htp_urldecode_inplace_ex</a>(<a class="code" href="structhtp__cfg__t.html">htp_cfg_t</a> *cfg, <span class="keyword">enum</span> <a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7">htp_decoder_ctx_t</a> ctx, <a class="code" href="structbstr__t.html">bstr</a> *input, uint64_t *flags, <span class="keywordtype">int</span> *expected_status_code) {</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">if</span> (input == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(input);</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keywordflow">if</span> (data == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(input);</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="keywordtype">size_t</span> rpos = 0;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordtype">size_t</span> wpos = 0;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="keywordflow">while</span> ((rpos &lt; len) &amp;&amp; (wpos &lt; len)) {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <span class="keywordtype">int</span> c = data[rpos];</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        <span class="comment">// Decode encoded characters.</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;%&#39;</span>) {</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            <span class="comment">// Need at least 2 additional bytes for %HH.</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            <span class="keywordflow">if</span> (rpos + 2 &lt; len) {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                <span class="keywordtype">int</span> handled = 0;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                <span class="comment">// Decode %uHHHH encoding, but only if allowed in configuration.</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a4aafb55d5aa8359ecafbe92234ba5d4c">u_encoding_decode</a>) {</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                    <span class="comment">// The next character must be a case-insensitive u.</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                    <span class="keywordflow">if</span> ((data[rpos + 1] == <span class="charliteral">&#39;u&#39;</span>) || (data[rpos + 1] == <span class="charliteral">&#39;U&#39;</span>)) {</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                        handled = 1;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                        <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a5e2d5eef1be3af382b6f6f15973eb8c8">u_encoding_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                            (*expected_status_code) = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a5e2d5eef1be3af382b6f6f15973eb8c8">u_encoding_unwanted</a>;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                        }</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                        <span class="comment">// Need at least 5 additional bytes for %uHHHH.</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                        <span class="keywordflow">if</span> (rpos + 5 &lt; len) {</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                            <span class="keywordflow">if</span> (isxdigit(data[rpos + 2]) &amp;&amp; (isxdigit(data[rpos + 3]))</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                                    &amp;&amp; isxdigit(data[rpos + 4]) &amp;&amp; (isxdigit(data[rpos + 5]))) {</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                                <span class="comment">// Decode a valid %u encoding.</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                                c = decode_u_encoding_params(cfg, ctx, &amp;(data[rpos + 2]), flags);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                                rpos += 6;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                                <span class="comment">// Invalid %u encoding (could not find 4 xdigits).</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                                (*flags) |= <a class="code" href="htp__core_8h.html#a92330c44fc5fe0ceb6fcd0d343b763b3">HTP_URLEN_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                                    (*expected_status_code) = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a>;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;                                }</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                                <span class="keywordflow">switch</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">url_encoding_invalid_handling</a>) {</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a>:</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                                        <span class="comment">// Do not place anything in output; consume the %.</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                                        rpos++;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;                                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a>:</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                                        <span class="comment">// Leave the % in output.</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                                        rpos++;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a>:</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                                        <span class="comment">// Decode invalid %u encoding.</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                                        c = decode_u_encoding_params(cfg, ctx, &amp;(data[rpos + 2]), flags);</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                                        rpos += 6;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                                }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                            }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                            <span class="comment">// Invalid %u encoding; not enough data.</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;                            (*flags) |= <a class="code" href="htp__core_8h.html#a92330c44fc5fe0ceb6fcd0d343b763b3">HTP_URLEN_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                            <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;                                (*expected_status_code) = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a>;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;                            }</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                            <span class="keywordflow">switch</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">url_encoding_invalid_handling</a>) {</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                                <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a>:</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                                    <span class="comment">// Do not place anything in output; consume the %.</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                                    rpos++;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                                <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a>:</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                                    <span class="comment">// Leave the % in output.</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                                    rpos++;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                                <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a>:</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                                    <span class="comment">// Cannot decode because there&#39;s not enough data.</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                                    <span class="comment">// Leave the % in output.</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                                    <span class="comment">// TODO Configurable handling of %, u, etc.</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                                    rpos++;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                            }</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                        }</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                    }</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                }</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                <span class="comment">// Handle standard URL encoding.</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                <span class="keywordflow">if</span> (!handled) {</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                    <span class="comment">// Need 2 hexadecimal digits.</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                    <span class="keywordflow">if</span> ((isxdigit(data[rpos + 1])) &amp;&amp; (isxdigit(data[rpos + 2]))) {</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                        <span class="comment">// Decode %HH encoding.</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                        c = x2c(&amp;(data[rpos + 1]));</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                        rpos += 3;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                        <span class="comment">// Invalid encoding (enough bytes, but not hexadecimal digits).</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                        (*flags) |= <a class="code" href="htp__core_8h.html#a92330c44fc5fe0ceb6fcd0d343b763b3">HTP_URLEN_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                        <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                            (*expected_status_code) = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a>;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                        }</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                        <span class="keywordflow">switch</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">url_encoding_invalid_handling</a>) {</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                            <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a>:</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                                <span class="comment">// Do not place anything in output; consume the %.</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                                rpos++;</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                            <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a>:</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                                <span class="comment">// Leave the % in output.</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                                rpos++;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                            <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a>:</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                                <span class="comment">// Decode.</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                                c = x2c(&amp;(data[rpos + 1]));</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                                rpos += 3;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                        }</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                    }</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                <span class="comment">// Invalid encoding; not enough data (at least 2 bytes required).</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                (*flags) |= <a class="code" href="htp__core_8h.html#a92330c44fc5fe0ceb6fcd0d343b763b3">HTP_URLEN_INVALID_ENCODING</a>;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                    (*expected_status_code) = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">url_encoding_invalid_unwanted</a>;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                }</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                <span class="keywordflow">switch</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">url_encoding_invalid_handling</a>) {</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a>:</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                        <span class="comment">// Do not place anything in output; consume the %.</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                        rpos++;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a>:</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                        <span class="comment">// Leave the % in output.</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                        rpos++;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                    <span class="keywordflow">case</span> <a class="code" href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a>:</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                        <span class="comment">// Cannot decode because there&#39;s not enough data.</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                        <span class="comment">// Leave the % in output.</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                        <span class="comment">// TODO Configurable handling of %, etc.</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                        rpos++;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                }</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;            }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            <span class="comment">// Did we get an encoded NUL byte?</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            <span class="keywordflow">if</span> (c == 0) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#af2867984e3c4b7b92a054f94061cf73a">nul_encoded_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                    (*expected_status_code) = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#af2867984e3c4b7b92a054f94061cf73a">nul_encoded_unwanted</a>;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                }</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                (*flags) |= <a class="code" href="htp__core_8h.html#a0fe750fdf2e0ce6959db17e50efa0647">HTP_URLEN_ENCODED_NUL</a>;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a8ee53a3dfd348707aebc68e90365a248">nul_encoded_terminates</a>) {</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                    <span class="comment">// Terminate the path at the raw NUL byte.</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(input, wpos);</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                }</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;            }</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            data[wpos++] = c;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;+&#39;</span>) {</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            <span class="comment">// Decoding of the plus character is conditional on the configuration.</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;            <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a678897d56f146a6fee52fb8a49287943">plusspace_decode</a>) {</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                c = 0x20;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            }</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;            rpos++;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            data[wpos++] = c;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;            <span class="comment">// One non-encoded byte.</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            <span class="comment">// Did we get a raw NUL byte?</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;            <span class="keywordflow">if</span> (c == 0) {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a9ba29c5eb2face4f71ad70f8b82310bf">nul_raw_unwanted</a> != <a class="code" href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a>) {</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                    (*expected_status_code) = cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a9ba29c5eb2face4f71ad70f8b82310bf">nul_raw_unwanted</a>;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                (*flags) |= <a class="code" href="htp__core_8h.html#acd8a1fab81f3886fd6c03201296e28f1">HTP_URLEN_RAW_NUL</a>;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[ctx].<a class="code" href="structhtp__decoder__cfg__t.html#a31d679e535beab8e244d3963dec854b4">nul_raw_terminates</a>) {</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                    <span class="comment">// Terminate the path at the encoded NUL byte.</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(input, wpos);</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                }</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            }</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;            rpos++;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            data[wpos++] = c;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        }</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    }</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(input, wpos);</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;}</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="comment"> * Normalize a previously-parsed request URI.</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="comment"> * @param[in] connp</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment"> * @param[in] incomplete</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment"> * @param[in] normalized</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="comment"> * @return HTP_OK or HTP_ERROR</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a227804ea2d625f14c44e423326042f9a"> 1694</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a0b18b82f32e1f78aede068a2aafc4632">htp_normalize_parsed_uri</a>(<a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx, <a class="code" href="structhtp__uri__t.html">htp_uri_t</a> *incomplete, <a class="code" href="structhtp__uri__t.html">htp_uri_t</a> *normalized) {</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="comment">// Scheme.</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <span class="keywordflow">if</span> (incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a> != NULL) {</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="comment">// Duplicate and convert to lowercase.</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        normalized-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a> = <a class="code" href="bstr_8c.html#ad866778a2b2da1cee5a668f7e3bb99de">bstr_dup_lower</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a>);</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="keywordflow">if</span> (normalized-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a> == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    }</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="comment">// Username.</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <span class="keywordflow">if</span> (incomplete-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a> != NULL) {</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        normalized-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a> = <a class="code" href="bstr_8c.html#ab4fc824d8df74ad6863a085f3901d30f">bstr_dup</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a>);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        <span class="keywordflow">if</span> (normalized-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a> == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        <a class="code" href="htp__private_8h.html#a14e44933747475b68b36ea4b4ec7f1eb">htp_tx_urldecode_uri_inplace</a>(tx, normalized-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a>);</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    }</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="comment">// Password.</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keywordflow">if</span> (incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a> != NULL) {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        normalized-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a> = <a class="code" href="bstr_8c.html#ab4fc824d8df74ad6863a085f3901d30f">bstr_dup</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a>);</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        <span class="keywordflow">if</span> (normalized-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a> == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <a class="code" href="htp__private_8h.html#a14e44933747475b68b36ea4b4ec7f1eb">htp_tx_urldecode_uri_inplace</a>(tx, normalized-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a>);</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    }</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="comment">// Hostname.</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="keywordflow">if</span> (incomplete-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> != NULL) {</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <span class="comment">// We know that incomplete-&gt;hostname does not contain</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <span class="comment">// port information, so no need to check for it here.</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        normalized-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> = <a class="code" href="bstr_8c.html#ab4fc824d8df74ad6863a085f3901d30f">bstr_dup</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>);</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <span class="keywordflow">if</span> (normalized-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <a class="code" href="htp__private_8h.html#a14e44933747475b68b36ea4b4ec7f1eb">htp_tx_urldecode_uri_inplace</a>(tx, normalized-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>);</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <a class="code" href="htp__private_8h.html#a7e8991ba87da71aa0b14c2955da46b25">htp_normalize_hostname_inplace</a>(normalized-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>);</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    }</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="comment">// Port.</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keywordflow">if</span> (incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a> != NULL) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        int64_t port_parsed = <a class="code" href="htp__private_8h.html#ae73f7889b2bec1d7c2605c154cc4ecda">htp_parse_positive_integer_whitespace</a>(</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a>), <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a>), 10);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="keywordflow">if</span> (port_parsed &lt; 0) {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            <span class="comment">// Failed to parse the port number.</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            normalized-&gt;<a class="code" href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">port_number</a> = -1;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a217e63fc16a9cb7437ed98be4f8bf4ec">HTP_HOSTU_INVALID</a>;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((port_parsed &gt; 0) &amp;&amp; (port_parsed &lt; 65536)) {</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;            <span class="comment">// Valid port number.</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;            normalized-&gt;<a class="code" href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">port_number</a> = (int) port_parsed;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="comment">// Port number out of range.</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            normalized-&gt;<a class="code" href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">port_number</a> = -1;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;            tx-&gt;<a class="code" href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">flags</a> |= <a class="code" href="htp__core_8h.html#a217e63fc16a9cb7437ed98be4f8bf4ec">HTP_HOSTU_INVALID</a>;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        }</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        normalized-&gt;<a class="code" href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">port_number</a> = -1;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    }</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="comment">// Path.</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <span class="keywordflow">if</span> (incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a> != NULL) {</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        <span class="comment">// Make a copy of the path, so that we can work on it.</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        normalized-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a> = <a class="code" href="bstr_8c.html#ab4fc824d8df74ad6863a085f3901d30f">bstr_dup</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a>);</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        <span class="keywordflow">if</span> (normalized-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a> == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        <span class="comment">// Decode URL-encoded (and %u-encoded) characters, as well as lowercase,</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        <span class="comment">// compress separators and convert backslashes.</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        <a class="code" href="htp__private_8h.html#a854ce501c5216103458afecdadb82d0b">htp_decode_path_inplace</a>(tx, normalized-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a>);</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="comment">// Handle UTF-8 in the path.</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        <span class="keywordflow">if</span> (tx-&gt;<a class="code" href="structhtp__tx__t.html#a85c2f3e758ff6154994c62f3ff92ea8c">cfg</a>-&gt;<a class="code" href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">decoder_cfgs</a>[<a class="code" href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a>].<a class="code" href="structhtp__decoder__cfg__t.html#a9555f67f0605ac5d3866475d8843f288">utf8_convert_bestfit</a>) {</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;            <span class="comment">// Decode Unicode characters into a single-byte stream, using best-fit mapping.</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            <a class="code" href="htp__private_8h.html#ac19fd0827df78d7618a6360a0a9e2ac2">htp_utf8_decode_path_inplace</a>(tx-&gt;<a class="code" href="structhtp__tx__t.html#a85c2f3e758ff6154994c62f3ff92ea8c">cfg</a>, tx, normalized-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a>);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;            <span class="comment">// No decoding, but try to validate the path as a UTF-8 stream.</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;            <a class="code" href="htp__private_8h.html#a75ad702e0957be72f80dc27900f83ec7">htp_utf8_validate_path</a>(tx, normalized-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a>);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        }</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        <span class="comment">// RFC normalization.</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        <a class="code" href="htp__private_8h.html#ae3b688cf78f951a218afde6d2bb3b763">htp_normalize_uri_path_inplace</a>(normalized-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a>);</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    }</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="comment">// Query string.</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">if</span> (incomplete-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a> != NULL) {</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        normalized-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a> = <a class="code" href="bstr_8c.html#ab4fc824d8df74ad6863a085f3901d30f">bstr_dup</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a>);</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="keywordflow">if</span> (normalized-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a> == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    }</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="comment">// Fragment.</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordflow">if</span> (incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a> != NULL) {</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        normalized-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a> = <a class="code" href="bstr_8c.html#ab4fc824d8df74ad6863a085f3901d30f">bstr_dup</a>(incomplete-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a>);</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <span class="keywordflow">if</span> (normalized-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a> == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <a class="code" href="htp__private_8h.html#a14e44933747475b68b36ea4b4ec7f1eb">htp_tx_urldecode_uri_inplace</a>(tx, normalized-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a>);</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    }</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;}</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment"> * Normalize request hostname. Convert all characters to lowercase and</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment"> * remove trailing dots from the end, if present.</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment"> * @param[in] hostname</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment"> * @return Normalized hostname.</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"><a class="line" href="htp__util_8c.html#aa9fcbe29596fb22c40345bec42416f52"> 1793</a></span>&#160;<a class="code" href="structbstr__t.html">bstr</a> *<a class="code" href="htp__private_8h.html#a7e8991ba87da71aa0b14c2955da46b25">htp_normalize_hostname_inplace</a>(<a class="code" href="structbstr__t.html">bstr</a> *hostname) {</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordflow">if</span> (hostname == NULL) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <a class="code" href="bstr_8c.html#a8efd20da92a9a40fee8a40bdcdfb194f">bstr_to_lowercase</a>(hostname);</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="comment">// Remove dots from the end of the string.    </span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="bstr_8c.html#a8eb4cfb22e61753899620617f200a36c">bstr_char_at_end</a>(hostname, 0) == <span class="charliteral">&#39;.&#39;</span>) <a class="code" href="bstr_8c.html#ae7440589d0619590384aa3ac7070ba89">bstr_chop</a>(hostname);</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="keywordflow">return</span> hostname;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;}</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment"> * Replace the URI in the structure with the one provided as the parameter</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment"> * to this function (which will typically be supplied in a Host header).</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment"> * @param[in] connp</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment"> * @param[in] parsed_uri</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment"> * @param[in] hostname</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp__private_8h.html#a68a568e948b5a609fb4900152498142b">htp_replace_hostname</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp, <a class="code" href="structhtp__uri__t.html">htp_uri_t</a> *parsed_uri, <a class="code" href="structbstr__t.html">bstr</a> *hostname) {</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="keywordflow">if</span> (hostname == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <a class="code" href="structbstr__t.html">bstr</a> *new_hostname = NULL;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordtype">int</span> colon = <a class="code" href="bstr_8c.html#a75dc35dde15052db45ac0496e33b76ce">bstr_chr</a>(hostname, <span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordflow">if</span> (colon == -1) {</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        <span class="comment">// Hostname alone (no port information)</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        new_hostname = <a class="code" href="bstr_8c.html#ab4fc824d8df74ad6863a085f3901d30f">bstr_dup</a>(hostname);</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        <span class="keywordflow">if</span> (new_hostname == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <a class="code" href="htp__private_8h.html#a7e8991ba87da71aa0b14c2955da46b25">htp_normalize_hostname_inplace</a>(new_hostname);</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        <span class="keywordflow">if</span> (parsed_uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> != NULL) <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(parsed_uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>);</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        parsed_uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> = new_hostname;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        <span class="comment">// Hostname and port</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        new_hostname = <a class="code" href="bstr_8c.html#abaf68b4b27be54655cba0d74c24646c1">bstr_dup_ex</a>(hostname, 0, colon);</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        <span class="keywordflow">if</span> (new_hostname == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        <span class="comment">// TODO Handle whitespace around hostname</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        <a class="code" href="htp__private_8h.html#a7e8991ba87da71aa0b14c2955da46b25">htp_normalize_hostname_inplace</a>(new_hostname);</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        <span class="keywordflow">if</span> (parsed_uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> != NULL) <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(parsed_uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>);</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        parsed_uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> = new_hostname;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        parsed_uri-&gt;<a class="code" href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">port_number</a> = 0;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        <span class="comment">// Port</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        <span class="keywordtype">int</span> port = <a class="code" href="htp__private_8h.html#ae73f7889b2bec1d7c2605c154cc4ecda">htp_parse_positive_integer_whitespace</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(hostname) + colon + 1,</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(hostname) - colon - 1, 10);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        <span class="keywordflow">if</span> (port &lt; 0) {</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;            <span class="comment">// Failed to parse port</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;            <a class="code" href="htp_8h.html#a3eef4d9c98d7bbfbbcb1ff7c5317f3c6">htp_log</a>(connp, <a class="code" href="htp__core_8h.html#a88f6d4e1b9465ff87454af7321970481">HTP_LOG_MARK</a>, <a class="code" href="htp__core_8h.html#ae91a6ad07977423dd1ec14a44156d799a92383cf2d26bc4a3f9b32c9d948662a4">HTP_LOG_ERROR</a>, 0, <span class="stringliteral">&quot;Invalid server port information in request&quot;</span>);</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((port &gt; 0) &amp;&amp; (port &lt; 65536)) {</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;            <span class="comment">// Valid port</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;            <span class="keywordflow">if</span> ((connp-&gt;<a class="code" href="structhtp__connp__t.html#ab1d498ba10537429d27f879fcc8d85f0">conn</a>-&gt;<a class="code" href="structhtp__conn__t.html#afc4505df29b761e8c086605cef49dd4f">server_port</a> != 0) &amp;&amp; (port != connp-&gt;<a class="code" href="structhtp__connp__t.html#ab1d498ba10537429d27f879fcc8d85f0">conn</a>-&gt;<a class="code" href="structhtp__conn__t.html#afc4505df29b761e8c086605cef49dd4f">server_port</a>)) {</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                <span class="comment">// Port was specified in connection and is different from the TCP port</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                <a class="code" href="htp_8h.html#a3eef4d9c98d7bbfbbcb1ff7c5317f3c6">htp_log</a>(connp, <a class="code" href="htp__core_8h.html#a88f6d4e1b9465ff87454af7321970481">HTP_LOG_MARK</a>, <a class="code" href="htp__core_8h.html#ae91a6ad07977423dd1ec14a44156d799a92383cf2d26bc4a3f9b32c9d948662a4">HTP_LOG_ERROR</a>, 0, <span class="stringliteral">&quot;Request server port=%d number differs from the actual TCP port=%d&quot;</span>, port, connp-&gt;<a class="code" href="structhtp__connp__t.html#ab1d498ba10537429d27f879fcc8d85f0">conn</a>-&gt;<a class="code" href="structhtp__conn__t.html#afc4505df29b761e8c086605cef49dd4f">server_port</a>);</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                parsed_uri-&gt;<a class="code" href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">port_number</a> = port;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            }</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        }</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    }</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;}</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment"> * Is URI character reserved?</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment"> * @param[in] c</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment"> * @return 1 if it is, 0 if it isn&#39;t</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#ae7cca7a4e5e553b0a1da8d305dd7bae6">htp_is_uri_unreserved</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c) {</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="keywordflow">if</span> (((c &gt;= 0x41) &amp;&amp; (c &lt;= 0x5a)) ||</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            ((c &gt;= 0x61) &amp;&amp; (c &lt;= 0x7a)) ||</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            ((c &gt;= 0x30) &amp;&amp; (c &lt;= 0x39)) ||</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            (c == 0x2d) || (c == 0x2e) ||</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            (c == 0x5f) || (c == 0x7e)) {</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    }</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;}</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment"> * Decode a URL-encoded string, leaving the reserved</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment"> * characters and invalid encodings alone.</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment"> * @param[in] s</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="keywordtype">void</span> htp_uriencoding_normalize_inplace(<a class="code" href="structbstr__t.html">bstr</a> *s) {</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <span class="keywordflow">if</span> (s == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(s);</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <span class="keywordflow">if</span> (data == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(s);</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="keywordtype">size_t</span> rpos = 0;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    <span class="keywordtype">size_t</span> wpos = 0;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    <span class="keywordflow">while</span> (rpos &lt; len) {</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        <span class="keywordflow">if</span> (data[rpos] == <span class="charliteral">&#39;%&#39;</span>) {</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            <span class="keywordflow">if</span> (rpos + 2 &lt; len) {</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                <span class="keywordflow">if</span> (isxdigit(data[rpos + 1]) &amp;&amp; (isxdigit(data[rpos + 2]))) {</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = x2c(&amp;data[rpos + 1]);</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="htp__private_8h.html#ae7cca7a4e5e553b0a1da8d305dd7bae6">htp_is_uri_unreserved</a>(c)) {</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                        <span class="comment">// Leave reserved characters encoded, but convert</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                        <span class="comment">// the hexadecimal digits to uppercase</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                        data[wpos++] = data[rpos++];</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                        data[wpos++] = toupper(data[rpos++]);</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                        data[wpos++] = toupper(data[rpos++]);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                        <span class="comment">// Decode unreserved character</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                        data[wpos++] = c;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                        rpos += 3;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                    }</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                    <span class="comment">// Invalid URL encoding: invalid hex digits</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                    <span class="comment">// Copy over what&#39;s there</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                    data[wpos++] = data[rpos++];</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                    data[wpos++] = toupper(data[rpos++]);</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                    data[wpos++] = toupper(data[rpos++]);</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                }</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                <span class="comment">// Invalid URL encoding: string too short</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                <span class="comment">// Copy over what&#39;s there</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                data[wpos++] = data[rpos++];</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                <span class="keywordflow">while</span> (rpos &lt; len) {</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                    data[wpos++] = toupper(data[rpos++]);</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                }</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;            }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;            data[wpos++] = data[rpos++];</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    }</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(s, wpos);</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;}</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="comment"> * Normalize URL path. This function implements the remove dot segments algorithm</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="comment"> * specified in RFC 3986, section 5.2.4.</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment"> * @param[in] s</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"><a class="line" href="htp__util_8c.html#ae3b688cf78f951a218afde6d2bb3b763"> 1940</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp__private_8h.html#ae3b688cf78f951a218afde6d2bb3b763">htp_normalize_uri_path_inplace</a>(<a class="code" href="structbstr__t.html">bstr</a> *s) {</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">if</span> (s == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(s);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keywordflow">if</span> (data == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(s);</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keywordtype">size_t</span> rpos = 0;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <span class="keywordtype">size_t</span> wpos = 0;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    <span class="keywordtype">int</span> c = -1;</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="keywordflow">while</span> ((rpos &lt; len)&amp;&amp;(wpos &lt; len)) {</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <span class="keywordflow">if</span> (c == -1) {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;            c = data[rpos++];</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        }</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        <span class="comment">// A. If the input buffer begins with a prefix of &quot;../&quot; or &quot;./&quot;,</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        <span class="comment">//    then remove that prefix from the input buffer; otherwise,</span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;.&#39;</span>) {</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;            <span class="keywordflow">if</span> ((rpos + 1 &lt; len) &amp;&amp; (data[rpos] == <span class="charliteral">&#39;.&#39;</span>) &amp;&amp; (data[rpos + 1] == <span class="charliteral">&#39;/&#39;</span>)) {</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                c = -1;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                rpos += 2;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((rpos &lt; len) &amp;&amp; (data[rpos] == <span class="charliteral">&#39;/&#39;</span>)) {</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                c = -1;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                rpos += 1;</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;            }</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        }</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;        <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;            <span class="comment">// B. if the input buffer begins with a prefix of &quot;/./&quot; or &quot;/.&quot;,</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;            <span class="comment">//    where &quot;.&quot; is a complete path segment, then replace that</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;            <span class="comment">//    prefix with &quot;/&quot; in the input buffer; otherwise,</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;            <span class="keywordflow">if</span> ((rpos + 1 &lt; len) &amp;&amp; (data[rpos] == <span class="charliteral">&#39;.&#39;</span>) &amp;&amp; (data[rpos + 1] == <span class="charliteral">&#39;/&#39;</span>)) {</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                c = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                rpos += 2;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((rpos + 1 == len) &amp;&amp; (data[rpos] == <span class="charliteral">&#39;.&#39;</span>)) {</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                c = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                rpos += 1;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;            }</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            <span class="comment">// C. if the input buffer begins with a prefix of &quot;/../&quot; or &quot;/..&quot;,</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;            <span class="comment">//    where &quot;..&quot; is a complete path segment, then replace that</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            <span class="comment">//    prefix with &quot;/&quot; in the input buffer and remove the last</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;            <span class="comment">//    segment and its preceding &quot;/&quot; (if any) from the output</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;            <span class="comment">//    buffer; otherwise,</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;            <span class="keywordflow">if</span> ((rpos + 2 &lt; len) &amp;&amp; (data[rpos] == <span class="charliteral">&#39;.&#39;</span>) &amp;&amp; (data[rpos + 1] == <span class="charliteral">&#39;.&#39;</span>) &amp;&amp; (data[rpos + 2] == <span class="charliteral">&#39;/&#39;</span>)) {</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;                c = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                rpos += 3;</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;                <span class="comment">// Remove the last segment</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                <span class="keywordflow">while</span> ((wpos &gt; 0) &amp;&amp; (data[wpos - 1] != <span class="charliteral">&#39;/&#39;</span>)) wpos--;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                <span class="keywordflow">if</span> (wpos &gt; 0) wpos--;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((rpos + 2 == len) &amp;&amp; (data[rpos] == <span class="charliteral">&#39;.&#39;</span>) &amp;&amp; (data[rpos + 1] == <span class="charliteral">&#39;.&#39;</span>)) {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                c = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                rpos += 2;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                <span class="comment">// Remove the last segment</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                <span class="keywordflow">while</span> ((wpos &gt; 0) &amp;&amp; (data[wpos - 1] != <span class="charliteral">&#39;/&#39;</span>)) wpos--;</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                <span class="keywordflow">if</span> (wpos &gt; 0) wpos--;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;            }</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        }</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        <span class="comment">// D.  if the input buffer consists only of &quot;.&quot; or &quot;..&quot;, then remove</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="comment">// that from the input buffer; otherwise,</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        <span class="keywordflow">if</span> ((c == <span class="charliteral">&#39;.&#39;</span>) &amp;&amp; (rpos == len)) {</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;            rpos++;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        }</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        <span class="keywordflow">if</span> ((c == <span class="charliteral">&#39;.&#39;</span>) &amp;&amp; (rpos + 1 == len) &amp;&amp; (data[rpos] == <span class="charliteral">&#39;.&#39;</span>)) {</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;            rpos += 2;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        }</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <span class="comment">// E.  move the first path segment in the input buffer to the end of</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <span class="comment">// the output buffer, including the initial &quot;/&quot; character (if</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        <span class="comment">// any) and any subsequent characters up to, but not including,</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;        <span class="comment">// the next &quot;/&quot; character or the end of the input buffer.</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        data[wpos++] = c;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <span class="keywordflow">while</span> ((rpos &lt; len) &amp;&amp; (data[rpos] != <span class="charliteral">&#39;/&#39;</span>) &amp;&amp; (wpos &lt; len)) {</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            data[wpos++] = data[rpos++];</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        }</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;        c = -1;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    }</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(s, wpos);</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;}</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a1dfe07ee3d981b6bfaaf6c88d01224b0"> 2039</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp__private_8h.html#a1dfe07ee3d981b6bfaaf6c88d01224b0">fprint_bstr</a>(FILE *stream, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="structbstr__t.html">bstr</a> *b) {</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">if</span> (b == NULL) {</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        <a class="code" href="htp__private_8h.html#a9bd7382b55286e62a10aac00bc630af1">fprint_raw_data_ex</a>(stream, name, <span class="stringliteral">&quot;(null)&quot;</span>, 0, 6);</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    }</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <a class="code" href="htp__private_8h.html#a9bd7382b55286e62a10aac00bc630af1">fprint_raw_data_ex</a>(stream, name, <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(b), 0, <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(b));</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;}</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a0ec8330cb428004d467f69e7c6acdb84"> 2051</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp__private_8h.html#a0ec8330cb428004d467f69e7c6acdb84">fprint_raw_data</a>(FILE *stream, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">size_t</span> len) {</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <a class="code" href="htp__private_8h.html#a9bd7382b55286e62a10aac00bc630af1">fprint_raw_data_ex</a>(stream, name, data, 0, len);</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;}</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a303aba5516dabecd55bb558228b76d84"> 2058</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp__private_8h.html#a9bd7382b55286e62a10aac00bc630af1">fprint_raw_data_ex</a>(FILE *stream, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">void</span> *_data, <span class="keywordtype">size_t</span> offset, <span class="keywordtype">size_t</span> printlen) {</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) _data;</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="keywordtype">char</span> buf[160];</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="keywordtype">size_t</span> len = offset + printlen;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    fprintf(stream, <span class="stringliteral">&quot;\n%s: ptr %p offset %&quot;</span> PRIu64 <span class="stringliteral">&quot; len %&quot;</span> PRIu64<span class="stringliteral">&quot;\n&quot;</span>, name, data, (uint64_t) offset, (uint64_t) len);</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    <span class="keywordflow">while</span> (offset &lt; len) {</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        <span class="keywordtype">size_t</span> i;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%08&quot;</span> PRIx64, (uint64_t) offset);</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        <a class="code" href="suricata-common_8h.html#a7e9938e922f1dfd71bc01995bc2b7777">strlcat</a>(buf, <span class="stringliteral">&quot;  &quot;</span>, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        i = 0;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        <span class="keywordflow">while</span> (i &lt; 8) {</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;            <span class="keywordflow">if</span> (offset + i &lt; len) {</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                snprintf(buf + strlen(buf), <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%02x &quot;</span>, data[offset + i]);</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                <a class="code" href="suricata-common_8h.html#a7e9938e922f1dfd71bc01995bc2b7777">strlcat</a>(buf, <span class="stringliteral">&quot;   &quot;</span>, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;            }</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;            i++;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        }</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        <a class="code" href="suricata-common_8h.html#a7e9938e922f1dfd71bc01995bc2b7777">strlcat</a>(buf, <span class="stringliteral">&quot; &quot;</span>, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        i = 8;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <span class="keywordflow">while</span> (i &lt; 16) {</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            <span class="keywordflow">if</span> (offset + i &lt; len) {</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                snprintf(buf + strlen(buf), <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%02x &quot;</span>, data[offset + i]);</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                <a class="code" href="suricata-common_8h.html#a7e9938e922f1dfd71bc01995bc2b7777">strlcat</a>(buf, <span class="stringliteral">&quot;   &quot;</span>, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;            }</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;            i++;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        }</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        <a class="code" href="suricata-common_8h.html#a7e9938e922f1dfd71bc01995bc2b7777">strlcat</a>(buf, <span class="stringliteral">&quot; |&quot;</span>, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        i = 0;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <span class="keywordtype">char</span> *p = buf + strlen(buf);</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="keywordflow">while</span> ((offset + i &lt; len) &amp;&amp; (i &lt; 16)) {</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            <span class="keywordtype">int</span> c = data[offset + i];</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            <span class="keywordflow">if</span> (isprint(c)) {</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                *p++ = c;</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;                *p++ = <span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;            }</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;            i++;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        }</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        *p++ = <span class="charliteral">&#39;|&#39;</span>;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        *p++ = <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        *p = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        fprintf(stream, <span class="stringliteral">&quot;%s&quot;</span>, buf);</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        offset += 16;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    }</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    fprintf(stream, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;}</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a81fca26cac57032120c6796bda2a660c"> 2125</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="htp__private_8h.html#a81fca26cac57032120c6796bda2a660c">htp_connp_in_state_as_string</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp) {</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    <span class="keywordflow">if</span> (connp == NULL) <span class="keywordflow">return</span> <span class="stringliteral">&quot;NULL&quot;</span>;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#ae4a3e37c2a1e728db9f80cca8e53c6fa">htp_connp_REQ_IDLE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_IDLE&quot;</span>;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#acfb131d9a3925c753f4beffad0f07e84">htp_connp_REQ_LINE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_LINE&quot;</span>;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#a801f66183cf5693361eca92d66607314">htp_connp_REQ_PROTOCOL</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_PROTOCOL&quot;</span>;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#af7b83f68a53afa0a16e0d78300b63a46">htp_connp_REQ_HEADERS</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_HEADERS&quot;</span>;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#a3e8c194c19ebdaaa21fe107e328e3a75">htp_connp_REQ_CONNECT_CHECK</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_CONNECT_CHECK&quot;</span>;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#ac6178cc04104e5e5e469489f5e77c04d">htp_connp_REQ_CONNECT_WAIT_RESPONSE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_CONNECT_WAIT_RESPONSE&quot;</span>;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#ad207aff5c7e4a68d2a539ffd9e3fd623">htp_connp_REQ_BODY_DETERMINE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_BODY_DETERMINE&quot;</span>;</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#aa5ab1e26414167266d8d0b98eb712723">htp_connp_REQ_BODY_IDENTITY</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_BODY_IDENTITY&quot;</span>;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#a78975b59c610a8b5cd834b6c7ad7524b">htp_connp_REQ_BODY_CHUNKED_LENGTH</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_BODY_CHUNKED_LENGTH&quot;</span>;</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#ac07a4f5062908c573d2b78f6f3ddc743">htp_connp_REQ_BODY_CHUNKED_DATA</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_BODY_CHUNKED_DATA&quot;</span>;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#a24a112bbe8db96d22a8d421a6ea6ac74">htp_connp_REQ_BODY_CHUNKED_DATA_END</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_BODY_CHUNKED_DATA_END&quot;</span>;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#a2702260435d65d58ff1ef824cfdc1091">htp_connp_REQ_FINALIZE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_FINALIZE&quot;</span>;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">in_state</a> == <a class="code" href="htp__private_8h.html#a984918ce8cdd5c6d42c74294a1c7cc18">htp_connp_REQ_IGNORE_DATA_AFTER_HTTP_0_9</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_IGNORE_DATA_AFTER_HTTP_0_9&quot;</span>;</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNKNOWN&quot;</span>;</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;}</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"><a class="line" href="htp__util_8c.html#af31ead38ae0851c906b72d93d9a29d5a"> 2148</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="htp__private_8h.html#af31ead38ae0851c906b72d93d9a29d5a">htp_connp_out_state_as_string</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp) {</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    <span class="keywordflow">if</span> (connp == NULL) <span class="keywordflow">return</span> <span class="stringliteral">&quot;NULL&quot;</span>;</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#a1b95d113c24de4c93db72889c738275d">htp_connp_RES_IDLE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_IDLE&quot;</span>;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#a45043cdc1b581e62abbf2423be76ea2a">htp_connp_RES_LINE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_LINE&quot;</span>;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#a92faf3d17df2d54dd67bd7fbe80fb525">htp_connp_RES_HEADERS</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_HEADERS&quot;</span>;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#a5bf0430de9af721db6e03c90ec63adf6">htp_connp_RES_BODY_DETERMINE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_BODY_DETERMINE&quot;</span>;</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#a35978034dd65239e911dd33f7c751332">htp_connp_RES_BODY_IDENTITY_CL_KNOWN</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_BODY_IDENTITY_CL_KNOWN&quot;</span>;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#a2c9732ce72c12038353a4483475e180c">htp_connp_RES_BODY_IDENTITY_STREAM_CLOSE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_BODY_IDENTITY_STREAM_CLOSE&quot;</span>;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#ab601564fadb2bb9ff37cd75b448a03d7">htp_connp_RES_BODY_CHUNKED_LENGTH</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_BODY_CHUNKED_LENGTH&quot;</span>;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#ae160ab80f3c9d3c3aad67b7a34a498ab">htp_connp_RES_BODY_CHUNKED_DATA</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_BODY_CHUNKED_DATA&quot;</span>;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#a028530726a98edc10fc5adf8a050b349">htp_connp_RES_BODY_CHUNKED_DATA_END</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_BODY_CHUNKED_DATA_END&quot;</span>;</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">out_state</a> == <a class="code" href="htp__private_8h.html#a779958ef7d3b3742be8b13170c0a8977">htp_connp_RES_FINALIZE</a>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_BODY_FINALIZE&quot;</span>;</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNKNOWN&quot;</span>;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;}</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a7745dfd28ae341b34cde2bb1f333b1b8"> 2168</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="htp__private_8h.html#a7745dfd28ae341b34cde2bb1f333b1b8">htp_tx_request_progress_as_string</a>(<a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx) {</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordflow">if</span> (tx == NULL) <span class="keywordflow">return</span> <span class="stringliteral">&quot;NULL&quot;</span>;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordflow">switch</span> (tx-&gt;<a class="code" href="structhtp__tx__t.html#aa39b15d0438185bf262ab5223fabe1a5">request_progress</a>) {</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba8a23b4e6339af5d9aa812527b2c187a7">HTP_REQUEST_NOT_STARTED</a>:</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;NOT_STARTED&quot;</span>;</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba982c1f4b53c68e2cccf7ab261ca5e22b">HTP_REQUEST_LINE</a>:</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_LINE&quot;</span>;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba2f3a67a32561697ab964035aa75e5d96">HTP_REQUEST_HEADERS</a>:</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_HEADERS&quot;</span>;</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba0289ffb4a8c8da95d5b9435c5a272abb">HTP_REQUEST_BODY</a>:</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_BODY&quot;</span>;</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba3f6ce0a8879ff735d58169bf7dfa1c7d">HTP_REQUEST_TRAILER</a>:</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;REQ_TRAILER&quot;</span>;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440abad900599750d034beee98cf5deb506a24">HTP_REQUEST_COMPLETE</a>:</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;COMPLETE&quot;</span>;</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    }</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;INVALID&quot;</span>;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;}</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a9469285f23ba429b8358c9385ccd6eef"> 2192</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="htp__private_8h.html#a9469285f23ba429b8358c9385ccd6eef">htp_tx_response_progress_as_string</a>(<a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx) {</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    <span class="keywordflow">if</span> (tx == NULL) <span class="keywordflow">return</span> <span class="stringliteral">&quot;NULL&quot;</span>;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    <span class="keywordflow">switch</span> (tx-&gt;<a class="code" href="structhtp__tx__t.html#ab2a8be86c0601f127c35918f4803f428">response_progress</a>) {</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770eaed90895b9daa328d3691e124e2f33721">HTP_RESPONSE_NOT_STARTED</a>:</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;NOT_STARTED&quot;</span>;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770ea2c8fd05fc9348dea11f27c37d2543b92">HTP_RESPONSE_LINE</a>:</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_LINE&quot;</span>;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770ea699bb7f8e7913d025319d669462a384a">HTP_RESPONSE_HEADERS</a>:</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_HEADERS&quot;</span>;</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770eab83433ab84bcfbb42e120443ac8f8f12">HTP_RESPONSE_BODY</a>:</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_BODY&quot;</span>;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770ea3d33ed1c84b45f75ca9c3420de0d6cee">HTP_RESPONSE_TRAILER</a>:</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;RES_TRAILER&quot;</span>;</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770eafee71290ea990341d940c0631f01696a">HTP_RESPONSE_COMPLETE</a>:</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;COMPLETE&quot;</span>;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    }</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;INVALID&quot;</span>;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;}</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div>
<div class="line"><a name="l02213"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a556b54577b8787f15a9d98955ba6b1a7"> 2213</a></span>&#160;<a class="code" href="structbstr__t.html">bstr</a> *<a class="code" href="htp__private_8h.html#a556b54577b8787f15a9d98955ba6b1a7">htp_unparse_uri_noencode</a>(<a class="code" href="structhtp__uri__t.html">htp_uri_t</a> *uri) {</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="keywordflow">if</span> (uri == NULL) <span class="keywordflow">return</span> NULL;    </div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;    <span class="comment">// On the first pass determine the length of the final string</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    <span class="keywordtype">size_t</span> len = 0;</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a> != NULL) {</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        len += <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a>);</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        len += 3; <span class="comment">// &quot;://&quot;</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    }</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keywordflow">if</span> ((uri-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a> != NULL) || (uri-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a> != NULL)) {</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a> != NULL) {</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;            len += <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a>);</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;        }</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        len += 1; <span class="comment">// &quot;:&quot;</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;        <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a> != NULL) {</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;            len += <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a>);</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;        }</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;        len += 1; <span class="comment">// &quot;@&quot;</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    }</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> != NULL) {</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        len += <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>);</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    }</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a> != NULL) {</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        len += 1; <span class="comment">// &quot;:&quot;</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        len += <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a>);</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    }</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a> != NULL) {</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        len += <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a>);</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    }</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a> != NULL) {</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        len += 1; <span class="comment">// &quot;?&quot;</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        len += <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a>);</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    }</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a> != NULL) {</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        len += 1; <span class="comment">// &quot;#&quot;</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        len += <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a>);</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    }</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    <span class="comment">// On the second pass construct the string</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <a class="code" href="structbstr__t.html">bstr</a> *r = <a class="code" href="bstr_8c.html#a6b551b4e84311c0608d2a359440d9118">bstr_alloc</a>(len);</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;    <span class="keywordflow">if</span> (r == NULL) <span class="keywordflow">return</span> NULL;    </div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a> != NULL) {</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        <a class="code" href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a>(r, uri-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a>);</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        <a class="code" href="bstr_8c.html#adac130490755d97728f1c2e6b6330333">bstr_add_c_noex</a>(r, <span class="stringliteral">&quot;://&quot;</span>);</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    <span class="keywordflow">if</span> ((uri-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a> != NULL) || (uri-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a> != NULL)) {</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;        <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a> != NULL) {</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            <a class="code" href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a>(r, uri-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a>);</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        }</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        <a class="code" href="bstr_8c.html#adac130490755d97728f1c2e6b6330333">bstr_add_c_noex</a>(r, <span class="stringliteral">&quot;:&quot;</span>);</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a> != NULL) {</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;            <a class="code" href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a>(r, uri-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a>);</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        }</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        <a class="code" href="bstr_8c.html#adac130490755d97728f1c2e6b6330333">bstr_add_c_noex</a>(r, <span class="stringliteral">&quot;@&quot;</span>);</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    }</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a> != NULL) {</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        <a class="code" href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a>(r, uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>);</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    }</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a> != NULL) {</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        <a class="code" href="bstr_8c.html#adac130490755d97728f1c2e6b6330333">bstr_add_c_noex</a>(r, <span class="stringliteral">&quot;:&quot;</span>);</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        <a class="code" href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a>(r, uri-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a>);</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    }</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a> != NULL) {</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        <a class="code" href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a>(r, uri-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a>);</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    }</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a> != NULL) {</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        <a class="code" href="bstr_8c.html#adac130490755d97728f1c2e6b6330333">bstr_add_c_noex</a>(r, <span class="stringliteral">&quot;?&quot;</span>);</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        <a class="code" href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a>(r, uri-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a>);</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="comment">        bstr *query = bstr_dup(uri-&gt;query);</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment">        if (query == NULL) {</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="comment">            bstr_free(r);</span></div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="comment">            return NULL;</span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="comment">        htp_uriencoding_normalize_inplace(query);</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="comment">        bstr_add_c_noex(r, &quot;?&quot;);</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="comment">        bstr_add_noex(r, query);</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment">        bstr_free(query);</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    }</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    <span class="keywordflow">if</span> (uri-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a> != NULL) {</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;        <a class="code" href="bstr_8c.html#adac130490755d97728f1c2e6b6330333">bstr_add_c_noex</a>(r, <span class="stringliteral">&quot;#&quot;</span>);</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        <a class="code" href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a>(r, uri-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a>);</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    }</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;}</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="comment"> * Determine if the information provided on the response line</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="comment"> * is good enough. Browsers are lax when it comes to response</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="comment"> * line parsing. In most cases they will only look for the</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="comment"> * words &quot;http&quot; at the beginning.</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="comment"> * @param[in] tx</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="comment"> * @return 1 for good enough or 0 for not good enough</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02334"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a989808ba8cacae96e9c5e0e052a73a3c"> 2334</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a989808ba8cacae96e9c5e0e052a73a3c">htp_treat_response_line_as_body</a>(<a class="code" href="structhtp__tx__t.html">htp_tx_t</a> *tx) {</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <span class="comment">// Browser behavior:</span></div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    <span class="comment">//      Firefox 3.5.x: (?i)^\s*http</span></div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    <span class="comment">//      IE: (?i)^\s*http\s*/</span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    <span class="comment">//      Safari: ^HTTP/\d+\.\d+\s+\d{3}</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <span class="keywordflow">if</span> (tx-&gt;<a class="code" href="structhtp__tx__t.html#a3581876af0f7eaadc85b825b1cc228fd">response_protocol</a> == NULL) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(tx-&gt;<a class="code" href="structhtp__tx__t.html#a3581876af0f7eaadc85b825b1cc228fd">response_protocol</a>) &lt; 4) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(tx-&gt;<a class="code" href="structhtp__tx__t.html#a3581876af0f7eaadc85b825b1cc228fd">response_protocol</a>);</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <span class="keywordflow">if</span> ((data[0] != <span class="charliteral">&#39;H&#39;</span>) &amp;&amp; (data[0] != <span class="charliteral">&#39;h&#39;</span>)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <span class="keywordflow">if</span> ((data[1] != <span class="charliteral">&#39;T&#39;</span>) &amp;&amp; (data[1] != <span class="charliteral">&#39;t&#39;</span>)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="keywordflow">if</span> ((data[2] != <span class="charliteral">&#39;T&#39;</span>) &amp;&amp; (data[2] != <span class="charliteral">&#39;t&#39;</span>)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <span class="keywordflow">if</span> ((data[3] != <span class="charliteral">&#39;P&#39;</span>) &amp;&amp; (data[3] != <span class="charliteral">&#39;p&#39;</span>)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;}</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;<span class="comment"> * Run the REQUEST_BODY_DATA hook.</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment"> * @param[in] connp</span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment"> * @param[in] d</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"><a class="line" href="htp__util_8c.html#ae9186694fa6cb9d4985d3c66698f0968"> 2359</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#ae9186694fa6cb9d4985d3c66698f0968">htp_req_run_hook_body_data</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp, <a class="code" href="structhtp__tx__data__t.html">htp_tx_data_t</a> *d) {</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;    <span class="comment">// Do not invoke callbacks with an empty data chunk</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    <span class="keywordflow">if</span> ((d-&gt;<a class="code" href="structhtp__tx__data__t.html#a75a8bb0d2f0479f15d8e87779ff0922d">data</a> != NULL) &amp;&amp; (d-&gt;<a class="code" href="structhtp__tx__data__t.html#a392ce1147f2f96d2dec8e8232167d600">len</a> == 0)) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    <span class="comment">// Do not invoke callbacks without a transaction.</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a0d6be360cc9ba3f11d89696e5c9c5640">in_tx</a> == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    <span class="comment">// Run transaction hooks first</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    <a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> rc = <a class="code" href="htp__hooks_8c.html#a8981d368a73f78ddfb4ad1de1f4a5fc2">htp_hook_run_all</a>(connp-&gt;<a class="code" href="structhtp__connp__t.html#a0d6be360cc9ba3f11d89696e5c9c5640">in_tx</a>-&gt;<a class="code" href="structhtp__tx__t.html#af8464c33ab7ef7ee5824ff320a7eff99">hook_request_body_data</a>, d);</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="keywordflow">if</span> (rc != <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="comment">// Run configuration hooks second</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    rc = <a class="code" href="htp__hooks_8c.html#a8981d368a73f78ddfb4ad1de1f4a5fc2">htp_hook_run_all</a>(connp-&gt;<a class="code" href="structhtp__connp__t.html#a149e19109e4039b3c8dd05f4a4e41a52">cfg</a>-&gt;<a class="code" href="structhtp__cfg__t.html#a13f2031e76eaae43e8aa57ee7e73574d">hook_request_body_data</a>, d);</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <span class="keywordflow">if</span> (rc != <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="comment">// On PUT requests, treat request body as file</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <span class="keywordflow">if</span> (connp-&gt;<a class="code" href="structhtp__connp__t.html#a867300cf820a2559effa6286625d8144">put_file</a> != NULL) {</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        <a class="code" href="structhtp__file__data__t.html">htp_file_data_t</a> file_data;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        file_data.<a class="code" href="structhtp__file__data__t.html#aeef82afd837a136561142fd3576cf566">data</a> = d-&gt;<a class="code" href="structhtp__tx__data__t.html#a75a8bb0d2f0479f15d8e87779ff0922d">data</a>;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;        file_data.<a class="code" href="structhtp__file__data__t.html#a98211524d25713fac259acff57fc8633">len</a> = d-&gt;<a class="code" href="structhtp__tx__data__t.html#a392ce1147f2f96d2dec8e8232167d600">len</a>;</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        file_data.<a class="code" href="structhtp__file__data__t.html#a9b5a9f5b379aca7a75ef9246a83eaf8c">file</a> = connp-&gt;<a class="code" href="structhtp__connp__t.html#a867300cf820a2559effa6286625d8144">put_file</a>;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        file_data.<a class="code" href="structhtp__file__data__t.html#a9b5a9f5b379aca7a75ef9246a83eaf8c">file</a>-&gt;<a class="code" href="structhtp__file__t.html#a390d7103786da6d8f9fae0c28bcfd1d0">len</a> += d-&gt;<a class="code" href="structhtp__tx__data__t.html#a392ce1147f2f96d2dec8e8232167d600">len</a>;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;        rc = <a class="code" href="htp__hooks_8c.html#a8981d368a73f78ddfb4ad1de1f4a5fc2">htp_hook_run_all</a>(connp-&gt;<a class="code" href="structhtp__connp__t.html#a149e19109e4039b3c8dd05f4a4e41a52">cfg</a>-&gt;<a class="code" href="structhtp__cfg__t.html#a2770fa5b59b1f8ce923d4f698cb5f33c">hook_request_file_data</a>, &amp;file_data);</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        <span class="keywordflow">if</span> (rc != <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    }</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;}</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="comment"> * Run the RESPONSE_BODY_DATA hook.</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment"> * @param[in] connp</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment"> * @param[in] d</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"><a class="line" href="htp__util_8c.html#aa60cc60143dfb38260549c4df5219727"> 2396</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#aa60cc60143dfb38260549c4df5219727">htp_res_run_hook_body_data</a>(<a class="code" href="structhtp__connp__t.html">htp_connp_t</a> *connp, <a class="code" href="structhtp__tx__data__t.html">htp_tx_data_t</a> *d) {</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    <span class="comment">// Do not invoke callbacks with an empty data chunk.</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    <span class="keywordflow">if</span> ((d-&gt;<a class="code" href="structhtp__tx__data__t.html#a75a8bb0d2f0479f15d8e87779ff0922d">data</a> != NULL) &amp;&amp; (d-&gt;<a class="code" href="structhtp__tx__data__t.html#a392ce1147f2f96d2dec8e8232167d600">len</a> == 0)) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="comment">// Run transaction hooks first</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    <a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> rc = <a class="code" href="htp__hooks_8c.html#a8981d368a73f78ddfb4ad1de1f4a5fc2">htp_hook_run_all</a>(connp-&gt;<a class="code" href="structhtp__connp__t.html#a5001dcc0e83c5cd25adf4094a0add3c1">out_tx</a>-&gt;<a class="code" href="structhtp__tx__t.html#ad2761959ebfa28e86a37d71826c38d44">hook_response_body_data</a>, d);</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;    <span class="keywordflow">if</span> (rc != <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="comment">// Run configuration hooks second</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    rc = <a class="code" href="htp__hooks_8c.html#a8981d368a73f78ddfb4ad1de1f4a5fc2">htp_hook_run_all</a>(connp-&gt;<a class="code" href="structhtp__connp__t.html#a149e19109e4039b3c8dd05f4a4e41a52">cfg</a>-&gt;<a class="code" href="structhtp__cfg__t.html#ab0024f30fe7d2623e080fc027ca5aebf">hook_response_body_data</a>, d);</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    <span class="keywordflow">if</span> (rc != <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;}</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;<span class="comment"> * Parses the provided memory region, extracting the double-quoted string.</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="comment"> * @param[in] data</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="comment"> * @param[in] len</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="comment"> * @param[out] out</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment"> * @param[out] endoffset</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment"> * @return HTP_OK on success, HTP_DECLINED if the input is not well formed, and HTP_ERROR on fatal errors.</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a0ca5d553420839786a3102bc3ab3cb80"> 2420</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#a0ca5d553420839786a3102bc3ab3cb80">htp_extract_quoted_string_as_bstr</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data, <span class="keywordtype">size_t</span> len, <a class="code" href="structbstr__t.html">bstr</a> **<a class="code" href="namespaceptxdump.html#a207cee046b973ee54c9b97086ed9a95c">out</a>, <span class="keywordtype">size_t</span> *endoffset) {</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    <span class="keywordflow">if</span> ((data == NULL) || (out == NULL)) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;    <span class="keywordflow">if</span> (len == 0) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a42893d271da65da8619602fca022a663">HTP_DECLINED</a>;</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    <span class="keywordtype">size_t</span> pos = 0;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    <span class="comment">// Check that the first character is a double quote.</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    <span class="keywordflow">if</span> (data[pos] != <span class="charliteral">&#39;&quot;&#39;</span>) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a42893d271da65da8619602fca022a663">HTP_DECLINED</a>;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    <span class="comment">// Step over the double quote.</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    pos++;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="keywordflow">if</span> (pos == len) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a42893d271da65da8619602fca022a663">HTP_DECLINED</a>;</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    <span class="comment">// Calculate the length of the resulting string.</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;    <span class="keywordtype">size_t</span> escaped_chars = 0;</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    <span class="keywordflow">while</span> (pos &lt; len) {</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        <span class="keywordflow">if</span> (data[pos] == <span class="charliteral">&#39;\\&#39;</span>) {</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;            <span class="keywordflow">if</span> (pos + 1 &lt; len) {</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                escaped_chars++;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                pos += 2;</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;            }</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data[pos] == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        }</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        pos++;</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    }</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;    <span class="comment">// Have we reached the end of input without seeing the terminating double quote?</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <span class="keywordflow">if</span> (pos == len) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a42893d271da65da8619602fca022a663">HTP_DECLINED</a>;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    <span class="comment">// Copy the data and unescape it as necessary.</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    <span class="keywordtype">size_t</span> outlen = pos - 1 - escaped_chars;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    *out = <a class="code" href="bstr_8c.html#a6b551b4e84311c0608d2a359440d9118">bstr_alloc</a>(outlen);</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <span class="keywordflow">if</span> (*out == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *outptr = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(*out);</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    <span class="keywordtype">size_t</span> outpos = 0;</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    pos = 1;</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (outpos &lt; outlen)) {</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        <span class="comment">// TODO We are not properly unescaping test here, we&#39;re only</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;        <span class="comment">//      handling escaped double quotes.</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;        <span class="keywordflow">if</span> (data[pos] == <span class="charliteral">&#39;\\&#39;</span>) {</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;            <span class="keywordflow">if</span> (pos + 1 &lt; len) {</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                outptr[outpos++] = data[pos + 1];</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                pos += 2;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;            }</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data[pos] == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;        }</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        outptr[outpos++] = data[pos++];</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    }</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;    <a class="code" href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a>(*out, outlen);</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    <span class="keywordflow">if</span> (endoffset != NULL) {</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        *endoffset = pos;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    }</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;}</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div>
<div class="line"><a name="l02486"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a3742fd84a15ebfa867623dd7bf26c0e9"> 2486</a></span>&#160;<a class="code" href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a> <a class="code" href="htp__private_8h.html#a3742fd84a15ebfa867623dd7bf26c0e9">htp_parse_ct_header</a>(<a class="code" href="structbstr__t.html">bstr</a> *<a class="code" href="namespaceptxdump.html#ac49595517ea81825a75b18327191db0d">header</a>, <a class="code" href="structbstr__t.html">bstr</a> **ct) {</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="keywordflow">if</span> ((header == NULL) || (ct == NULL)) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(header);</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(header);</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <span class="comment">// The assumption here is that the header value we receive</span></div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    <span class="comment">// here has been left-trimmed, which means the starting position</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    <span class="comment">// is on the media type. On some platforms that may not be the</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    <span class="comment">// case, and we may need to do the left-trim ourselves.</span></div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    <span class="comment">// Find the end of the MIME type, using the same approach PHP 5.4.3 uses.</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="keywordtype">size_t</span> pos = 0;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (data[pos] != <span class="charliteral">&#39;;&#39;</span>) &amp;&amp; (data[pos] != <span class="charliteral">&#39;,&#39;</span>) &amp;&amp; (data[pos] != <span class="charliteral">&#39; &#39;</span>)) pos++;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;    *ct = <a class="code" href="bstr_8c.html#abaf68b4b27be54655cba0d74c24646c1">bstr_dup_ex</a>(header, 0, pos);</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="keywordflow">if</span> (*ct == NULL) <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a>;</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    <a class="code" href="bstr_8c.html#a8efd20da92a9a40fee8a40bdcdfb194f">bstr_to_lowercase</a>(*ct);</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a>;</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;}</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="comment"> * Implements relaxed (not strictly RFC) hostname validation.</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="comment"> * @param[in] hostname</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;<span class="comment"> * @return 1 if the supplied hostname is valid; 0 if it is not.</span></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a31cca701d490472a8cdb778a6c0e6560"> 2515</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="htp__private_8h.html#a31cca701d490472a8cdb778a6c0e6560">htp_validate_hostname</a>(<a class="code" href="structbstr__t.html">bstr</a> *hostname) {</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data = <a class="code" href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a>(hostname);</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    <span class="keywordtype">size_t</span> len = <a class="code" href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a>(hostname);</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="keywordtype">size_t</span> startpos = 0;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <span class="keywordtype">size_t</span> pos = 0;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <span class="keywordflow">if</span> ((len == 0) || (len &gt; 255)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <span class="keywordflow">while</span> (pos &lt; len) {</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <span class="comment">// Validate label characters.</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        startpos = pos;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;        <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (data[pos] != <span class="charliteral">&#39;.&#39;</span>)) {</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = data[pos];</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;            <span class="comment">// According to the RFC, the underscore is not allowed in a label, but</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;            <span class="comment">// we allow it here because we think it&#39;s often seen in practice.</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;            <span class="keywordflow">if</span> (!(((c &gt;= <span class="charliteral">&#39;a&#39;</span>) &amp;&amp; (c &lt;= <span class="charliteral">&#39;z&#39;</span>)) || ((c &gt;= <span class="charliteral">&#39;A&#39;</span>) &amp;&amp; (c &lt;= <span class="charliteral">&#39;Z&#39;</span>)) || ((c &gt;= <span class="charliteral">&#39;0&#39;</span>) &amp;&amp; (c &lt;= <span class="charliteral">&#39;9&#39;</span>)) || (c == <span class="charliteral">&#39;-&#39;</span>))) {</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;            }</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            pos++;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        }</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        <span class="comment">// Validate label length.</span></div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        <span class="keywordflow">if</span> ((pos - startpos == 0) || (pos - startpos &gt; 63)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;        <span class="keywordflow">if</span> (pos &gt;= len) <span class="keywordflow">return</span> 1; <span class="comment">// No more data after label.</span></div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <span class="comment">// How many dots are there?</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        startpos = pos;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        <span class="keywordflow">while</span> ((pos &lt; len) &amp;&amp; (data[pos] == <span class="charliteral">&#39;.&#39;</span>)) pos++;</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        <span class="keywordflow">if</span> (pos - startpos != 1) <span class="keywordflow">return</span> 0; <span class="comment">// Exactly one dot expected.</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    }</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;}</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;</div>
<div class="line"><a name="l02552"></a><span class="lineno"><a class="line" href="htp__util_8c.html#af834d04e2f2dcf25ed5f8cf49efb626a"> 2552</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="htp_8h.html#af834d04e2f2dcf25ed5f8cf49efb626a">htp_uri_free</a>(<a class="code" href="structhtp__uri__t.html">htp_uri_t</a> *uri) {</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <span class="keywordflow">if</span> (uri == NULL) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">scheme</a>);</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">username</a>);</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">password</a>);</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">hostname</a>);</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">port</a>);</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">path</a>);</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">query</a>);</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    <a class="code" href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a>(uri-&gt;<a class="code" href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">fragment</a>);</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    free(uri);</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;}</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;</div>
<div class="line"><a name="l02567"></a><span class="lineno"><a class="line" href="htp__util_8c.html#a6037e8e01478c4aa8bce304c873c182d"> 2567</a></span>&#160;<a class="code" href="structhtp__uri__t.html">htp_uri_t</a> *<a class="code" href="htp_8h.html#a73866af0ac06ac107436af9f08e2ca7d">htp_uri_alloc</a>() {</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    <a class="code" href="structhtp__uri__t.html">htp_uri_t</a> *u = calloc(1, <span class="keyword">sizeof</span> (<a class="code" href="structhtp__uri__t.html">htp_uri_t</a>));</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;    <span class="keywordflow">if</span> (u == NULL) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;    u-&gt;<a class="code" href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">port_number</a> = -1;</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;    <span class="keywordflow">return</span> u;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;}</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;</div>
<div class="line"><a name="l02576"></a><span class="lineno"><a class="line" href="htp__util_8c.html#aafd2659394bb762f2a623bc9b2ee59bd"> 2576</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="htp_8h.html#aafd2659394bb762f2a623bc9b2ee59bd">htp_get_version</a>(<span class="keywordtype">void</span>) {</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <span class="keywordflow">return</span> HTP_VERSION_STRING_FULL;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;}</div>
<div class="ttc" id="structhtp__cfg__t_html"><div class="ttname"><a href="structhtp__cfg__t.html">htp_cfg_t</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00123">htp_config_private.h:123</a></div></div>
<div class="ttc" id="htp__private_8h_html_a92faf3d17df2d54dd67bd7fbe80fb525"><div class="ttname"><a href="htp__private_8h.html#a92faf3d17df2d54dd67bd7fbe80fb525">htp_connp_RES_HEADERS</a></div><div class="ttdeci">htp_status_t htp_connp_RES_HEADERS(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00642">htp_response.c:642</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a4aafb55d5aa8359ecafbe92234ba5d4c"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a4aafb55d5aa8359ecafbe92234ba5d4c">htp_decoder_cfg_t::u_encoding_decode</a></div><div class="ttdeci">int u_encoding_decode</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00086">htp_config_private.h:86</a></div></div>
<div class="ttc" id="bstr_8c_html_a8eb4cfb22e61753899620617f200a36c"><div class="ttname"><a href="bstr_8c.html#a8eb4cfb22e61753899620617f200a36c">bstr_char_at_end</a></div><div class="ttdeci">int bstr_char_at_end(const bstr *b, size_t pos)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00180">bstr.c:180</a></div></div>
<div class="ttc" id="structhtp__tx__t_html_aa39b15d0438185bf262ab5223fabe1a5"><div class="ttname"><a href="structhtp__tx__t.html#aa39b15d0438185bf262ab5223fabe1a5">htp_tx_t::request_progress</a></div><div class="ttdeci">enum htp_tx_req_progress_t request_progress</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00532">htp.h:532</a></div></div>
<div class="ttc" id="namespaceptxdump_html_ac49595517ea81825a75b18327191db0d"><div class="ttname"><a href="namespaceptxdump.html#ac49595517ea81825a75b18327191db0d">ptxdump.header</a></div><div class="ttdeci">string header</div><div class="ttdef"><b>Definition:</b> <a href="ptxdump_8py_source.html#l00005">ptxdump.py:5</a></div></div>
<div class="ttc" id="htp__private_8h_html_a90ec198a62babe0db3d63024ec9d5118"><div class="ttname"><a href="htp__private_8h.html#a90ec198a62babe0db3d63024ec9d5118">htp_connp_is_line_terminator</a></div><div class="ttdeci">int htp_connp_is_line_terminator(htp_connp_t *connp, unsigned char *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00415">htp_util.c:415</a></div></div>
<div class="ttc" id="bstr_8c_html_a1b9ca92f8699af4136e5d1ed38ff73b0"><div class="ttname"><a href="bstr_8c.html#a1b9ca92f8699af4136e5d1ed38ff73b0">bstr_free</a></div><div class="ttdeci">void bstr_free(bstr *b)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00281">bstr.c:281</a></div></div>
<div class="ttc" id="app-layer-dns-common_8h_html_a1e87af3c18a2fd36c61faf89949bdc3f"><div class="ttname"><a href="app-layer-dns-common_8h.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a></div><div class="ttdeci">uint16_t flags</div><div class="ttdef"><b>Definition:</b> <a href="app-layer-dns-common_8h_source.html#l00039">app-layer-dns-common.h:39</a></div></div>
<div class="ttc" id="structhtp__cfg__t_html_ab0024f30fe7d2623e080fc027ca5aebf"><div class="ttname"><a href="structhtp__cfg__t.html#ab0024f30fe7d2623e080fc027ca5aebf">htp_cfg_t::hook_response_body_data</a></div><div class="ttdeci">htp_hook_t * hook_response_body_data</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00296">htp_config_private.h:296</a></div></div>
<div class="ttc" id="htp__private_8h_html_a779958ef7d3b3742be8b13170c0a8977"><div class="ttname"><a href="htp__private_8h.html#a779958ef7d3b3742be8b13170c0a8977">htp_connp_RES_FINALIZE</a></div><div class="ttdeci">htp_status_t htp_connp_RES_FINALIZE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00864">htp_response.c:864</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_a48cc82a0a83aa5d91e9928b4f012bd78"><div class="ttname"><a href="structhtp__uri__t.html#a48cc82a0a83aa5d91e9928b4f012bd78">htp_uri_t::port</a></div><div class="ttdeci">bstr * port</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00583">htp.h:583</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a3581a94e1e8a838cb5477635213b5be5"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a3581a94e1e8a838cb5477635213b5be5">htp_decoder_cfg_t::url_encoding_invalid_handling</a></div><div class="ttdeci">enum htp_url_encoding_handling_t url_encoding_invalid_handling</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00092">htp_config_private.h:92</a></div></div>
<div class="ttc" id="bstr_8c_html_a91e327898a25d3ade3e38ab1e9d354fe"><div class="ttname"><a href="bstr_8c.html#a91e327898a25d3ade3e38ab1e9d354fe">bstr_util_mem_trim</a></div><div class="ttdeci">void bstr_util_mem_trim(unsigned char **data, size_t *len)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00507">bstr.c:507</a></div></div>
<div class="ttc" id="bstr_8c_html_abaf68b4b27be54655cba0d74c24646c1"><div class="ttname"><a href="bstr_8c.html#abaf68b4b27be54655cba0d74c24646c1">bstr_dup_ex</a></div><div class="ttdeci">bstr * bstr_dup_ex(const bstr *b, size_t offset, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00242">bstr.c:242</a></div></div>
<div class="ttc" id="htp__private_8h_html_a5bf0430de9af721db6e03c90ec63adf6"><div class="ttname"><a href="htp__private_8h.html#a5bf0430de9af721db6e03c90ec63adf6">htp_connp_RES_BODY_DETERMINE</a></div><div class="ttdeci">htp_status_t htp_connp_RES_BODY_DETERMINE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00469">htp_response.c:469</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a3320afa446d95696635a9501e008c5bf"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a3320afa446d95696635a9501e008c5bf">HTP_M_CHECKIN</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00279">htp_core.h:279</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54aaa1e95c235b2860f494d66c974dddd64"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54aaa1e95c235b2860f494d66c974dddd64">HTP_M_PATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00268">htp_core.h:268</a></div></div>
<div class="ttc" id="htp__private_8h_html_a9e2d1a484a0504ed6475a9d89a6608a3"><div class="ttname"><a href="htp__private_8h.html#a9e2d1a484a0504ed6475a9d89a6608a3">htp_is_folding_char</a></div><div class="ttdeci">int htp_is_folding_char(int c)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00402">htp_util.c:402</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a92dc985a5bcb2657195e86e67511fe05"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a92dc985a5bcb2657195e86e67511fe05">HTP_M_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00259">htp_core.h:259</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_adc66e044548690751da36c57d91eefa6"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#adc66e044548690751da36c57d91eefa6">htp_decoder_cfg_t::convert_lowercase</a></div><div class="ttdeci">int convert_lowercase</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00056">htp_config_private.h:56</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a444a002f7c58506f0e49aa51e3df3c65"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a444a002f7c58506f0e49aa51e3df3c65">HTP_M_CONNECT</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00265">htp_core.h:265</a></div></div>
<div class="ttc" id="htp__config_8h_html_a3eff80aa5badb10c27d0b40cecd5767ca1ecadf2370e957351fd527ceb3333347"><div class="ttname"><a href="htp__config_8h.html#a3eff80aa5badb10c27d0b40cecd5767ca1ecadf2370e957351fd527ceb3333347">HTP_SERVER_IIS_5_1</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__config_8h_source.html#l00085">htp_config.h:85</a></div></div>
<div class="ttc" id="structhtp__file__data__t_html_aeef82afd837a136561142fd3576cf566"><div class="ttname"><a href="structhtp__file__data__t.html#aeef82afd837a136561142fd3576cf566">htp_file_data_t::data</a></div><div class="ttdeci">const unsigned char * data</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00136">htp.h:136</a></div></div>
<div class="ttc" id="htp__private_8h_html_ae7cca7a4e5e553b0a1da8d305dd7bae6"><div class="ttname"><a href="htp__private_8h.html#ae7cca7a4e5e553b0a1da8d305dd7bae6">htp_is_uri_unreserved</a></div><div class="ttdeci">int htp_is_uri_unreserved(unsigned char c)</div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a9dc665fc8720e2aa1f60e99d0f33f698"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a9dc665fc8720e2aa1f60e99d0f33f698">HTP_M_LABEL</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00281">htp_core.h:281</a></div></div>
<div class="ttc" id="htp_8h_html_af834d04e2f2dcf25ed5f8cf49efb626a"><div class="ttname"><a href="htp_8h.html#af834d04e2f2dcf25ed5f8cf49efb626a">htp_uri_free</a></div><div class="ttdeci">void htp_uri_free(htp_uri_t *uri)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02552">htp_util.c:2552</a></div></div>
<div class="ttc" id="htp__private_8h_html_aa5e02fbff064b8409e1307bd30fffab8"><div class="ttname"><a href="htp__private_8h.html#aa5e02fbff064b8409e1307bd30fffab8">htp_chomp</a></div><div class="ttdeci">int htp_chomp(unsigned char *data, size_t *len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00125">htp_util.c:125</a></div></div>
<div class="ttc" id="htp__private_8h_html_ae73f7889b2bec1d7c2605c154cc4ecda"><div class="ttname"><a href="htp__private_8h.html#ae73f7889b2bec1d7c2605c154cc4ecda">htp_parse_positive_integer_whitespace</a></div><div class="ttdeci">int64_t htp_parse_positive_integer_whitespace(unsigned char *data, size_t len, int base)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00282">htp_util.c:282</a></div></div>
<div class="ttc" id="structhtp__log__t_html_ade5d89359f7ae30d63d66b92c884693d"><div class="ttname"><a href="structhtp__log__t.html#ade5d89359f7ae30d63d66b92c884693d">htp_log_t::code</a></div><div class="ttdeci">int code</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00159">htp.h:159</a></div></div>
<div class="ttc" id="htp__config_8h_html_ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1"><div class="ttname"><a href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270a6d2f6663537a7ab58561bad71a0cc7f1">HTP_URL_DECODE_REMOVE_PERCENT</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__config_8h_source.html#l00123">htp_config.h:123</a></div></div>
<div class="ttc" id="structhtp__cfg__t_html_a13f2031e76eaae43e8aa57ee7e73574d"><div class="ttname"><a href="structhtp__cfg__t.html#a13f2031e76eaae43e8aa57ee7e73574d">htp_cfg_t::hook_request_body_data</a></div><div class="ttdeci">htp_hook_t * hook_request_body_data</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00238">htp_config_private.h:238</a></div></div>
<div class="ttc" id="htp__private_8h_html_a556b54577b8787f15a9d98955ba6b1a7"><div class="ttname"><a href="htp__private_8h.html#a556b54577b8787f15a9d98955ba6b1a7">htp_unparse_uri_noencode</a></div><div class="ttdeci">bstr * htp_unparse_uri_noencode(htp_uri_t *uri)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02213">htp_util.c:2213</a></div></div>
<div class="ttc" id="htp__private_8h_html_abe97fa5fa00905db42afe94366adcc6a"><div class="ttname"><a href="htp__private_8h.html#abe97fa5fa00905db42afe94366adcc6a">htp_parse_chunked_length</a></div><div class="ttdeci">int64_t htp_parse_chunked_length(unsigned char *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00266">htp_util.c:266</a></div></div>
<div class="ttc" id="htp__private_8h_html_a2702260435d65d58ff1ef824cfdc1091"><div class="ttname"><a href="htp__private_8h.html#a2702260435d65d58ff1ef824cfdc1091">htp_connp_REQ_FINALIZE</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_FINALIZE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00794">htp_request.c:794</a></div></div>
<div class="ttc" id="htp__private_8h_html_a1497c1d24aca2e016fc04475d48616c7"><div class="ttname"><a href="htp__private_8h.html#a1497c1d24aca2e016fc04475d48616c7">htp_connp_is_line_ignorable</a></div><div class="ttdeci">int htp_connp_is_line_ignorable(htp_connp_t *connp, unsigned char *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00444">htp_util.c:444</a></div></div>
<div class="ttc" id="structhtp__conn__t_html_afc4505df29b761e8c086605cef49dd4f"><div class="ttname"><a href="structhtp__conn__t.html#afc4505df29b761e8c086605cef49dd4f">htp_conn_t::server_port</a></div><div class="ttdeci">int server_port</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00078">htp.h:78</a></div></div>
<div class="ttc" id="htp__core_8h_html_a92330c44fc5fe0ceb6fcd0d343b763b3"><div class="ttname"><a href="htp__core_8h.html#a92330c44fc5fe0ceb6fcd0d343b763b3">HTP_URLEN_INVALID_ENCODING</a></div><div class="ttdeci">#define HTP_URLEN_INVALID_ENCODING</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00225">htp_core.h:225</a></div></div>
<div class="ttc" id="htp__private_8h_html_a0ca5d553420839786a3102bc3ab3cb80"><div class="ttname"><a href="htp__private_8h.html#a0ca5d553420839786a3102bc3ab3cb80">htp_extract_quoted_string_as_bstr</a></div><div class="ttdeci">htp_status_t htp_extract_quoted_string_as_bstr(unsigned char *data, size_t len, bstr **out, size_t *endoffset)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02420">htp_util.c:2420</a></div></div>
<div class="ttc" id="structhtp__uri__t_html"><div class="ttname"><a href="structhtp__uri__t.html">htp_uri_t</a></div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00569">htp.h:569</a></div></div>
<div class="ttc" id="structhtp__tx__t_html_a3581876af0f7eaadc85b825b1cc228fd"><div class="ttname"><a href="structhtp__tx__t.html#a3581876af0f7eaadc85b825b1cc228fd">htp_tx_t::response_protocol</a></div><div class="ttdeci">bstr * response_protocol</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00416">htp.h:416</a></div></div>
<div class="ttc" id="htp__private_8h_html_ae9186694fa6cb9d4985d3c66698f0968"><div class="ttname"><a href="htp__private_8h.html#ae9186694fa6cb9d4985d3c66698f0968">htp_req_run_hook_body_data</a></div><div class="ttdeci">htp_status_t htp_req_run_hook_body_data(htp_connp_t *connp, htp_tx_data_t *d)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02359">htp_util.c:2359</a></div></div>
<div class="ttc" id="htp__private_8h_html_aa515e1e25cc42162e95469b4d6c575c9"><div class="ttname"><a href="htp__private_8h.html#aa515e1e25cc42162e95469b4d6c575c9">htp_is_line_empty</a></div><div class="ttdeci">int htp_is_line_empty(unsigned char *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00219">htp_util.c:219</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54ad02ee7c302bf4887e1ddf634143f347b"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ad02ee7c302bf4887e1ddf634143f347b">HTP_M_UPDATE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00280">htp_core.h:280</a></div></div>
<div class="ttc" id="structhtp__cfg__t_html_a2770fa5b59b1f8ce923d4f698cb5f33c"><div class="ttname"><a href="structhtp__cfg__t.html#a2770fa5b59b1f8ce923d4f698cb5f33c">htp_cfg_t::hook_request_file_data</a></div><div class="ttdeci">htp_hook_t * hook_request_file_data</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00244">htp_config_private.h:244</a></div></div>
<div class="ttc" id="bstr_8c_html_acd57e87870f41cc8fc8c7b5560be2a1f"><div class="ttname"><a href="bstr_8c.html#acd57e87870f41cc8fc8c7b5560be2a1f">bstr_util_mem_to_pint</a></div><div class="ttdeci">int64_t bstr_util_mem_to_pint(const void *_data, size_t len, int base, size_t *lastlen)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00391">bstr.c:391</a></div></div>
<div class="ttc" id="suricata-common_8h_html_a7e9938e922f1dfd71bc01995bc2b7777"><div class="ttname"><a href="suricata-common_8h.html#a7e9938e922f1dfd71bc01995bc2b7777">strlcat</a></div><div class="ttdeci">size_t strlcat(char *, const char *src, size_t siz)</div><div class="ttdef"><b>Definition:</b> <a href="util-strlcatu_8c_source.html#l00050">util-strlcatu.c:50</a></div></div>
<div class="ttc" id="htp__private_8h_html_af7b83f68a53afa0a16e0d78300b63a46"><div class="ttname"><a href="htp__private_8h.html#af7b83f68a53afa0a16e0d78300b63a46">htp_connp_REQ_HEADERS</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_HEADERS(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00616">htp_request.c:616</a></div></div>
<div class="ttc" id="bstr_8h_html_a36b55b191f4f0e5276db7500e92ff011"><div class="ttname"><a href="bstr_8h.html#a36b55b191f4f0e5276db7500e92ff011">bstr_len</a></div><div class="ttdeci">#define bstr_len(X)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8h_source.html#l00077">bstr.h:77</a></div></div>
<div class="ttc" id="bstr_8c_html_a75dc35dde15052db45ac0496e33b76ce"><div class="ttname"><a href="bstr_8c.html#a75dc35dde15052db45ac0496e33b76ce">bstr_chr</a></div><div class="ttdeci">int bstr_chr(const bstr *b, int c)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00194">bstr.c:194</a></div></div>
<div class="ttc" id="htp__utf8__decoder_8c_html_a3b58cd9823df2a9e86e3a730a6c922b3"><div class="ttname"><a href="htp__utf8__decoder_8c.html#a3b58cd9823df2a9e86e3a730a6c922b3">htp_utf8_decode_allow_overlong</a></div><div class="ttdeci">uint32_t htp_utf8_decode_allow_overlong(uint32_t *state, uint32_t *codep, uint32_t byte)</div><div class="ttdef"><b>Definition:</b> <a href="htp__utf8__decoder_8c_source.html#l00129">htp_utf8_decoder.c:129</a></div></div>
<div class="ttc" id="htp__private_8h_html_ac19fd0827df78d7618a6360a0a9e2ac2"><div class="ttname"><a href="htp__private_8h.html#ac19fd0827df78d7618a6360a0a9e2ac2">htp_utf8_decode_path_inplace</a></div><div class="ttdeci">void htp_utf8_decode_path_inplace(htp_cfg_t *cfg, htp_tx_t *tx, bstr *path)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00887">htp_util.c:887</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a5e2d5eef1be3af382b6f6f15973eb8c8"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a5e2d5eef1be3af382b6f6f15973eb8c8">htp_decoder_cfg_t::u_encoding_unwanted</a></div><div class="ttdeci">enum htp_unwanted_t u_encoding_unwanted</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00089">htp_config_private.h:89</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a8b8319ecb6ac2df1d243d4a913067a4a"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a8b8319ecb6ac2df1d243d4a913067a4a">HTP_M_UNCHECKOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00278">htp_core.h:278</a></div></div>
<div class="ttc" id="htp__core_8h_html_a42893d271da65da8619602fca022a663"><div class="ttname"><a href="htp__core_8h.html#a42893d271da65da8619602fca022a663">HTP_DECLINED</a></div><div class="ttdeci">#define HTP_DECLINED</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00078">htp_core.h:78</a></div></div>
<div class="ttc" id="bstr_8c_html_acbbec871f8fd06709d92af6892b264a2"><div class="ttname"><a href="bstr_8c.html#acbbec871f8fd06709d92af6892b264a2">bstr_add_noex</a></div><div class="ttdeci">bstr * bstr_add_noex(bstr *destination, const bstr *source)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00098">bstr.c:98</a></div></div>
<div class="ttc" id="htp__private_8h_html_ac6178cc04104e5e5e469489f5e77c04d"><div class="ttname"><a href="htp__private_8h.html#ac6178cc04104e5e5e469489f5e77c04d">htp_connp_REQ_CONNECT_WAIT_RESPONSE</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_CONNECT_WAIT_RESPONSE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00384">htp_request.c:384</a></div></div>
<div class="ttc" id="htp__private_8h_html_af31ead38ae0851c906b72d93d9a29d5a"><div class="ttname"><a href="htp__private_8h.html#af31ead38ae0851c906b72d93d9a29d5a">htp_connp_out_state_as_string</a></div><div class="ttdeci">char * htp_connp_out_state_as_string(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02148">htp_util.c:2148</a></div></div>
<div class="ttc" id="htp__private_8h_html_a0b18b82f32e1f78aede068a2aafc4632"><div class="ttname"><a href="htp__private_8h.html#a0b18b82f32e1f78aede068a2aafc4632">htp_normalize_parsed_uri</a></div><div class="ttdeci">int htp_normalize_parsed_uri(htp_tx_t *tx, htp_uri_t *parsed_uri_incomplete, htp_uri_t *parsed_uri)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l01694">htp_util.c:1694</a></div></div>
<div class="ttc" id="structhtp__log__t_html_adf6c388f84a7b470da775e952078e580"><div class="ttname"><a href="structhtp__log__t.html#adf6c388f84a7b470da775e952078e580">htp_log_t::line</a></div><div class="ttdeci">unsigned int line</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00165">htp.h:165</a></div></div>
<div class="ttc" id="htp__config_8h_html_afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a"><div class="ttname"><a href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7a5e629e54f4afb898d7b5a2eb439bf19a">HTP_DECODER_URL_PATH</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__config_8h_source.html#l00059">htp_config.h:59</a></div></div>
<div class="ttc" id="bstr_8c_html_ad866778a2b2da1cee5a668f7e3bb99de"><div class="ttname"><a href="bstr_8c.html#ad866778a2b2da1cee5a668f7e3bb99de">bstr_dup_lower</a></div><div class="ttdeci">bstr * bstr_dup_lower(const bstr *b)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00250">bstr.c:250</a></div></div>
<div class="ttc" id="htp__list_8h_html_a37f080c122cbc8cd4ddbd676cedb0185"><div class="ttname"><a href="htp__list_8h.html#a37f080c122cbc8cd4ddbd676cedb0185">htp_list_add</a></div><div class="ttdeci">#define htp_list_add</div><div class="ttdef"><b>Definition:</b> <a href="htp__list_8h_source.html#l00049">htp_list.h:49</a></div></div>
<div class="ttc" id="structhtp__cfg__t_html_ad71926e0c96be6b4d6ec97e03b133c40"><div class="ttname"><a href="structhtp__cfg__t.html#ad71926e0c96be6b4d6ec97e03b133c40">htp_cfg_t::hook_log</a></div><div class="ttdeci">htp_hook_t * hook_log</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00328">htp_config_private.h:328</a></div></div>
<div class="ttc" id="htp_8h_html_a3eef4d9c98d7bbfbbcb1ff7c5317f3c6"><div class="ttname"><a href="htp_8h.html#a3eef4d9c98d7bbfbbcb1ff7c5317f3c6">htp_log</a></div><div class="ttdeci">void htp_log(htp_connp_t *connp, const char *file, int line, enum htp_log_level_t level, int code, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00339">htp_util.c:339</a></div></div>
<div class="ttc" id="namespaceptxdump_html_a207cee046b973ee54c9b97086ed9a95c"><div class="ttname"><a href="namespaceptxdump.html#a207cee046b973ee54c9b97086ed9a95c">ptxdump.out</a></div><div class="ttdeci">tuple out</div><div class="ttdef"><b>Definition:</b> <a href="ptxdump_8py_source.html#l00029">ptxdump.py:29</a></div></div>
<div class="ttc" id="htp__private_8h_html_a7a0e47fdda476b38045a7d3406fb51ee"><div class="ttname"><a href="htp__private_8h.html#a7a0e47fdda476b38045a7d3406fb51ee">htp_is_token</a></div><div class="ttdeci">int htp_is_token(int c)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00110">htp_util.c:110</a></div></div>
<div class="ttc" id="htp__core_8h_html_a97436c5cd08710272ed1062c7bb9db0f"><div class="ttname"><a href="htp__core_8h.html#a97436c5cd08710272ed1062c7bb9db0f">HTP_ERROR</a></div><div class="ttdeci">#define HTP_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00071">htp_core.h:71</a></div></div>
<div class="ttc" id="htp__config_8h_html_a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6"><div class="ttname"><a href="htp__config_8h.html#a8da3cd76713e072955ccd6e3197a91a4a4e52c17356e7ad991c7fab68ad1db2e6">HTP_UNWANTED_IGNORE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__config_8h_source.html#l00106">htp_config.h:106</a></div></div>
<div class="ttc" id="htp__private_8h_html_a01068fcd4418a90ea81a2ad5e4eb8c81"><div class="ttname"><a href="htp__private_8h.html#a01068fcd4418a90ea81a2ad5e4eb8c81">htp_is_lws</a></div><div class="ttdeci">int htp_is_lws(int c)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00049">htp_util.c:49</a></div></div>
<div class="ttc" id="htp__private_8h_html_ac27d9ef825468ab08cf316b9b527a8cc"><div class="ttname"><a href="htp__private_8h.html#ac27d9ef825468ab08cf316b9b527a8cc">htp_print_log</a></div><div class="ttdeci">void htp_print_log(FILE *stream, htp_log_t *log)</div></div>
<div class="ttc" id="htp__private_8h_html_a2c9732ce72c12038353a4483475e180c"><div class="ttname"><a href="htp__private_8h.html#a2c9732ce72c12038353a4483475e180c">htp_connp_RES_BODY_IDENTITY_STREAM_CLOSE</a></div><div class="ttdeci">htp_status_t htp_connp_RES_BODY_IDENTITY_STREAM_CLOSE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00440">htp_response.c:440</a></div></div>
<div class="ttc" id="htp_8h_html_aafd2659394bb762f2a623bc9b2ee59bd"><div class="ttname"><a href="htp_8h.html#aafd2659394bb762f2a623bc9b2ee59bd">htp_get_version</a></div><div class="ttdeci">char * htp_get_version(void)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02576">htp_util.c:2576</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_aeab39f38369303dc312a66db518f770eab83433ab84bcfbb42e120443ac8f8f12"><div class="ttname"><a href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770eab83433ab84bcfbb42e120443ac8f8f12">HTP_RESPONSE_BODY</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00088">htp_transaction.h:88</a></div></div>
<div class="ttc" id="htp__core_8h_html_ab0c0690917a1e9cb06dd3d95e0911624"><div class="ttname"><a href="htp__core_8h.html#ab0c0690917a1e9cb06dd3d95e0911624">HTP_URLEN_OVERLONG_U</a></div><div class="ttdeci">#define HTP_URLEN_OVERLONG_U</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00226">htp_core.h:226</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54ae992e5453e736431a1194139c3bc1a8d"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ae992e5453e736431a1194139c3bc1a8d">HTP_M_LOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00274">htp_core.h:274</a></div></div>
<div class="ttc" id="htp__private_8h_html_acfb131d9a3925c753f4beffad0f07e84"><div class="ttname"><a href="htp__private_8h.html#acfb131d9a3925c753f4beffad0f07e84">htp_connp_REQ_LINE</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_LINE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00780">htp_request.c:780</a></div></div>
<div class="ttc" id="htp__private_8h_html_aa5ab1e26414167266d8d0b98eb712723"><div class="ttname"><a href="htp__private_8h.html#aa5ab1e26414167266d8d0b98eb712723">htp_connp_REQ_BODY_IDENTITY</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_BODY_IDENTITY(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00534">htp_request.c:534</a></div></div>
<div class="ttc" id="htp__core_8h_html_a217e63fc16a9cb7437ed98be4f8bf4ec"><div class="ttname"><a href="htp__core_8h.html#a217e63fc16a9cb7437ed98be4f8bf4ec">HTP_HOSTU_INVALID</a></div><div class="ttdeci">#define HTP_HOSTU_INVALID</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00222">htp_core.h:222</a></div></div>
<div class="ttc" id="htp__private_8h_html_ae4a3e37c2a1e728db9f80cca8e53c6fa"><div class="ttname"><a href="htp__private_8h.html#ae4a3e37c2a1e728db9f80cca8e53c6fa">htp_connp_REQ_IDLE</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_IDLE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00821">htp_request.c:821</a></div></div>
<div class="ttc" id="htp__private_8h_html_a68a568e948b5a609fb4900152498142b"><div class="ttname"><a href="htp__private_8h.html#a68a568e948b5a609fb4900152498142b">htp_replace_hostname</a></div><div class="ttdeci">void htp_replace_hostname(htp_connp_t *connp, htp_uri_t *parsed_uri, bstr *hostname)</div></div>
<div class="ttc" id="structhtp__conn__t_html_ac79e519e7d829bb187b62a31b104073a"><div class="ttname"><a href="structhtp__conn__t.html#ac79e519e7d829bb187b62a31b104073a">htp_conn_t::messages</a></div><div class="ttdeci">htp_list_t * messages</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00088">htp.h:88</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a71d21b7fb2b92d098054737faf6a8ce1"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a71d21b7fb2b92d098054737faf6a8ce1">HTP_M_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00287">htp_core.h:287</a></div></div>
<div class="ttc" id="structhtp__connp__t_html_a11ce71addc76efd46479cc802d9b711e"><div class="ttname"><a href="structhtp__connp__t.html#a11ce71addc76efd46479cc802d9b711e">htp_connp_t::in_state</a></div><div class="ttdeci">int(* in_state)(htp_connp_t *)</div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00166">htp_connection_parser_private.h:166</a></div></div>
<div class="ttc" id="htp__private_8h_html_a78975b59c610a8b5cd834b6c7ad7524b"><div class="ttname"><a href="htp__private_8h.html#a78975b59c610a8b5cd834b6c7ad7524b">htp_connp_REQ_BODY_CHUNKED_LENGTH</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_BODY_CHUNKED_LENGTH(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00482">htp_request.c:482</a></div></div>
<div class="ttc" id="htp__core_8h_html_a2f632f5c23ad47276a8deb2e94c4c4a2"><div class="ttname"><a href="htp__core_8h.html#a2f632f5c23ad47276a8deb2e94c4c4a2">HTP_PATH_UTF8_VALID</a></div><div class="ttdeci">#define HTP_PATH_UTF8_VALID</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00217">htp_core.h:217</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_a8c36a8bd73584ee5f2479aeb62ab6be7"><div class="ttname"><a href="structhtp__uri__t.html#a8c36a8bd73584ee5f2479aeb62ab6be7">htp_uri_t::scheme</a></div><div class="ttdeci">bstr * scheme</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00571">htp.h:571</a></div></div>
<div class="ttc" id="htp__private_8h_html_a238c39a6d7fd7f35735f9c97a1b2aa66"><div class="ttname"><a href="htp__private_8h.html#a238c39a6d7fd7f35735f9c97a1b2aa66">htp_is_separator</a></div><div class="ttdeci">int htp_is_separator(int c)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00060">htp_util.c:60</a></div></div>
<div class="ttc" id="structbstr__t_html"><div class="ttname"><a href="structbstr__t.html">bstr_t</a></div><div class="ttdef"><b>Definition:</b> <a href="bstr_8h_source.html#l00057">bstr.h:57</a></div></div>
<div class="ttc" id="htp__config_8h_html_afa49656ef495bb1c8d129342681f62e7"><div class="ttname"><a href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7">htp_decoder_ctx_t</a></div><div class="ttdeci">htp_decoder_ctx_t</div><div class="ttdef"><b>Definition:</b> <a href="htp__config_8h_source.html#l00051">htp_config.h:51</a></div></div>
<div class="ttc" id="structhtp__log__t_html_addd0658bc5b7e8d6baaa41c4b6be3a2f"><div class="ttname"><a href="structhtp__log__t.html#addd0658bc5b7e8d6baaa41c4b6be3a2f">htp_log_t::msg</a></div><div class="ttdeci">const char * msg</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00153">htp.h:153</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_aeab39f38369303dc312a66db518f770ea699bb7f8e7913d025319d669462a384a"><div class="ttname"><a href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770ea699bb7f8e7913d025319d669462a384a">HTP_RESPONSE_HEADERS</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00087">htp_transaction.h:87</a></div></div>
<div class="ttc" id="structhtp__connp__t_html_a120f9c4000efed251981380867869906"><div class="ttname"><a href="structhtp__connp__t.html#a120f9c4000efed251981380867869906">htp_connp_t::out_state</a></div><div class="ttdeci">int(* out_state)(htp_connp_t *)</div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00245">htp_connection_parser_private.h:245</a></div></div>
<div class="ttc" id="htp__core_8h_html_a74b925fb9a95391ab69210d1acba5534"><div class="ttname"><a href="htp__core_8h.html#a74b925fb9a95391ab69210d1acba5534">HTP_PATH_RAW_NUL</a></div><div class="ttdeci">#define HTP_PATH_RAW_NUL</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00212">htp_core.h:212</a></div></div>
<div class="ttc" id="htp__core_8h_html_ab8a71422665c0773654b9b4d96f01e31"><div class="ttname"><a href="htp__core_8h.html#ab8a71422665c0773654b9b4d96f01e31">htp_status_t</a></div><div class="ttdeci">int htp_status_t</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00046">htp_core.h:46</a></div></div>
<div class="ttc" id="htp__private_8h_html_a75ad702e0957be72f80dc27900f83ec7"><div class="ttname"><a href="htp__private_8h.html#a75ad702e0957be72f80dc27900f83ec7">htp_utf8_validate_path</a></div><div class="ttdeci">void htp_utf8_validate_path(htp_tx_t *tx, bstr *path)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00997">htp_util.c:997</a></div></div>
<div class="ttc" id="htp__core_8h_html_afdc5297283d3fac7eb14fe5e54ca9553"><div class="ttname"><a href="htp__core_8h.html#afdc5297283d3fac7eb14fe5e54ca9553">HTP_PATH_ENCODED_NUL</a></div><div class="ttdeci">#define HTP_PATH_ENCODED_NUL</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00211">htp_core.h:211</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a0effe6f68dc8d9cc77312dc02fee2a96"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a0effe6f68dc8d9cc77312dc02fee2a96">htp_decoder_cfg_t::url_encoding_invalid_unwanted</a></div><div class="ttdeci">enum htp_unwanted_t url_encoding_invalid_unwanted</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00095">htp_config_private.h:95</a></div></div>
<div class="ttc" id="structhtp__file__data__t_html"><div class="ttname"><a href="structhtp__file__data__t.html">htp_file_data_t</a></div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00131">htp.h:131</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a678897d56f146a6fee52fb8a49287943"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a678897d56f146a6fee52fb8a49287943">htp_decoder_cfg_t::plusspace_decode</a></div><div class="ttdeci">int plusspace_decode</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00065">htp_config_private.h:65</a></div></div>
<div class="ttc" id="htp__core_8h_html_a8338230c0230fa62aeed6c670215aeed"><div class="ttname"><a href="htp__core_8h.html#a8338230c0230fa62aeed6c670215aeed">HTP_PATH_UTF8_INVALID</a></div><div class="ttdeci">#define HTP_PATH_UTF8_INVALID</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00218">htp_core.h:218</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_a6b8fe249b3b4e2ed3dc094a6607440aba3f6ce0a8879ff735d58169bf7dfa1c7d"><div class="ttname"><a href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba3f6ce0a8879ff735d58169bf7dfa1c7d">HTP_REQUEST_TRAILER</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00080">htp_transaction.h:80</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_a6b8fe249b3b4e2ed3dc094a6607440abad900599750d034beee98cf5deb506a24"><div class="ttname"><a href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440abad900599750d034beee98cf5deb506a24">HTP_REQUEST_COMPLETE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00081">htp_transaction.h:81</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_a9dbe72d7b3050f30c2e18cc5bb5f06d0"><div class="ttname"><a href="structhtp__uri__t.html#a9dbe72d7b3050f30c2e18cc5bb5f06d0">htp_uri_t::password</a></div><div class="ttdeci">bstr * password</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00577">htp.h:577</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54aafa8a108a25362c7eba5ad7c72ced5a8"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54aafa8a108a25362c7eba5ad7c72ced5a8">HTP_M_BASELINE_CONTROL</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00285">htp_core.h:285</a></div></div>
<div class="ttc" id="bstr_8h_html_ac01ba8e02318259790f7f7a4cc635904"><div class="ttname"><a href="bstr_8h.html#ac01ba8e02318259790f7f7a4cc635904">bstr_ptr</a></div><div class="ttdeci">#define bstr_ptr(X)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8h_source.html#l00079">bstr.h:79</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a48606fdd6ec8271528a54249578a4c7d"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a48606fdd6ec8271528a54249578a4c7d">HTP_M_PROPFIND</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00269">htp_core.h:269</a></div></div>
<div class="ttc" id="htp__hooks_8c_html_a8981d368a73f78ddfb4ad1de1f4a5fc2"><div class="ttname"><a href="htp__hooks_8c.html#a8981d368a73f78ddfb4ad1de1f4a5fc2">htp_hook_run_all</a></div><div class="ttdeci">htp_status_t htp_hook_run_all(htp_hook_t *hook, void *user_data)</div><div class="ttdef"><b>Definition:</b> <a href="htp__hooks_8c_source.html#l00120">htp_hooks.c:120</a></div></div>
<div class="ttc" id="app-layer-htp_8h_html_abe222f6d3581e7920dcad5306cc906a8"><div class="ttname"><a href="app-layer-htp_8h.html#abe222f6d3581e7920dcad5306cc906a8">data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="app-layer-htp_8h_source.html#l00506">app-layer-htp.h:506</a></div></div>
<div class="ttc" id="htp__private_8h_html_a1b95d113c24de4c93db72889c738275d"><div class="ttname"><a href="htp__private_8h.html#a1b95d113c24de4c93db72889c738275d">htp_connp_RES_IDLE</a></div><div class="ttdeci">htp_status_t htp_connp_RES_IDLE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00875">htp_response.c:875</a></div></div>
<div class="ttc" id="util-decode-mime_8c_html_a876ce77f3c672c7162658151e648389e"><div class="ttname"><a href="util-decode-mime_8c.html#a876ce77f3c672c7162658151e648389e">CR</a></div><div class="ttdeci">#define CR</div><div class="ttdef"><b>Definition:</b> <a href="util-decode-mime_8c_source.html#l00036">util-decode-mime.c:36</a></div></div>
<div class="ttc" id="structhtp__tx__t_html_a8367e21eff39c4d2d5a6c500560b38e9"><div class="ttname"><a href="structhtp__tx__t.html#a8367e21eff39c4d2d5a6c500560b38e9">htp_tx_t::response_status_expected_number</a></div><div class="ttdeci">int response_status_expected_number</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00440">htp.h:440</a></div></div>
<div class="ttc" id="structhtp__log__t_html_a466db643e80ca5a967ece0ce42bb906f"><div class="ttname"><a href="structhtp__log__t.html#a466db643e80ca5a967ece0ce42bb906f">htp_log_t::level</a></div><div class="ttdeci">enum htp_log_level_t level</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00156">htp.h:156</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a0ed8fcf196229f20d38fdd0182ef4850"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a0ed8fcf196229f20d38fdd0182ef4850">htp_decoder_cfg_t::utf8_invalid_unwanted</a></div><div class="ttdeci">enum htp_unwanted_t utf8_invalid_unwanted</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00107">htp_config_private.h:107</a></div></div>
<div class="ttc" id="htp__core_8h_html_a2a53678e20da792418ead2158fc695a2"><div class="ttname"><a href="htp__core_8h.html#a2a53678e20da792418ead2158fc695a2">HTP_PATH_ENCODED_SEPARATOR</a></div><div class="ttdeci">#define HTP_PATH_ENCODED_SEPARATOR</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00216">htp_core.h:216</a></div></div>
<div class="ttc" id="structhtp__connp__t_html_af72462e7cec991f85e160c8add033a44"><div class="ttname"><a href="structhtp__connp__t.html#af72462e7cec991f85e160c8add033a44">htp_connp_t::last_error</a></div><div class="ttdeci">htp_log_t * last_error</div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00069">htp_connection_parser_private.h:69</a></div></div>
<div class="ttc" id="bstr_8c_html_ab4fc824d8df74ad6863a085f3901d30f"><div class="ttname"><a href="bstr_8c.html#ab4fc824d8df74ad6863a085f3901d30f">bstr_dup</a></div><div class="ttdeci">bstr * bstr_dup(const bstr *b)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00234">bstr.c:234</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a9555f67f0605ac5d3866475d8843f288"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a9555f67f0605ac5d3866475d8843f288">htp_decoder_cfg_t::utf8_convert_bestfit</a></div><div class="ttdeci">int utf8_convert_bestfit</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00110">htp_config_private.h:110</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_aeab39f38369303dc312a66db518f770ea2c8fd05fc9348dea11f27c37d2543b92"><div class="ttname"><a href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770ea2c8fd05fc9348dea11f27c37d2543b92">HTP_RESPONSE_LINE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00086">htp_transaction.h:86</a></div></div>
<div class="ttc" id="bstr_8c_html_ae7440589d0619590384aa3ac7070ba89"><div class="ttname"><a href="bstr_8c.html#ae7440589d0619590384aa3ac7070ba89">bstr_chop</a></div><div class="ttdeci">void bstr_chop(bstr *b)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00188">bstr.c:188</a></div></div>
<div class="ttc" id="htp__private_8h_html_aa60cc60143dfb38260549c4df5219727"><div class="ttname"><a href="htp__private_8h.html#aa60cc60143dfb38260549c4df5219727">htp_res_run_hook_body_data</a></div><div class="ttdeci">htp_status_t htp_res_run_hook_body_data(htp_connp_t *connp, htp_tx_data_t *d)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02396">htp_util.c:2396</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_a08858fedcb3a6df8d8cd500aed71d9eb"><div class="ttname"><a href="structhtp__uri__t.html#a08858fedcb3a6df8d8cd500aed71d9eb">htp_uri_t::path</a></div><div class="ttdeci">bstr * path</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00593">htp.h:593</a></div></div>
<div class="ttc" id="structhtp__cfg__t_html_ada885c14dabd8765749681c7924c1c6d"><div class="ttname"><a href="structhtp__cfg__t.html#ada885c14dabd8765749681c7924c1c6d">htp_cfg_t::server_personality</a></div><div class="ttdeci">enum htp_server_personality_t server_personality</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00152">htp_config_private.h:152</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54ad35a531e806c138340f224e5b582f4b7"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ad35a531e806c138340f224e5b582f4b7">HTP_M_UNLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00275">htp_core.h:275</a></div></div>
<div class="ttc" id="htp__core_8h_html_acd8a1fab81f3886fd6c03201296e28f1"><div class="ttname"><a href="htp__core_8h.html#acd8a1fab81f3886fd6c03201296e28f1">HTP_URLEN_RAW_NUL</a></div><div class="ttdeci">#define HTP_URLEN_RAW_NUL</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00228">htp_core.h:228</a></div></div>
<div class="ttc" id="structhtp__connp__t_html_a867300cf820a2559effa6286625d8144"><div class="ttname"><a href="structhtp__connp__t.html#a867300cf820a2559effa6286625d8144">htp_connp_t::put_file</a></div><div class="ttdeci">htp_file_t * put_file</div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00257">htp_connection_parser_private.h:257</a></div></div>
<div class="ttc" id="htp__private_8h_html_a17f65da97005b7ac34881ba9ff83c8da"><div class="ttname"><a href="htp__private_8h.html#a17f65da97005b7ac34881ba9ff83c8da">htp_parse_header_hostport</a></div><div class="ttdeci">htp_status_t htp_parse_header_hostport(bstr *authority, bstr **hostname, bstr **port, int *port_number, uint64_t *flags)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00613">htp_util.c:613</a></div></div>
<div class="ttc" id="structhtp__tx__data__t_html_a75a8bb0d2f0479f15d8e87779ff0922d"><div class="ttname"><a href="structhtp__tx__data__t.html#a75a8bb0d2f0479f15d8e87779ff0922d">htp_tx_data_t::data</a></div><div class="ttdeci">const unsigned char * data</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00550">htp.h:550</a></div></div>
<div class="ttc" id="htp__private_8h_html_ad43c81727dd2888a32e4fc692b472249"><div class="ttname"><a href="htp__private_8h.html#ad43c81727dd2888a32e4fc692b472249">htp_convert_method_to_number</a></div><div class="ttdeci">int htp_convert_method_to_number(bstr *)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00174">htp_util.c:174</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a0afd5bbc37f98e945e2ae566d7d02a8b"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a0afd5bbc37f98e945e2ae566d7d02a8b">HTP_M_COPY</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00272">htp_core.h:272</a></div></div>
<div class="ttc" id="htp__core_8h_html_ab715e1a7cc106d09642691072554e41f"><div class="ttname"><a href="htp__core_8h.html#ab715e1a7cc106d09642691072554e41f">HTP_PATH_UTF8_OVERLONG</a></div><div class="ttdeci">#define HTP_PATH_UTF8_OVERLONG</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00219">htp_core.h:219</a></div></div>
<div class="ttc" id="htp__private_8h_html_a81fca26cac57032120c6796bda2a660c"><div class="ttname"><a href="htp__private_8h.html#a81fca26cac57032120c6796bda2a660c">htp_connp_in_state_as_string</a></div><div class="ttdeci">char * htp_connp_in_state_as_string(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02125">htp_util.c:2125</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a749c276cad23214291252a8bf85ca68e"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a749c276cad23214291252a8bf85ca68e">HTP_M_PUT</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00262">htp_core.h:262</a></div></div>
<div class="ttc" id="htp__private_8h_html_a8154aaa13d12e1fea9b066e0881bd125"><div class="ttname"><a href="htp__private_8h.html#a8154aaa13d12e1fea9b066e0881bd125">htp_is_space</a></div><div class="ttdeci">int htp_is_space(int c)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00154">htp_util.c:154</a></div></div>
<div class="ttc" id="htp__core_8h_html_a60f2248ce81643c7838f340e9c6edd41"><div class="ttname"><a href="htp__core_8h.html#a60f2248ce81643c7838f340e9c6edd41">HTP_URLEN_HALF_FULL_RANGE</a></div><div class="ttdeci">#define HTP_URLEN_HALF_FULL_RANGE</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00227">htp_core.h:227</a></div></div>
<div class="ttc" id="htp__core_8h_html_ae0669683ca6ccd3e29f48fcab704a520"><div class="ttname"><a href="htp__core_8h.html#ae0669683ca6ccd3e29f48fcab704a520">HTP_PATH_HALF_FULL_RANGE</a></div><div class="ttdeci">#define HTP_PATH_HALF_FULL_RANGE</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00220">htp_core.h:220</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_a6b8fe249b3b4e2ed3dc094a6607440aba2f3a67a32561697ab964035aa75e5d96"><div class="ttname"><a href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba2f3a67a32561697ab964035aa75e5d96">HTP_REQUEST_HEADERS</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00078">htp_transaction.h:78</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a068bb34420bf47015361494009bbcf7f"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a068bb34420bf47015361494009bbcf7f">HTP_M_GET</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00261">htp_core.h:261</a></div></div>
<div class="ttc" id="bstr_8c_html_adac130490755d97728f1c2e6b6330333"><div class="ttname"><a href="bstr_8c.html#adac130490755d97728f1c2e6b6330333">bstr_add_c_noex</a></div><div class="ttdeci">bstr * bstr_add_c_noex(bstr *destination, const char *source)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00062">bstr.c:62</a></div></div>
<div class="ttc" id="htp__private_8h_html_a24a112bbe8db96d22a8d421a6ea6ac74"><div class="ttname"><a href="htp__private_8h.html#a24a112bbe8db96d22a8d421a6ea6ac74">htp_connp_REQ_BODY_CHUNKED_DATA_END</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_BODY_CHUNKED_DATA_END(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00413">htp_request.c:413</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_a47c71ba08e23ead4aa38c81f853c9138"><div class="ttname"><a href="structhtp__uri__t.html#a47c71ba08e23ead4aa38c81f853c9138">htp_uri_t::port_number</a></div><div class="ttdeci">int port_number</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00590">htp.h:590</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54ae846c2a168246ac43168e52d04817a91"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ae846c2a168246ac43168e52d04817a91">HTP_M_MKCOL</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00271">htp_core.h:271</a></div></div>
<div class="ttc" id="structhtp__connp__t_html_a0d6be360cc9ba3f11d89696e5c9c5640"><div class="ttname"><a href="structhtp__connp__t.html#a0d6be360cc9ba3f11d89696e5c9c5640">htp_connp_t::in_tx</a></div><div class="ttdeci">htp_tx_t * in_tx</div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00143">htp_connection_parser_private.h:143</a></div></div>
<div class="ttc" id="htp__private_8h_html_a854ce501c5216103458afecdadb82d0b"><div class="ttname"><a href="htp__private_8h.html#a854ce501c5216103458afecdadb82d0b">htp_decode_path_inplace</a></div><div class="ttdeci">int htp_decode_path_inplace(htp_tx_t *tx, bstr *path)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l01190">htp_util.c:1190</a></div></div>
<div class="ttc" id="htp__private_8h_html_ae3b688cf78f951a218afde6d2bb3b763"><div class="ttname"><a href="htp__private_8h.html#ae3b688cf78f951a218afde6d2bb3b763">htp_normalize_uri_path_inplace</a></div><div class="ttdeci">void htp_normalize_uri_path_inplace(bstr *s)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l01940">htp_util.c:1940</a></div></div>
<div class="ttc" id="htp__private_8h_html_a4159843ae10e6b8161928e6275f6c488"><div class="ttname"><a href="htp__private_8h.html#a4159843ae10e6b8161928e6275f6c488">htp_parse_hostport</a></div><div class="ttdeci">htp_status_t htp_parse_hostport(bstr *authority, bstr **hostname, bstr **port, int *port_number, int *invalid)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00485">htp_util.c:485</a></div></div>
<div class="ttc" id="structhtp__tx__t_html_ab2a8be86c0601f127c35918f4803f428"><div class="ttname"><a href="structhtp__tx__t.html#ab2a8be86c0601f127c35918f4803f428">htp_tx_t::response_progress</a></div><div class="ttdeci">enum htp_tx_res_progress_t response_progress</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00535">htp.h:535</a></div></div>
<div class="ttc" id="htp__private_8h_html_ab601564fadb2bb9ff37cd75b448a03d7"><div class="ttname"><a href="htp__private_8h.html#ab601564fadb2bb9ff37cd75b448a03d7">htp_connp_RES_BODY_CHUNKED_LENGTH</a></div><div class="ttdeci">htp_status_t htp_connp_RES_BODY_CHUNKED_LENGTH(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00349">htp_response.c:349</a></div></div>
<div class="ttc" id="util-decode-mime_8c_html_a350c9d6cb81908d59427ee96844d1a9c"><div class="ttname"><a href="util-decode-mime_8c.html#a350c9d6cb81908d59427ee96844d1a9c">LF</a></div><div class="ttdeci">#define LF</div><div class="ttdef"><b>Definition:</b> <a href="util-decode-mime_8c_source.html#l00037">util-decode-mime.c:37</a></div></div>
<div class="ttc" id="htp__config_8h_html_ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94"><div class="ttname"><a href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270afaa8571cb7be5cfeb5fbc09ebee19f94">HTP_URL_DECODE_PROCESS_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__config_8h_source.html#l00126">htp_config.h:126</a></div></div>
<div class="ttc" id="structhtp__tx__t_html_ad2761959ebfa28e86a37d71826c38d44"><div class="ttname"><a href="structhtp__tx__t.html#ad2761959ebfa28e86a37d71826c38d44">htp_tx_t::hook_response_body_data</a></div><div class="ttdeci">htp_hook_t * hook_response_body_data</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00357">htp.h:357</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a2960d5cf29848f89257013ded88041d9"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a2960d5cf29848f89257013ded88041d9">HTP_M_TRACE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00267">htp_core.h:267</a></div></div>
<div class="ttc" id="htp__private_8h_html_a3742fd84a15ebfa867623dd7bf26c0e9"><div class="ttname"><a href="htp__private_8h.html#a3742fd84a15ebfa867623dd7bf26c0e9">htp_parse_ct_header</a></div><div class="ttdeci">htp_status_t htp_parse_ct_header(bstr *header, bstr **ct)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02486">htp_util.c:2486</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_ad66eead95cc67ebb9f5952643e8eb72e"><div class="ttname"><a href="structhtp__uri__t.html#ad66eead95cc67ebb9f5952643e8eb72e">htp_uri_t::username</a></div><div class="ttdeci">bstr * username</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00574">htp.h:574</a></div></div>
<div class="ttc" id="bstr_8c_html_a6b551b4e84311c0608d2a359440d9118"><div class="ttname"><a href="bstr_8c.html#a6b551b4e84311c0608d2a359440d9118">bstr_alloc</a></div><div class="ttdeci">bstr * bstr_alloc(size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00043">bstr.c:43</a></div></div>
<div class="ttc" id="structhtp__connp__t_html_ab1d498ba10537429d27f879fcc8d85f0"><div class="ttname"><a href="structhtp__connp__t.html#ab1d498ba10537429d27f879fcc8d85f0">htp_connp_t::conn</a></div><div class="ttdeci">htp_conn_t * conn</div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00059">htp_connection_parser_private.h:59</a></div></div>
<div class="ttc" id="htp_8h_html_a73866af0ac06ac107436af9f08e2ca7d"><div class="ttname"><a href="htp_8h.html#a73866af0ac06ac107436af9f08e2ca7d">htp_uri_alloc</a></div><div class="ttdeci">htp_uri_t * htp_uri_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02567">htp_util.c:2567</a></div></div>
<div class="ttc" id="structhtp__connp__t_html"><div class="ttname"><a href="structhtp__connp__t.html">htp_connp_t</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00051">htp_connection_parser_private.h:51</a></div></div>
<div class="ttc" id="htp__utf8__decoder_8h_html_a4dcc8ba6832f29af88388db20305477e"><div class="ttname"><a href="htp__utf8__decoder_8h.html#a4dcc8ba6832f29af88388db20305477e">HTP_UTF8_ACCEPT</a></div><div class="ttdeci">#define HTP_UTF8_ACCEPT</div><div class="ttdef"><b>Definition:</b> <a href="htp__utf8__decoder_8h_source.html#l00076">htp_utf8_decoder.h:76</a></div></div>
<div class="ttc" id="bstr_8c_html_ae558f2c20b24baa62f84a3ee820b2b2f"><div class="ttname"><a href="bstr_8c.html#ae558f2c20b24baa62f84a3ee820b2b2f">bstr_dup_mem</a></div><div class="ttdeci">bstr * bstr_dup_mem(const void *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00254">bstr.c:254</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54aea1a762800b83e10d436e90c140ebca2"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54aea1a762800b83e10d436e90c140ebca2">HTP_M_DELETE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00264">htp_core.h:264</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_aeab39f38369303dc312a66db518f770eafee71290ea990341d940c0631f01696a"><div class="ttname"><a href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770eafee71290ea990341d940c0631f01696a">HTP_RESPONSE_COMPLETE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00090">htp_transaction.h:90</a></div></div>
<div class="ttc" id="structhtp__cfg__t_html_afdc6cb0089b6fd902db437c5af54e78b"><div class="ttname"><a href="structhtp__cfg__t.html#afdc6cb0089b6fd902db437c5af54e78b">htp_cfg_t::log_level</a></div><div class="ttdeci">enum htp_log_level_t log_level</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00141">htp_config_private.h:141</a></div></div>
<div class="ttc" id="structhtp__tx__t_html_af8464c33ab7ef7ee5824ff320a7eff99"><div class="ttname"><a href="structhtp__tx__t.html#af8464c33ab7ef7ee5824ff320a7eff99">htp_tx_t::hook_request_body_data</a></div><div class="ttdeci">htp_hook_t * hook_request_body_data</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00351">htp.h:351</a></div></div>
<div class="ttc" id="structhtp__connp__t_html_a5001dcc0e83c5cd25adf4094a0add3c1"><div class="ttname"><a href="structhtp__connp__t.html#a5001dcc0e83c5cd25adf4094a0add3c1">htp_connp_t::out_tx</a></div><div class="ttdeci">htp_tx_t * out_tx</div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00227">htp_connection_parser_private.h:227</a></div></div>
<div class="ttc" id="structhtp__file__data__t_html_a98211524d25713fac259acff57fc8633"><div class="ttname"><a href="structhtp__file__data__t.html#a98211524d25713fac259acff57fc8633">htp_file_data_t::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00139">htp.h:139</a></div></div>
<div class="ttc" id="bstr_8c_html_a8efd20da92a9a40fee8a40bdcdfb194f"><div class="ttname"><a href="bstr_8c.html#a8efd20da92a9a40fee8a40bdcdfb194f">bstr_to_lowercase</a></div><div class="ttdeci">bstr * bstr_to_lowercase(bstr *b)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00326">bstr.c:326</a></div></div>
<div class="ttc" id="structhtp__tx__data__t_html_a392ce1147f2f96d2dec8e8232167d600"><div class="ttname"><a href="structhtp__tx__data__t.html#a392ce1147f2f96d2dec8e8232167d600">htp_tx_data_t::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00553">htp.h:553</a></div></div>
<div class="ttc" id="htp__private_8h_html_a0ec8330cb428004d467f69e7c6acdb84"><div class="ttname"><a href="htp__private_8h.html#a0ec8330cb428004d467f69e7c6acdb84">fprint_raw_data</a></div><div class="ttdeci">void fprint_raw_data(FILE *stream, const char *name, const void *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02051">htp_util.c:2051</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a3b7176b278f63570d1cffbcd038a3ed5"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a3b7176b278f63570d1cffbcd038a3ed5">HTP_M_HEAD</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00260">htp_core.h:260</a></div></div>
<div class="ttc" id="htp__core_8h_html_a4f4f65a8a4c41dfdb78b6b212f4d22a5"><div class="ttname"><a href="htp__core_8h.html#a4f4f65a8a4c41dfdb78b6b212f4d22a5">HTP_PATH_OVERLONG_U</a></div><div class="ttdeci">#define HTP_PATH_OVERLONG_U</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00215">htp_core.h:215</a></div></div>
<div class="ttc" id="htp__private_8h_html_a801f66183cf5693361eca92d66607314"><div class="ttname"><a href="htp__private_8h.html#a801f66183cf5693361eca92d66607314">htp_connp_REQ_PROTOCOL</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_PROTOCOL(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00710">htp_request.c:710</a></div></div>
<div class="ttc" id="htp__core_8h_html_a17e335bbeacf0c059472ae8e68c38d6c"><div class="ttname"><a href="htp__core_8h.html#a17e335bbeacf0c059472ae8e68c38d6c">HTP_PATH_INVALID_ENCODING</a></div><div class="ttdeci">#define HTP_PATH_INVALID_ENCODING</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00213">htp_core.h:213</a></div></div>
<div class="ttc" id="structhtp__file__t_html_a390d7103786da6d8f9fae0c28bcfd1d0"><div class="ttname"><a href="structhtp__file__t.html#a390d7103786da6d8f9fae0c28bcfd1d0">htp_file_t::len</a></div><div class="ttdeci">int64_t len</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00119">htp.h:119</a></div></div>
<div class="ttc" id="htp__private_8h_html_a31cca701d490472a8cdb778a6c0e6560"><div class="ttname"><a href="htp__private_8h.html#a31cca701d490472a8cdb778a6c0e6560">htp_validate_hostname</a></div><div class="ttdeci">int htp_validate_hostname(bstr *hostname)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02515">htp_util.c:2515</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_afd392af577253b3b3613a10b3766f504"><div class="ttname"><a href="structhtp__uri__t.html#afd392af577253b3b3613a10b3766f504">htp_uri_t::hostname</a></div><div class="ttdeci">bstr * hostname</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00580">htp.h:580</a></div></div>
<div class="ttc" id="htp__private_8h_html_a330b435a16a1f366eed76bf7b7bddba6"><div class="ttname"><a href="htp__private_8h.html#a330b435a16a1f366eed76bf7b7bddba6">htp_parse_uri</a></div><div class="ttdeci">int htp_parse_uri(bstr *input, htp_uri_t **uri)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00639">htp_util.c:639</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a44b968a4b7dab8d2ce22a8bfea1e9426"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a44b968a4b7dab8d2ce22a8bfea1e9426">htp_decoder_cfg_t::bestfit_map</a></div><div class="ttdeci">unsigned char * bestfit_map</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00116">htp_config_private.h:116</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_af2867984e3c4b7b92a054f94061cf73a"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#af2867984e3c4b7b92a054f94061cf73a">htp_decoder_cfg_t::nul_encoded_unwanted</a></div><div class="ttdeci">enum htp_unwanted_t nul_encoded_unwanted</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00101">htp_config_private.h:101</a></div></div>
<div class="ttc" id="htp__utf8__decoder_8h_html_a785b0131fc5daa64da44e99fed2ea8bb"><div class="ttname"><a href="htp__utf8__decoder_8h.html#a785b0131fc5daa64da44e99fed2ea8bb">HTP_UTF8_REJECT</a></div><div class="ttdeci">#define HTP_UTF8_REJECT</div><div class="ttdef"><b>Definition:</b> <a href="htp__utf8__decoder_8h_source.html#l00077">htp_utf8_decoder.h:77</a></div></div>
<div class="ttc" id="htp__private_8h_html_ac07a4f5062908c573d2b78f6f3ddc743"><div class="ttname"><a href="htp__private_8h.html#ac07a4f5062908c573d2b78f6f3ddc743">htp_connp_REQ_BODY_CHUNKED_DATA</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_BODY_CHUNKED_DATA(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00437">htp_request.c:437</a></div></div>
<div class="ttc" id="structhtp__tx__t_html_a5916f35d8727086b4dc558f8993e08cb"><div class="ttname"><a href="structhtp__tx__t.html#a5916f35d8727086b4dc558f8993e08cb">htp_tx_t::flags</a></div><div class="ttdeci">uint64_t flags</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00529">htp.h:529</a></div></div>
<div class="ttc" id="htp__private_8h_html_a6328d9ce315c36afc0a3396f28b482a5"><div class="ttname"><a href="htp__private_8h.html#a6328d9ce315c36afc0a3396f28b482a5">htp_connp_is_line_folded</a></div><div class="ttdeci">int htp_connp_is_line_folded(unsigned char *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00397">htp_util.c:397</a></div></div>
<div class="ttc" id="htp__private_8h_html_ad207aff5c7e4a68d2a539ffd9e3fd623"><div class="ttname"><a href="htp__private_8h.html#ad207aff5c7e4a68d2a539ffd9e3fd623">htp_connp_REQ_BODY_DETERMINE</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_BODY_DETERMINE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00573">htp_request.c:573</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_aeab39f38369303dc312a66db518f770ea3d33ed1c84b45f75ca9c3420de0d6cee"><div class="ttname"><a href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770ea3d33ed1c84b45f75ca9c3420de0d6cee">HTP_RESPONSE_TRAILER</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00089">htp_transaction.h:89</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54ad993fa141c63d4a9de68a117921de659"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ad993fa141c63d4a9de68a117921de659">HTP_M_MKWORKSPACE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00283">htp_core.h:283</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_a6b8fe249b3b4e2ed3dc094a6607440aba8a23b4e6339af5d9aa812527b2c187a7"><div class="ttname"><a href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba8a23b4e6339af5d9aa812527b2c187a7">HTP_REQUEST_NOT_STARTED</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00076">htp_transaction.h:76</a></div></div>
<div class="ttc" id="htp_8h_html_a6a6849d2b4e2477402760923aae8d527"><div class="ttname"><a href="htp_8h.html#a6a6849d2b4e2477402760923aae8d527">htp_urldecode_inplace_ex</a></div><div class="ttdeci">htp_status_t htp_urldecode_inplace_ex(htp_cfg_t *cfg, enum htp_decoder_ctx_t ctx, bstr *input, uint64_t *flags, int *expected_status_code)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l01483">htp_util.c:1483</a></div></div>
<div class="ttc" id="htp__config_8h_html_afa49656ef495bb1c8d129342681f62e7acdbfd6b6cfbe4f7a15fd27a19091685a"><div class="ttname"><a href="htp__config_8h.html#afa49656ef495bb1c8d129342681f62e7acdbfd6b6cfbe4f7a15fd27a19091685a">HTP_DECODER_URLENCODED</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__config_8h_source.html#l00056">htp_config.h:56</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_aeab39f38369303dc312a66db518f770eaed90895b9daa328d3691e124e2f33721"><div class="ttname"><a href="htp__transaction_8h.html#aeab39f38369303dc312a66db518f770eaed90895b9daa328d3691e124e2f33721">HTP_RESPONSE_NOT_STARTED</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00085">htp_transaction.h:85</a></div></div>
<div class="ttc" id="flow-hash_8h_html_ae6814922f15fd7bc6376d74714a34a39"><div class="ttname"><a href="flow-hash_8h.html#ae6814922f15fd7bc6376d74714a34a39">m</a></div><div class="ttdeci">SCMutex m</div><div class="ttdef"><b>Definition:</b> <a href="flow-hash_8h_source.html#l00206">flow-hash.h:206</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54ac449547fd0838bb3eb703d974310341a"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ac449547fd0838bb3eb703d974310341a">HTP_M_PROPPATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00270">htp_core.h:270</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a8052e758111da3d2cdabd1252a093e7c"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a8052e758111da3d2cdabd1252a093e7c">HTP_M_REPORT</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00282">htp_core.h:282</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a6f4f4a427599f9c792613bec7810bd57"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a6f4f4a427599f9c792613bec7810bd57">HTP_M_POST</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00263">htp_core.h:263</a></div></div>
<div class="ttc" id="htp__core_8h_html_a9026ab5eb9e9d8777cb45a107015cb88"><div class="ttname"><a href="htp__core_8h.html#a9026ab5eb9e9d8777cb45a107015cb88">HTP_HOSTH_INVALID</a></div><div class="ttdeci">#define HTP_HOSTH_INVALID</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00223">htp_core.h:223</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a8ee53a3dfd348707aebc68e90365a248"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a8ee53a3dfd348707aebc68e90365a248">htp_decoder_cfg_t::nul_encoded_terminates</a></div><div class="ttdeci">int nul_encoded_terminates</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00098">htp_config_private.h:98</a></div></div>
<div class="ttc" id="htp__private_8h_html_a45043cdc1b581e62abbf2423be76ea2a"><div class="ttname"><a href="htp__private_8h.html#a45043cdc1b581e62abbf2423be76ea2a">htp_connp_RES_LINE</a></div><div class="ttdeci">htp_status_t htp_connp_RES_LINE(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00756">htp_response.c:756</a></div></div>
<div class="ttc" id="htp__private_8h_html_a3e8c194c19ebdaaa21fe107e328e3a75"><div class="ttname"><a href="htp__private_8h.html#a3e8c194c19ebdaaa21fe107e328e3a75">htp_connp_REQ_CONNECT_CHECK</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_CONNECT_CHECK(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00291">htp_request.c:291</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54af73c7598f9f626a9cf728505630550fa"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54af73c7598f9f626a9cf728505630550fa">HTP_M_VERSION_CONTROL</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00276">htp_core.h:276</a></div></div>
<div class="ttc" id="structhtp__tx__t_html_a85c2f3e758ff6154994c62f3ff92ea8c"><div class="ttname"><a href="structhtp__tx__t.html#a85c2f3e758ff6154994c62f3ff92ea8c">htp_tx_t::cfg</a></div><div class="ttdeci">htp_cfg_t * cfg</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00216">htp.h:216</a></div></div>
<div class="ttc" id="structhtp__connp__t_html_a149e19109e4039b3c8dd05f4a4e41a52"><div class="ttname"><a href="structhtp__connp__t.html#a149e19109e4039b3c8dd05f4a4e41a52">htp_connp_t::cfg</a></div><div class="ttdeci">htp_cfg_t * cfg</div><div class="ttdef"><b>Definition:</b> <a href="htp__connection__parser__private_8h_source.html#l00056">htp_connection_parser_private.h:56</a></div></div>
<div class="ttc" id="htp__private_8h_html"><div class="ttname"><a href="htp__private_8h.html">htp_private.h</a></div></div>
<div class="ttc" id="htp__private_8h_html_a8b599459708fac234b83e8d8fe58b258"><div class="ttname"><a href="htp__private_8h.html#a8b599459708fac234b83e8d8fe58b258">htp_is_line_whitespace</a></div><div class="ttdeci">int htp_is_line_whitespace(unsigned char *data, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00234">htp_util.c:234</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a10f58340e03382163926d59854b0f6f7"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a10f58340e03382163926d59854b0f6f7">htp_decoder_cfg_t::control_chars_unwanted</a></div><div class="ttdeci">enum htp_unwanted_t control_chars_unwanted</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00080">htp_config_private.h:80</a></div></div>
<div class="ttc" id="htp__private_8h_html_a9bd7382b55286e62a10aac00bc630af1"><div class="ttname"><a href="htp__private_8h.html#a9bd7382b55286e62a10aac00bc630af1">fprint_raw_data_ex</a></div><div class="ttdeci">void fprint_raw_data_ex(FILE *stream, const char *name, const void *data, size_t offset, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02058">htp_util.c:2058</a></div></div>
<div class="ttc" id="htp__private_8h_html_a989808ba8cacae96e9c5e0e052a73a3c"><div class="ttname"><a href="htp__private_8h.html#a989808ba8cacae96e9c5e0e052a73a3c">htp_treat_response_line_as_body</a></div><div class="ttdeci">int htp_treat_response_line_as_body(htp_tx_t *tx)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02334">htp_util.c:2334</a></div></div>
<div class="ttc" id="structhtp__log__t_html_a7aa669dbd0238ed71885f793e475730d"><div class="ttname"><a href="structhtp__log__t.html#a7aa669dbd0238ed71885f793e475730d">htp_log_t::connp</a></div><div class="ttdeci">htp_connp_t * connp</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00147">htp.h:147</a></div></div>
<div class="ttc" id="structhtp__log__t_html_aef87f204703523c89e095e200e04b904"><div class="ttname"><a href="structhtp__log__t.html#aef87f204703523c89e095e200e04b904">htp_log_t::file</a></div><div class="ttdeci">const char * file</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00162">htp.h:162</a></div></div>
<div class="ttc" id="structhtp__cfg__t_html_a90032f98e53aede4bbe7b985fa63871c"><div class="ttname"><a href="structhtp__cfg__t.html#a90032f98e53aede4bbe7b985fa63871c">htp_cfg_t::decoder_cfgs</a></div><div class="ttdeci">htp_decoder_cfg_t decoder_cfgs[HTP_DECODER_CONTEXTS_MAX]</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00170">htp_config_private.h:170</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a31077401671daade7004f6e7b861d4e1"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a31077401671daade7004f6e7b861d4e1">htp_decoder_cfg_t::bestfit_replacement_byte</a></div><div class="ttdeci">unsigned char bestfit_replacement_byte</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00119">htp_config_private.h:119</a></div></div>
<div class="ttc" id="htp__private_8h_html_a50d9fb619fe71bfee3ab812d96ba0b6c"><div class="ttname"><a href="htp__private_8h.html#a50d9fb619fe71bfee3ab812d96ba0b6c">htp_parse_content_length</a></div><div class="ttdeci">int64_t htp_parse_content_length(bstr *b)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00253">htp_util.c:253</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54ae269bae49fcd079feb54e71f575312b3"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ae269bae49fcd079feb54e71f575312b3">HTP_M_MERGE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00286">htp_core.h:286</a></div></div>
<div class="ttc" id="htp__core_8h_html_a0fe750fdf2e0ce6959db17e50efa0647"><div class="ttname"><a href="htp__core_8h.html#a0fe750fdf2e0ce6959db17e50efa0647">HTP_URLEN_ENCODED_NUL</a></div><div class="ttdeci">#define HTP_URLEN_ENCODED_NUL</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00224">htp_core.h:224</a></div></div>
<div class="ttc" id="htp__core_8h_html_ae91a6ad07977423dd1ec14a44156d799"><div class="ttname"><a href="htp__core_8h.html#ae91a6ad07977423dd1ec14a44156d799">htp_log_level_t</a></div><div class="ttdeci">htp_log_level_t</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00241">htp_core.h:241</a></div></div>
<div class="ttc" id="htp__private_8h_html_a028530726a98edc10fc5adf8a050b349"><div class="ttname"><a href="htp__private_8h.html#a028530726a98edc10fc5adf8a050b349">htp_connp_RES_BODY_CHUNKED_DATA_END</a></div><div class="ttdeci">htp_status_t htp_connp_RES_BODY_CHUNKED_DATA_END(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00287">htp_response.c:287</a></div></div>
<div class="ttc" id="htp__config__auto_8h_html"><div class="ttname"><a href="htp__config__auto_8h.html">htp_config_auto.h</a></div></div>
<div class="ttc" id="decode-icmpv4_8h_html_a966576744a473fafb7687f8e5649941f"><div class="ttname"><a href="decode-icmpv4_8h.html#a966576744a473fafb7687f8e5649941f">code</a></div><div class="ttdeci">uint8_t code</div><div class="ttdef"><b>Definition:</b> <a href="decode-icmpv4_8h_source.html#l00768">decode-icmpv4.h:768</a></div></div>
<div class="ttc" id="htp__private_8h_html_a984918ce8cdd5c6d42c74294a1c7cc18"><div class="ttname"><a href="htp__private_8h.html#a984918ce8cdd5c6d42c74294a1c7cc18">htp_connp_REQ_IGNORE_DATA_AFTER_HTTP_0_9</a></div><div class="ttdeci">htp_status_t htp_connp_REQ_IGNORE_DATA_AFTER_HTTP_0_9(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__request_8c_source.html#l00798">htp_request.c:798</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a30cd4d5fa5016930f8430869cec74d3e"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a30cd4d5fa5016930f8430869cec74d3e">HTP_M_CHECKOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00277">htp_core.h:277</a></div></div>
<div class="ttc" id="structhtp__file__data__t_html_a9b5a9f5b379aca7a75ef9246a83eaf8c"><div class="ttname"><a href="structhtp__file__data__t.html#a9b5a9f5b379aca7a75ef9246a83eaf8c">htp_file_data_t::file</a></div><div class="ttdeci">htp_file_t * file</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00133">htp.h:133</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a9ba29c5eb2face4f71ad70f8b82310bf"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a9ba29c5eb2face4f71ad70f8b82310bf">htp_decoder_cfg_t::nul_raw_unwanted</a></div><div class="ttdeci">enum htp_unwanted_t nul_raw_unwanted</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00077">htp_config_private.h:77</a></div></div>
<div class="ttc" id="bstr_8c_html_a7ac48f2b29c76130b28bc2fa8280ce49"><div class="ttname"><a href="bstr_8c.html#a7ac48f2b29c76130b28bc2fa8280ce49">bstr_cmp_c</a></div><div class="ttdeci">int bstr_cmp_c(const bstr *b, const char *c)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00214">bstr.c:214</a></div></div>
<div class="ttc" id="htp_8h_html_a2a01a96c537538cdefec78b9628b5e93"><div class="ttname"><a href="htp_8h.html#a2a01a96c537538cdefec78b9628b5e93">htp_urldecode_inplace</a></div><div class="ttdeci">htp_status_t htp_urldecode_inplace(htp_cfg_t *cfg, enum htp_decoder_ctx_t ctx, bstr *input, uint64_t *flags)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l01478">htp_util.c:1478</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_a6b8fe249b3b4e2ed3dc094a6607440aba982c1f4b53c68e2cccf7ab261ca5e22b"><div class="ttname"><a href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba982c1f4b53c68e2cccf7ab261ca5e22b">HTP_REQUEST_LINE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00077">htp_transaction.h:77</a></div></div>
<div class="ttc" id="htp__core_8h_html_ae91a6ad07977423dd1ec14a44156d799a92383cf2d26bc4a3f9b32c9d948662a4"><div class="ttname"><a href="htp__core_8h.html#ae91a6ad07977423dd1ec14a44156d799a92383cf2d26bc4a3f9b32c9d948662a4">HTP_LOG_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00243">htp_core.h:243</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a31d679e535beab8e244d3963dec854b4"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a31d679e535beab8e244d3963dec854b4">htp_decoder_cfg_t::nul_raw_terminates</a></div><div class="ttdeci">int nul_raw_terminates</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00074">htp_config_private.h:74</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a696577213f6aa9447ac43e23868a2cd4"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a696577213f6aa9447ac43e23868a2cd4">htp_decoder_cfg_t::backslash_convert_slashes</a></div><div class="ttdeci">int backslash_convert_slashes</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00053">htp_config_private.h:53</a></div></div>
<div class="ttc" id="htp__private_8h_html_a1dfe07ee3d981b6bfaaf6c88d01224b0"><div class="ttname"><a href="htp__private_8h.html#a1dfe07ee3d981b6bfaaf6c88d01224b0">fprint_bstr</a></div><div class="ttdeci">void fprint_bstr(FILE *stream, const char *name, bstr *b)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02039">htp_util.c:2039</a></div></div>
<div class="ttc" id="structhtp__tx__data__t_html"><div class="ttname"><a href="structhtp__tx__data__t.html">htp_tx_data_t</a></div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00545">htp.h:545</a></div></div>
<div class="ttc" id="htp__private_8h_html_a8fbfa6b24b1c5ffb1f1d9de3d3834c6c"><div class="ttname"><a href="htp__private_8h.html#a8fbfa6b24b1c5ffb1f1d9de3d3834c6c">htp_parse_uri_hostport</a></div><div class="ttdeci">int htp_parse_uri_hostport(htp_connp_t *connp, bstr *input, htp_uri_t *uri)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00584">htp_util.c:584</a></div></div>
<div class="ttc" id="htp__private_8h_html_acd9999e11e39f8434023b786416fdc43"><div class="ttname"><a href="htp__private_8h.html#acd9999e11e39f8434023b786416fdc43">htp_is_text</a></div><div class="ttdeci">int htp_is_text(int c)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l00098">htp_util.c:98</a></div></div>
<div class="ttc" id="htp__private_8h_html_a14e44933747475b68b36ea4b4ec7f1eb"><div class="ttname"><a href="htp__private_8h.html#a14e44933747475b68b36ea4b4ec7f1eb">htp_tx_urldecode_uri_inplace</a></div><div class="ttdeci">htp_status_t htp_tx_urldecode_uri_inplace(htp_tx_t *tx, bstr *input)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l01454">htp_util.c:1454</a></div></div>
<div class="ttc" id="bstr_8c_html_ad6bdcaadaf0034880584515edbca2427"><div class="ttname"><a href="bstr_8c.html#ad6bdcaadaf0034880584515edbca2427">bstr_adjust_len</a></div><div class="ttdeci">void bstr_adjust_len(bstr *b, size_t newlen)</div><div class="ttdef"><b>Definition:</b> <a href="bstr_8c_source.html#l00102">bstr.c:102</a></div></div>
<div class="ttc" id="htp__private_8h_html_a3290cc3c0233d21dd5c3e8e97883ea18"><div class="ttname"><a href="htp__private_8h.html#a3290cc3c0233d21dd5c3e8e97883ea18">htp_tx_urldecode_params_inplace</a></div><div class="ttdeci">htp_status_t htp_tx_urldecode_params_inplace(htp_tx_t *tx, bstr *input)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l01474">htp_util.c:1474</a></div></div>
<div class="ttc" id="app-layer-dns-common_8h_html_a8aed22e2c7b283705ec82e0120515618"><div class="ttname"><a href="app-layer-dns-common_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a></div><div class="ttdeci">uint16_t len</div><div class="ttdef"><b>Definition:</b> <a href="app-layer-dns-common_8h_source.html#l00041">app-layer-dns-common.h:41</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a4b8f9f64f8e70a6b5bd087697f4ed4d3"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a4b8f9f64f8e70a6b5bd087697f4ed4d3">htp_decoder_cfg_t::path_separators_compress</a></div><div class="ttdeci">int path_separators_compress</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00059">htp_config_private.h:59</a></div></div>
<div class="ttc" id="htp__private_8h_html_a35978034dd65239e911dd33f7c751332"><div class="ttname"><a href="htp__private_8h.html#a35978034dd65239e911dd33f7c751332">htp_connp_RES_BODY_IDENTITY_CL_KNOWN</a></div><div class="ttdeci">htp_status_t htp_connp_RES_BODY_IDENTITY_CL_KNOWN(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00402">htp_response.c:402</a></div></div>
<div class="ttc" id="htp__private_8h_html_a7e8991ba87da71aa0b14c2955da46b25"><div class="ttname"><a href="htp__private_8h.html#a7e8991ba87da71aa0b14c2955da46b25">htp_normalize_hostname_inplace</a></div><div class="ttdeci">bstr * htp_normalize_hostname_inplace(bstr *input)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l01793">htp_util.c:1793</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a11c070fe8bd95cf44604939ffc82e6cd"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a11c070fe8bd95cf44604939ffc82e6cd">HTP_M_MKACTIVITY</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00284">htp_core.h:284</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_a269bbfa8c971285f664c000b6ad8909b"><div class="ttname"><a href="structhtp__uri__t.html#a269bbfa8c971285f664c000b6ad8909b">htp_uri_t::fragment</a></div><div class="ttdeci">bstr * fragment</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00601">htp.h:601</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_abdb73dfb0c905f7d031e665f1089a701"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#abdb73dfb0c905f7d031e665f1089a701">htp_decoder_cfg_t::path_separators_decode</a></div><div class="ttdeci">int path_separators_decode</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00062">htp_config_private.h:62</a></div></div>
<div class="ttc" id="htp__private_8h_html_a7745dfd28ae341b34cde2bb1f333b1b8"><div class="ttname"><a href="htp__private_8h.html#a7745dfd28ae341b34cde2bb1f333b1b8">htp_tx_request_progress_as_string</a></div><div class="ttdeci">char * htp_tx_request_progress_as_string(htp_tx_t *tx)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02168">htp_util.c:2168</a></div></div>
<div class="ttc" id="structhtp__tx__t_html"><div class="ttname"><a href="structhtp__tx__t.html">htp_tx_t</a></div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00208">htp.h:208</a></div></div>
<div class="ttc" id="htp__config_8h_html_ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9"><div class="ttname"><a href="htp__config_8h.html#ad4778196945d6cf016bf9b1d294bf270af6273f391e86686fcb685254defa39d9">HTP_URL_DECODE_PRESERVE_PERCENT</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__config_8h_source.html#l00120">htp_config.h:120</a></div></div>
<div class="ttc" id="htp__core_8h_html_aae6bc4404defe08c301eb498d8bcf4c0"><div class="ttname"><a href="htp__core_8h.html#aae6bc4404defe08c301eb498d8bcf4c0">HTP_OK</a></div><div class="ttdeci">#define HTP_OK</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00081">htp_core.h:81</a></div></div>
<div class="ttc" id="htp__private_8h_html_a9469285f23ba429b8358c9385ccd6eef"><div class="ttname"><a href="htp__private_8h.html#a9469285f23ba429b8358c9385ccd6eef">htp_tx_response_progress_as_string</a></div><div class="ttdeci">char * htp_tx_response_progress_as_string(htp_tx_t *tx)</div><div class="ttdef"><b>Definition:</b> <a href="htp__util_8c_source.html#l02192">htp_util.c:2192</a></div></div>
<div class="ttc" id="structhtp__uri__t_html_ab390df0fcf89c67f9e3c2076d222ad74"><div class="ttname"><a href="structhtp__uri__t.html#ab390df0fcf89c67f9e3c2076d222ad74">htp_uri_t::query</a></div><div class="ttdeci">bstr * query</div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00596">htp.h:596</a></div></div>
<div class="ttc" id="structhtp__decoder__cfg__t_html_a869b6cff889d549e19407b4be4ee979f"><div class="ttname"><a href="structhtp__decoder__cfg__t.html#a869b6cff889d549e19407b4be4ee979f">htp_decoder_cfg_t::path_separators_encoded_unwanted</a></div><div class="ttdeci">enum htp_unwanted_t path_separators_encoded_unwanted</div><div class="ttdef"><b>Definition:</b> <a href="htp__config__private_8h_source.html#l00068">htp_config_private.h:68</a></div></div>
<div class="ttc" id="htp__core_8h_html_a88f6d4e1b9465ff87454af7321970481"><div class="ttname"><a href="htp__core_8h.html#a88f6d4e1b9465ff87454af7321970481">HTP_LOG_MARK</a></div><div class="ttdeci">#define HTP_LOG_MARK</div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00236">htp_core.h:236</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54a81520736f83f29a2d10f011d53d12542"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54a81520736f83f29a2d10f011d53d12542">HTP_M_OPTIONS</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00266">htp_core.h:266</a></div></div>
<div class="ttc" id="htp__core_8h_html_a5def731ca738b5e96154df2889210a54ae451fd57a8a591bfbc83f84f20345d92"><div class="ttname"><a href="htp__core_8h.html#a5def731ca738b5e96154df2889210a54ae451fd57a8a591bfbc83f84f20345d92">HTP_M_MOVE</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__core_8h_source.html#l00273">htp_core.h:273</a></div></div>
<div class="ttc" id="htp__transaction_8h_html_a6b8fe249b3b4e2ed3dc094a6607440aba0289ffb4a8c8da95d5b9435c5a272abb"><div class="ttname"><a href="htp__transaction_8h.html#a6b8fe249b3b4e2ed3dc094a6607440aba0289ffb4a8c8da95d5b9435c5a272abb">HTP_REQUEST_BODY</a></div><div class="ttdef"><b>Definition:</b> <a href="htp__transaction_8h_source.html#l00079">htp_transaction.h:79</a></div></div>
<div class="ttc" id="htp__private_8h_html_ae160ab80f3c9d3c3aad67b7a34a498ab"><div class="ttname"><a href="htp__private_8h.html#ae160ab80f3c9d3c3aad67b7a34a498ab">htp_connp_RES_BODY_CHUNKED_DATA</a></div><div class="ttdeci">htp_status_t htp_connp_RES_BODY_CHUNKED_DATA(htp_connp_t *connp)</div><div class="ttdef"><b>Definition:</b> <a href="htp__response_8c_source.html#l00312">htp_response.c:312</a></div></div>
<div class="ttc" id="structhtp__log__t_html"><div class="ttname"><a href="structhtp__log__t.html">htp_log_t</a></div><div class="ttdef"><b>Definition:</b> <a href="htp_8h_source.html#l00145">htp.h:145</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5a8a84310ac5c5a9ff38fc974698b3a7.html">libhtp</a></li><li class="navelem"><a class="el" href="dir_230ed285961c8f21296b4c8e0daccb5b.html">htp</a></li><li class="navelem"><a class="el" href="htp__util_8c.html">htp_util.c</a></li>
    <li class="footer">Generated on Wed Nov 25 2015 05:52:44 for suricata by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
